!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalksgl={},e.maptalks)}(this,function(e,r){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t,n=(function(e,t){e.exports=function(){var J=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},$=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},l="\n";function n(e){var t=new Error("(regl) "+e);throw console.error(t),t}function p(e,t){e||n(t)}function i(e){return e?": "+e:""}function a(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var t=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function h(e,t){for(e+="";e.length<t;)e=" "+e;return e}function d(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function m(e,t){this.number=e,this.line=t,this.errors=[]}function _(e,t,r){this.file=e,this.line=t,this.message=r}function v(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function o(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function g(e,t){var r,n=e.split("\n"),i=1,a=0,o={unknown:new d,0:new d};o.unknown.name=o[0].name=t||v(),o.unknown.lines.push(new m(0,""));for(var s=0;s<n.length;++s){var u=n[s],f=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(u);if(f)switch(f[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(f[2]);c&&(i=0|c[1],c[2]&&((a=0|c[2])in o||(o[a]=new d)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(f[2]);l&&(o[a].name=l[1]?(r=l[2],"undefined"!=typeof atob?atob(r):"base64:"+r):l[2])}o[a].lines.push(new m(i++,u))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function u(e){e._commandRef=v()}function s(e,t){var r=o();n(e+" in command "+(t||v())+("unknown"===r?"":" called from "+r))}function b(e,t,r,n){typeof e!==t&&s("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e,n||v())}var E=33071,r=32819,f=32820,c=33635,y=34042,A={};function T(e,t){return e===f||e===r||e===c?2:e===y?4:A[e]*t}function R(e){return!(e&e-1||!e)}A[5120]=A[5121]=1,A[5122]=A[5123]=A[36193]=A[c]=A[r]=A[f]=2,A[5124]=A[5125]=A[5126]=A[y]=4;var ee=$(p,{optional:function(e){e()},raise:n,commandRaise:s,command:function(e,t,r){e||s(t,r||v())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||s("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join(),n||v())},constructor:function(e){Object.keys(e).forEach(function(e){t.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+t)})},type:function(e,t,r){typeof e!==t&&n("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e)},commandType:b,isTypedArray:function(e,t){J(e)||n("invalid parameter type"+i(t)+". must be a typed array")},nni:function(e,t){0<=e&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:a,shaderError:function(e,t,r,n,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),o=n===e.FRAGMENT_SHADER?"fragment":"vertex";b(r,"string",o+" shader source must be a string",i);var s=g(r,i),u=(c=[],a.split("\n").forEach(function(e){if(!(e.length<5)){var t=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);t?c.push(new _(0|t[1],0|t[2],t[3].trim())):0<e.length&&c.push(new _("unknown",0,e))}}),c);f=s,u.forEach(function(e){var t=f[e.file];if(t){var r=t.index[e.line];if(r)return r.errors.push(e),void(t.hasErrors=!0)}f.unknown.hasErrors=!0,f.unknown.lines[0].errors.push(e)}),Object.keys(s).forEach(function(e){var t=s[e];if(t.hasErrors){var r=[""],n=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(i){if(0<i.errors.length){o(h(i.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(i.line+l,"color:red; background-color:yellow; font-weight:bold");var a=0;i.errors.forEach(function(e){var t=e.message,r=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(t);if(r){var n=r[1];switch(t=r[2],n){case"assign":n="="}a=Math.max(i.line.indexOf(n,a),0)}else a=0;o(h("| ",6)),o(h("^^^",a+3)+l,"font-weight:bold"),o(h("| ",6)),o(t+l,"font-weight:bold")}),o(h("| ",6)+l)}else o(h(i.number,4)+"|  "),o(i.line+l,"color:red")}),"undefined"==typeof document||window.chrome?console.log(r.join("")):(n[0]=r.join("%c"),console.log.apply(console,n))}function o(e,t){r.push(e),n.push(t||"")}}),p.raise("Error compiling "+o+" shader, "+s[0].name)}var f,c},linkError:function(e,t,r,n,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),o=g(r,i),s=g(n,i),u='Error linking program with vertex shader, "'+s[0].name+'", and fragment shader "'+o[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+l+"%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+l+a),p.raise(u)}},callSite:o,saveCommandRef:u,saveDrawInfo:function(e,t,r,n){function i(e){return e?n.id(e):0}function a(t,e){Object.keys(e).forEach(function(e){t[n.id(e)]=!0})}u(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,r.static),a(s,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?a(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):a(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:v,texture2D:function(e,t,r){var n,i=t.width,a=t.height,o=t.channels;p(0<i&&i<=r.maxTextureSize&&0<a&&a<=r.maxTextureSize,"invalid texture shape"),(e.wrapS!==E||e.wrapT!==E)&&p(R(i)&&R(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&p(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(p(R(i)&&R(a),"texture must be a square power of 2 to support mipmapping"),p(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(r.extensions.indexOf("oes_texture_float_linear")<0&&p(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),p(!e.genMipmaps,"mipmap generation not supported with float textures"));var s=t.images;for(n=0;n<16;++n)if(s[n]){var u=i>>n,f=a>>n;p(t.mipmask&1<<n,"missing mipmap data");var c=s[n];if(p(c.width===u&&c.height===f,"invalid shape for mip images"),p(c.format===t.format&&c.internalformat===t.internalformat&&c.type===t.type,"incompatible type for mip image"),c.compressed);else if(c.data){var l=Math.ceil(T(c.type,o)*u/c.unpackAlignment)*c.unpackAlignment;p(c.data.byteLength===l*f,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else e.genMipmaps||p(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&p(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,n){var i=e.width,a=e.height,o=e.channels;p(0<i&&i<=n.maxTextureSize&&0<a&&a<=n.maxTextureSize,"invalid texture shape"),p(i===a,"cube map must be square"),p(t.wrapS===E&&t.wrapT===E,"wrap mode not supported by cube map");for(var s=0;s<r.length;++s){var u=r[s];p(u.width===i&&u.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(p(!u.compressed,"can not generate mipmap for compressed textures"),p(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=u.images,c=0;c<16;++c){var l=f[c];if(l){var h=i>>c,d=a>>c;p(u.mipmask&1<<c,"missing mipmap data"),p(l.width===h&&l.height===d,"invalid shape for mip images"),p(l.format===e.format&&l.internalformat===e.internalformat&&l.type===e.type,"incompatible type for mip image"),l.compressed||(l.data?p(l.data.byteLength===h*d*Math.max(T(l.type,o),l.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):l.element||l.copy)}}}}}),M=0;function x(e,t){this.id=M++,this.type=e,this.data=t}function S(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function C(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(1<t.length&&r===n&&('"'===r||"'"===r))return['"'+S(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var a=t.split(".");if(1===a.length)return['"'+S(t)+'"'];for(var o=[],s=0;s<a.length;++s)o=o.concat(e(a[s]));return o}(e).join("][")+"]"}var q={DynamicVariable:x,define:function(e,t){return new x(e,C(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof x},unbox:function(e,t){return"function"==typeof e?new x(0,e):e},accessor:C},K={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},Y="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function O(e){return"string"==typeof e?e.split():(ee(Array.isArray(e),"invalid extension array"),e)}function w(e){return"string"==typeof e?(ee("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function Z(e){var t,r,n,i,a,o,s=e||{},u={},f=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,h=!1,d=function(e){e&&ee.raise(e)},p=function(){};if("string"==typeof s?(ee("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(s),ee(t,"invalid query string for element")):"object"==typeof s?"string"==typeof(o=s).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?t=s:"function"==typeof(a=s).drawArrays||"function"==typeof a.drawElements?n=(i=s).canvas:(ee.constructor(s),"gl"in s?i=s.gl:"canvas"in s?n=w(s.canvas):"container"in s&&(r=w(s.container)),"attributes"in s&&(u=s.attributes,ee.type(u,"object","invalid context attributes")),"extensions"in s&&(f=O(s.extensions)),"optionalExtensions"in s&&(c=O(s.optionalExtensions)),"onDone"in s&&(ee.type(s.onDone,"function","invalid or missing onDone callback"),d=s.onDone),"profile"in s&&(h=!!s.profile),"pixelRatio"in s&&(l=+s.pixelRatio,ee(0<l,"invalid pixel ratio"))):ee.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?n=t:r=t),!i){if(!n){ee("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(n,e,i){var a=document.createElement("canvas");function t(){var e=window.innerWidth,t=window.innerHeight;if(n!==document.body){var r=n.getBoundingClientRect();e=r.right-r.left,t=r.bottom-r.top}a.width=i*e,a.height=i*t,$(a.style,{width:e+"px",height:t+"px"})}return $(a.style,{border:0,margin:0,padding:0,top:0,left:0}),n.appendChild(a),n===document.body&&(a.style.position="absolute",$(n.style,{margin:0,padding:0})),window.addEventListener("resize",t,!1),t(),{canvas:a,onDestroy:function(){window.removeEventListener("resize",t),n.removeChild(a)}}}(r||document.body,0,l);if(!m)return null;n=m.canvas,p=m.onDestroy}i=function(t,r){function e(e){try{return t.getContext(e,r)}catch(e){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}(n,u)}return i?{gl:i,canvas:n,container:r,extensions:f,optionalExtensions:c,pixelRatio:l,profile:h,onDone:d,onDestroy:p}:(p(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function z(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function N(e){var t,r;return t=(65535<e)<<4,t|=r=(255<(e>>>=t))<<3,t|=r=(15<(e>>>=r))<<2,(t|=r=(3<(e>>>=r))<<1)|(e>>>=r)>>1}function e(){var n=z(8,function(){return[]});function i(e){var t=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(e),r=n[N(t)>>2];return 0<r.length?r.pop():new ArrayBuffer(t)}function t(e){n[N(e.byteLength)>>2].push(e)}return{alloc:i,free:t,allocType:function(e,t){var r=null;switch(e){case 5120:r=new Int8Array(i(t),0,t);break;case 5121:r=new Uint8Array(i(t),0,t);break;case 5122:r=new Int16Array(i(2*t),0,t);break;case 5123:r=new Uint16Array(i(2*t),0,t);break;case 5124:r=new Int32Array(i(4*t),0,t);break;case 5125:r=new Uint32Array(i(4*t),0,t);break;case 5126:r=new Float32Array(i(4*t),0,t);break;default:return null}return r.length!==t?r.subarray(0,t):r},freeType:function(e){t(e.buffer)}}}var te=e();te.zero=e();var Q=6408;function re(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||J(e.data))}var ne=function(t){return Object.keys(t).map(function(e){return t[e]})},ie={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;var o=n||te.allocType(r,i);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],o);break;case 2:!function(e,t,r,n){for(var i=0,a=0;a<t;++a)for(var o=e[a],s=0;s<r;++s)n[i++]=o[s]}(e,t[0],t[1],o);break;case 3:F(e,t[0],t[1],t[2],o,0);break;default:!function e(t,r,n,i,a){for(var o=1,s=n+1;s<r.length;++s)o*=r[s];var u=r[n];if(r.length-n==4){var f=r[n+1],c=r[n+2],l=r[n+3];for(s=0;s<u;++s)F(t[s],f,c,l,i,a),a+=o}else for(s=0;s<u;++s)e(t[s],r,n+1,i,a),a+=o}(e,t,0,o,0)}return o}};function F(e,t,r,n,i,a){for(var o=a,s=0;s<t;++s)for(var u=e[s],f=0;f<r;++f)for(var c=u[f],l=0;l<n;++l)i[o++]=c[l]}var I={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ae={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},oe={dynamic:35048,stream:35040,static:35044},se=ie.flatten,ue=ie.shape,fe=35044,ce=35040,le=5121,he=5126,de=[];function pe(e){return 0|I[Object.prototype.toString.call(e)]}function me(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function _e(e,t,r,n,i,a,o){for(var s=0,u=0;u<r;++u)for(var f=0;f<n;++f)e[s++]=t[i*u+a*f+o]}de[5120]=1,de[5122]=2,de[5124]=4,de[5121]=1,de[5123]=2,de[5125]=4;var ve={points:0,point:0,lines:1,line:1,triangles:de[5126]=4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ge=0,be=1,Ee=4,ye=5120,Ae=5121,Te=5122,Re=5123,Me=5124,xe=5125,Se=34963,Ce=35040,Oe=35044,L=new Float32Array(1),D=new Uint32Array(L.buffer),P=5123;function we(e){for(var t=te.allocType(P,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{L[0]=e[r];var n=D[0],i=n>>>31<<15,a=(n<<1>>>24)-127,o=n>>13&1023;if(a<-24)t[r]=i;else if(a<-14){var s=-14-a;t[r]=i+(o+1024>>s)}else t[r]=15<a?i+31744:i+(a+15<<10)+o}return t}function Ne(e){return Array.isArray(e)||J(e)}var Fe=function(e){return!(e&e-1||!e)},Ie=34467,Le=3553,De=34067,Pe=34069,Be=6408,Ue=6406,ke=6407,Ge=6409,He=6410,Ve=32854,Xe=32855,je=36194,We=32819,ze=32820,qe=33635,Ke=34042,Ye=6402,Ze=34041,Qe=35904,Je=35906,$e=36193,et=33776,tt=33777,rt=33778,nt=33779,it=35986,at=35987,ot=34798,st=35840,ut=35841,ft=35842,ct=35843,lt=36196,ht=5121,dt=5123,pt=5125,mt=5126,_t=10242,vt=10243,gt=10497,bt=33071,Et=33648,yt=10240,At=10241,Tt=9728,Rt=9729,Mt=9984,xt=9985,St=9986,Ct=9987,Ot=33170,wt=4352,Nt=4353,Ft=4354,It=34046,Lt=3317,Dt=37440,Pt=37441,Bt=37443,Ut=37444,kt=33984,Gt=[Mt,St,xt,Ct],Ht=[0,Ge,He,ke,Be],Vt={};function B(e){return"[object "+e+"]"}Vt[Ge]=Vt[Ue]=Vt[Ye]=1,Vt[Ze]=Vt[He]=2,Vt[ke]=Vt[Qe]=3,Vt[Be]=Vt[Je]=4;var U=B("HTMLCanvasElement"),Xt=B("CanvasRenderingContext2D"),jt=B("ImageBitmap"),Wt=B("HTMLImageElement"),zt=B("HTMLVideoElement"),k=Object.keys(I).concat([U,Xt,jt,Wt,zt]),G=[];G[ht]=1,G[mt]=4,G[$e]=2,G[dt]=2,G[pt]=4;var H=[];function qt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Kt(e){if(!Array.isArray(e))return!1;var t=e.length;return!(0===t||!Ne(e[0]))}function Yt(e){return Object.prototype.toString.call(e)}function Zt(e){return Yt(e)===U}function Qt(e){if(!e)return!1;var t=Yt(e);return 0<=k.indexOf(t)||qt(e)||Kt(e)||re(e)}function Jt(e){return 0|I[Object.prototype.toString.call(e)]}function $t(e,t){return te.allocType(e.type===$e?mt:e.type,t)}function er(e,t){e.type===$e?(e.data=we(t),te.freeType(t)):e.data=t}function tr(e,t,r,n,i,a){var o;if(o=void 0!==H[e]?H[e]:Vt[e]*G[t],a&&(o*=6),i){for(var s=0,u=r;1<=u;)s+=o*u*u,u/=2;return s}return o*r*n}function rr(d,c,y,h,A,o,p){var l={"don't care":wt,"dont care":wt,nice:Ft,fast:Nt},m={repeat:gt,clamp:bt,mirror:Et},_={nearest:Tt,linear:Rt},v=$({mipmap:Ct,"nearest mipmap nearest":Mt,"linear mipmap nearest":xt,"nearest mipmap linear":St,"linear mipmap linear":Ct},_),g={none:0,browser:Ut},b={uint8:ht,rgba4:We,rgb565:qe,"rgb5 a1":ze},E={alpha:Ue,luminance:Ge,"luminance alpha":He,rgb:ke,rgba:Be,rgba4:Ve,"rgb5 a1":Xe,rgb565:je},T={};c.ext_srgb&&(E.srgb=Qe,E.srgba=Je),c.oes_texture_float&&(b.float32=b.float=mt),c.oes_texture_half_float&&(b.float16=b["half float"]=$e),c.webgl_depth_texture&&($(E,{depth:Ye,"depth stencil":Ze}),$(b,{uint16:dt,uint32:pt,"depth stencil":Ke})),c.webgl_compressed_texture_s3tc&&$(T,{"rgb s3tc dxt1":et,"rgba s3tc dxt1":tt,"rgba s3tc dxt3":rt,"rgba s3tc dxt5":nt}),c.webgl_compressed_texture_atc&&$(T,{"rgb atc":it,"rgba atc explicit alpha":at,"rgba atc interpolated alpha":ot}),c.webgl_compressed_texture_pvrtc&&$(T,{"rgb pvrtc 4bppv1":st,"rgb pvrtc 2bppv1":ut,"rgba pvrtc 4bppv1":ft,"rgba pvrtc 2bppv1":ct}),c.webgl_compressed_texture_etc1&&(T["rgb etc1"]=lt);var r=Array.prototype.slice.call(d.getParameter(Ie));Object.keys(T).forEach(function(e){var t=T[e];0<=r.indexOf(t)&&(E[e]=t)});var e=Object.keys(E);y.textureFormats=e;var R=[];Object.keys(E).forEach(function(e){var t=E[e];R[t]=e});var M=[];Object.keys(b).forEach(function(e){var t=b[e];M[t]=e});var x=[];Object.keys(_).forEach(function(e){var t=_[e];x[t]=e});var S=[];Object.keys(v).forEach(function(e){var t=v[e];S[t]=e});var C=[];Object.keys(m).forEach(function(e){var t=m[e];C[t]=e});var O=e.reduce(function(e,t){var r=E[t];return r===Ge||r===Ue||r===Ge||r===He||r===Ye||r===Ze?e[r]=r:r===Xe||0<=t.indexOf("rgba")?e[r]=Be:e[r]=ke,e},{});function n(){this.internalformat=Be,this.format=Be,this.type=ht,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ut,this.width=0,this.height=0,this.channels=0}function w(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function N(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(ee.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ee.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ee.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ee.parameter(t.colorSpace,g,"invalid colorSpace"),e.colorSpace=g[t.colorSpace]),"type"in t){var r=t.type;ee(c.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),ee(c.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ee(c.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ee.parameter(r,b,"invalid texture type"),e.type=b[r]}var n=e.width,i=e.height,a=e.channels,o=!1;"shape"in t?(ee(Array.isArray(t.shape)&&2<=t.shape.length,"shape must be an array"),n=t.shape[0],i=t.shape[1],3===t.shape.length&&(a=t.shape[2],ee(0<a&&a<=4,"invalid number of channels"),o=!0),ee(0<=n&&n<=y.maxTextureSize,"invalid width"),ee(0<=i&&i<=y.maxTextureSize,"invalid height")):("radius"in t&&(n=i=t.radius,ee(0<=n&&n<=y.maxTextureSize,"invalid radius")),"width"in t&&(n=t.width,ee(0<=n&&n<=y.maxTextureSize,"invalid width")),"height"in t&&(i=t.height,ee(0<=i&&i<=y.maxTextureSize,"invalid height")),"channels"in t&&(a=t.channels,ee(0<a&&a<=4,"invalid number of channels"),o=!0)),e.width=0|n,e.height=0|i,e.channels=0|a;var s=!1;if("format"in t){var u=t.format;ee(c.webgl_depth_texture||!("depth"===u||"depth stencil"===u),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ee.parameter(u,E,"invalid texture format");var f=e.internalformat=E[u];e.format=O[f],u in b&&("type"in t||(e.type=b[u])),u in T&&(e.compressed=!0),s=!0}!o&&s?e.channels=Vt[e.format]:o&&!s?e.channels!==Ht[e.format]&&(e.format=e.internalformat=Ht[e.channels]):s&&o&&ee(e.channels===Vt[e.format],"number of channels inconsistent with specified format")}}function F(e){d.pixelStorei(Dt,e.flipY),d.pixelStorei(Pt,e.premultiplyAlpha),d.pixelStorei(Bt,e.colorSpace),d.pixelStorei(Lt,e.unpackAlignment)}function t(){n.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function f(e,t){var r=null;if(Qt(t)?r=t:t&&(ee.type(t,"object","invalid pixel data type"),N(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),Qt(t.data)&&(r=t.data)),ee(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),t.copy){ee(!r,"can not specify copy and data field for the same texture");var n=A.viewportWidth,i=A.viewportHeight;e.width=e.width||n-e.xOffset,e.height=e.height||i-e.yOffset,e.needsCopy=!0,ee(0<=e.xOffset&&e.xOffset<n&&0<=e.yOffset&&e.yOffset<i&&0<e.width&&e.width<=n&&0<e.height&&e.height<=i,"copy texture read out of bounds")}else if(r){if(J(r))e.channels=e.channels||4,e.data=r,"type"in t||e.type!==ht||(e.type=Jt(r));else if(qt(r))e.channels=e.channels||4,function(e,t){var r=t.length;switch(e.type){case ht:case dt:case pt:case mt:var n=te.allocType(e.type,r);n.set(t),e.data=n;break;case $e:e.data=we(t);break;default:ee.raise("unsupported texture type, must specify a typed array")}}(e,r),e.alignment=1,e.needsFree=!0;else if(re(r)){var a=r.data;Array.isArray(a)||e.type!==ht||(e.type=Jt(a));var o,s,u,f,c,l,h=r.shape,d=r.stride;3===h.length?(u=h[2],l=d[2]):(ee(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),l=u=1),o=h[0],s=h[1],f=d[0],c=d[1],e.alignment=1,e.width=o,e.height=s,e.channels=u,e.format=e.internalformat=Ht[u],e.needsFree=!0,function(e,t,r,n,i,a){for(var o=e.width,s=e.height,u=e.channels,f=$t(e,o*s*u),c=0,l=0;l<s;++l)for(var h=0;h<o;++h)for(var d=0;d<u;++d)f[c++]=t[r*h+n*l+i*d+a];er(e,f)}(e,a,f,c,l,r.offset)}else if(Zt(r)||Yt(r)===Xt)Zt(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(Yt(r)===jt)e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Yt(r)===Wt)e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Yt(r)===zt)e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(Kt(r)){var p=e.width||r[0].length,m=e.height||r.length,_=e.channels;_=Ne(r[0][0])?_||r[0][0].length:_||1;for(var v=ie.shape(r),g=1,b=0;b<v.length;++b)g*=v[b];var E=$t(e,g);ie.flatten(r,v,"",E),er(e,E),e.alignment=1,e.width=p,e.height=m,e.channels=_,e.format=e.internalformat=Ht[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===mt?ee(0<=y.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):e.type===$e&&ee(0<=y.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function i(e,t,r){var n=e.element,i=e.data,a=e.internalformat,o=e.format,s=e.type,u=e.width,f=e.height,c=e.channels;if(F(e),n)d.texImage2D(t,r,o,o,s,n);else if(e.compressed)d.compressedTexImage2D(t,r,a,u,f,0,i);else if(e.needsCopy)h(),d.copyTexImage2D(t,r,o,e.xOffset,e.yOffset,u,f,0);else{var l=!i;l&&(i=te.zero.allocType(s,u*f*c)),d.texImage2D(t,r,o,u,f,0,o,s,i),l&&i&&te.zero.freeType(i)}}function I(e,t,r,n,i){var a=e.element,o=e.data,s=e.internalformat,u=e.format,f=e.type,c=e.width,l=e.height;F(e),a?d.texSubImage2D(t,i,r,n,u,f,a):e.compressed?d.compressedTexSubImage2D(t,i,r,n,s,c,l,o):e.needsCopy?(h(),d.copyTexSubImage2D(t,i,r,n,e.xOffset,e.yOffset,c,l)):d.texSubImage2D(t,i,r,n,c,l,u,f,o)}var a=[];function L(){return a.pop()||new t}function D(e){e.needsFree&&te.freeType(e.data),t.call(e),a.push(e)}function s(){n.call(this),this.genMipmaps=!1,this.mipmapHint=wt,this.mipmask=0,this.images=Array(16)}function P(e,t,r){var n=e.images[0]=L();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function B(e,t){var r=null;if(Qt(t))w(r=e.images[0]=L(),e),f(r,t),e.mipmask=1;else if(N(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)w(r=e.images[i]=L(),e),r.width>>=i,r.height>>=i,f(r,n[i]),e.mipmask|=1<<i;else w(r=e.images[0]=L(),e),f(r,t),e.mipmask=1;w(e,e.images[0]),(e.compressed&&e.internalformat===et||e.internalformat===tt||e.internalformat===rt||e.internalformat===nt)&&ee(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function U(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;i(r[n],t,n)}}var u=[];function k(){var e=u.pop()||new s;n.call(e);for(var t=e.mipmask=0;t<16;++t)e.images[t]=null;return e}function G(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&D(t[r]),t[r]=null;u.push(e)}function H(){this.minFilter=Tt,this.magFilter=Tt,this.wrapS=bt,this.wrapT=bt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=wt}function V(e,t){if("min"in t){var r=t.min;ee.parameter(r,v),e.minFilter=v[r],0<=Gt.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;ee.parameter(n,_),e.magFilter=_[n]}var i=e.wrapS,a=e.wrapT;if("wrap"in t){var o=t.wrap;"string"==typeof o?(ee.parameter(o,m),i=a=m[o]):Array.isArray(o)&&(ee.parameter(o[0],m),ee.parameter(o[1],m),i=m[o[0]],a=m[o[1]])}else{if("wrapS"in t){var s=t.wrapS;ee.parameter(s,m),i=m[s]}if("wrapT"in t){var u=t.wrapT;ee.parameter(u,m),a=m[u]}}if(e.wrapS=i,e.wrapT=a,"anisotropic"in t){var f=t.anisotropic;ee("number"==typeof f&&1<=f&&f<=y.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var c=!1;switch(typeof t.mipmap){case"string":ee.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,c=!0;break;case"boolean":c=e.genMipmaps=t.mipmap;break;case"object":ee(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,c=!0;break;default:ee.raise("invalid mipmap type")}!c||"min"in t||(e.minFilter=Mt)}}function X(e,t){d.texParameteri(t,At,e.minFilter),d.texParameteri(t,yt,e.magFilter),d.texParameteri(t,_t,e.wrapS),d.texParameteri(t,vt,e.wrapT),c.ext_texture_filter_anisotropic&&d.texParameteri(t,It,e.anisotropic),e.genMipmaps&&(d.hint(Ot,e.mipmapHint),d.generateMipmap(t))}var j=0,W={},z=y.maxTextureUnits,q=Array(z).map(function(){return null});function K(e){n.call(this),this.mipmask=0,this.internalformat=Be,this.id=j++,this.refCount=1,this.target=e,this.texture=d.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new H,p.profile&&(this.stats={size:0})}function Y(e){d.activeTexture(kt),d.bindTexture(e.target,e.texture)}function Z(){var e=q[0];e?d.bindTexture(e.target,e.texture):d.bindTexture(Le,null)}function Q(e){var t=e.texture;ee(t,"must not double destroy texture");var r=e.unit,n=e.target;0<=r&&(d.activeTexture(kt+r),d.bindTexture(n,null),q[r]=null),d.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete W[e.id],o.textureCount--}return $(K.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<z;++r){var n=q[r];if(n){if(0<n.bindCount)continue;n.unit=-1}q[r]=e,t=r;break}z<=t&&ee.raise("insufficient number of texture units"),p.profile&&o.maxTextureUnits<t+1&&(o.maxTextureUnits=t+1),e.unit=t,d.activeTexture(kt+t),d.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Q(this)}}),p.profile&&(o.getTotalTextureSize=function(){var t=0;return Object.keys(W).forEach(function(e){t+=W[e].stats.size}),t}),{create2D:function(e,t){var c=new K(Le);function l(e,t){var r=c.texInfo;H.call(r);var n=k();return"number"==typeof e?P(n,0|e,"number"==typeof t?0|t:0|e):e?(ee.type(e,"object","invalid arguments to regl.texture"),V(r,e),B(n,e)):P(n,1,1),r.genMipmaps&&(n.mipmask=(n.width<<1)-1),c.mipmask=n.mipmask,w(c,n),ee.texture2D(r,n,y),c.internalformat=n.internalformat,l.width=n.width,l.height=n.height,Y(c),U(n,Le),X(r,Le),Z(),G(n),p.profile&&(c.stats.size=tr(c.internalformat,c.type,n.width,n.height,r.genMipmaps,!1)),l.format=R[c.internalformat],l.type=M[c.type],l.mag=x[r.magFilter],l.min=S[r.minFilter],l.wrapS=C[r.wrapS],l.wrapT=C[r.wrapT],l}return W[c.id]=c,o.textureCount++,l(e,t),l.subimage=function(e,t,r,n){ee(!!e,"must specify image data");var i=0|t,a=0|r,o=0|n,s=L();return w(s,c),s.width=0,s.height=0,f(s,e),s.width=s.width||(c.width>>o)-i,s.height=s.height||(c.height>>o)-a,ee(c.type===s.type&&c.format===s.format&&c.internalformat===s.internalformat,"incompatible format for texture.subimage"),ee(0<=i&&0<=a&&i+s.width<=c.width&&a+s.height<=c.height,"texture.subimage write out of bounds"),ee(c.mipmask&1<<o,"missing mipmap data"),ee(s.data||s.element||s.needsCopy,"missing image data"),Y(c),I(s,Le,i,a,o),Z(),D(s),l},l.resize=function(e,t){var r,n=0|e,i=0|t||n;if(n===c.width&&i===c.height)return l;l.width=c.width=n,l.height=c.height=i,Y(c);for(var a=c.channels,o=c.type,s=0;c.mipmask>>s;++s){var u=n>>s,f=i>>s;if(!u||!f)break;r=te.zero.allocType(o,u*f*a),d.texImage2D(Le,s,c.format,u,f,0,c.format,c.type,r),r&&te.zero.freeType(r)}return Z(),p.profile&&(c.stats.size=tr(c.internalformat,c.type,n,i,!1,!1)),l},l._reglType="texture2d",l._texture=c,p.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l},createCube:function(e,t,r,n,i,a){var c=new K(De);W[c.id]=c,o.cubeCount++;var l=new Array(6);function h(e,t,r,n,i,a){var o,s=c.texInfo;for(H.call(s),o=0;o<6;++o)l[o]=k();if("number"!=typeof e&&e)if("object"==typeof e)if(t)B(l[0],e),B(l[1],t),B(l[2],r),B(l[3],n),B(l[4],i),B(l[5],a);else if(V(s,e),N(c,e),"faces"in e){var u=e.faces;for(ee(Array.isArray(u)&&6===u.length,"cube faces must be a length 6 array"),o=0;o<6;++o)ee("object"==typeof u[o]&&!!u[o],"invalid input for cube map face"),w(l[o],c),B(l[o],u[o])}else for(o=0;o<6;++o)B(l[o],e);else ee.raise("invalid arguments to cube map");else{var f=0|e||1;for(o=0;o<6;++o)P(l[o],f,f)}for(w(c,l[0]),y.npotTextureCube||ee(Fe(c.width)&&Fe(c.height),"your browser does not support non power or two texture dimensions"),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,ee.textureCube(c,s,l,y),c.internalformat=l[0].internalformat,h.width=l[0].width,h.height=l[0].height,Y(c),o=0;o<6;++o)U(l[o],Pe+o);for(X(s,De),Z(),p.profile&&(c.stats.size=tr(c.internalformat,c.type,h.width,h.height,s.genMipmaps,!0)),h.format=R[c.internalformat],h.type=M[c.type],h.mag=x[s.magFilter],h.min=S[s.minFilter],h.wrapS=C[s.wrapS],h.wrapT=C[s.wrapT],o=0;o<6;++o)G(l[o]);return h}return h(e,t,r,n,i,a),h.subimage=function(e,t,r,n,i){ee(!!t,"must specify image data"),ee("number"==typeof e&&e===(0|e)&&0<=e&&e<6,"invalid face");var a=0|r,o=0|n,s=0|i,u=L();return w(u,c),u.width=0,u.height=0,f(u,t),u.width=u.width||(c.width>>s)-a,u.height=u.height||(c.height>>s)-o,ee(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),ee(0<=a&&0<=o&&a+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),ee(c.mipmask&1<<s,"missing mipmap data"),ee(u.data||u.element||u.needsCopy,"missing image data"),Y(c),I(u,Pe+e,a,o,s),Z(),D(u),h},h.resize=function(e){var t=0|e;if(t!==c.width){h.width=c.width=t,h.height=c.height=t,Y(c);for(var r=0;r<6;++r)for(var n=0;c.mipmask>>n;++n)d.texImage2D(Pe+r,n,c.format,t>>n,t>>n,0,c.format,c.type,null);return Z(),p.profile&&(c.stats.size=tr(c.internalformat,c.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=c,p.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){for(var e=0;e<z;++e)d.activeTexture(kt+e),d.bindTexture(Le,null),q[e]=null;ne(W).forEach(Q),o.cubeCount=0,o.textureCount=0},getTexture:function(e){return null},restore:function(){ne(W).forEach(function(e){e.texture=d.createTexture(),d.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Le)d.texImage2D(Le,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)d.texImage2D(Pe+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);X(e.texInfo,e.target)})}}}H[Ve]=2,H[Xe]=2,H[je]=2,H[Ze]=4,H[et]=.5,H[tt]=.5,H[rt]=1,H[nt]=1,H[it]=.5,H[at]=1,H[ot]=1,H[st]=.5,H[ut]=.25,H[ft]=.5,H[ct]=.25,H[lt]=.5;var nr=36161,ir=32854,V=[];function ar(e,t,r){return V[e]*t*r}V[ir]=2,V[32855]=2,V[36194]=2,V[33189]=2,V[36168]=1,V[34041]=4,V[35907]=4,V[34836]=16,V[34842]=8,V[34843]=6;var or=36160,sr=36161,ur=3553,fr=34069,cr=36064,lr=36096,hr=36128,dr=33306,pr=36053,mr=6402,_r=[6407,6408],vr=[];vr[6408]=4,vr[6407]=3;var gr=[];gr[5121]=1,gr[5126]=4,gr[36193]=2;var br=33189,Er=36168,yr=34041,Ar=[32854,32855,36194,35907,34842,34843,34836],Tr={};Tr[pr]="complete",Tr[36054]="incomplete attachment",Tr[36057]="incomplete dimensions",Tr[36055]="incomplete, missing attachment",Tr[36061]="unsupported";var X=5126;function Rr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=X,this.offset=0,this.stride=0,this.divisor=0}var Mr=35632,xr=35633,Sr=35718,Cr=35721,j=6408,W=5121,Or=3333,wr=5126;function Nr(u,f,c,l,h,d,p){function n(e){var t;null===f.next?(ee(h.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),t=W):(ee(null!==f.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),t=f.next.colorAttachments[0].texture._texture.type,d.oes_texture_float?(ee(t===W||t===wr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),t===wr&&ee(p.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ee(t===W,"Reading from a framebuffer is only allowed for the type 'uint8'"));var r=0,n=0,i=l.framebufferWidth,a=l.framebufferHeight,o=null;J(e)?o=e:e&&(ee.type(e,"object","invalid arguments to regl.read()"),r=0|e.x,n=0|e.y,ee(0<=r&&r<l.framebufferWidth,"invalid x offset for regl.read"),ee(0<=n&&n<l.framebufferHeight,"invalid y offset for regl.read"),i=0|(e.width||l.framebufferWidth-r),a=0|(e.height||l.framebufferHeight-n),o=e.data||null),o&&(t===W?ee(o instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):t===wr&&ee(o instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ee(0<i&&i+r<=l.framebufferWidth,"invalid width for read pixels"),ee(0<a&&a+n<=l.framebufferHeight,"invalid height for read pixels"),c();var s=i*a*4;return o||(t===W?o=new Uint8Array(s):t===wr&&(o=o||new Float32Array(s))),ee.isTypedArray(o,"data buffer for regl.read() must be a typedarray"),ee(o.byteLength>=s,"data buffer for regl.read() too small"),u.pixelStorei(Or,4),u.readPixels(r,n,i,a,j,t,o),o}return function(e){return e&&"framebuffer"in e?(t=e,f.setFBO({framebuffer:t.framebuffer},function(){r=n(t)}),r):n(e);var t,r}}function Fr(e){return Array.prototype.slice.call(e)}function Ir(e){return Fr(e).join("")}var Lr="xyzw".split(""),Dr=5121,Pr=1,Br=2,Ur=0,kr=1,Gr=2,Hr=3,Vr=4,Xr="dither",jr="blend.enable",Wr="blend.color",zr="blend.equation",qr="blend.func",Kr="depth.enable",Yr="depth.func",Zr="depth.range",Qr="depth.mask",Jr="colorMask",$r="cull.enable",en="cull.face",tn="frontFace",rn="lineWidth",nn="polygonOffset.enable",an="polygonOffset.offset",on="sample.alpha",sn="sample.enable",un="sample.coverage",fn="stencil.enable",cn="stencil.mask",ln="stencil.func",hn="stencil.opFront",dn="stencil.opBack",pn="scissor.enable",mn="scissor.box",_n="viewport",vn="profile",gn="framebuffer",bn="vert",En="frag",yn="elements",An="primitive",Tn="count",Rn="offset",Mn="instances",xn="Width",Sn="Height",Cn=gn+xn,On=gn+Sn,wn=_n+xn,Nn=_n+Sn,Fn="drawingBuffer",In=Fn+xn,Ln=Fn+Sn,Dn=[qr,zr,ln,hn,dn,un,_n,mn,an],Pn=34962,Bn=34963,Un=3553,kn=34067,Gn=2884,Hn=3042,Vn=3024,Xn=2960,jn=2929,Wn=3089,zn=32823,qn=32926,Kn=32928,Yn=5126,Zn=35664,Qn=35665,Jn=35666,$n=5124,ei=35667,ti=35668,ri=35669,ni=35670,ii=35671,ai=35672,oi=35673,si=35674,ui=35675,fi=35676,ci=35678,li=35680,hi=4,di=1028,pi=1029,mi=2304,_i=2305,vi=32775,gi=32776,bi=519,Ei=7680,yi=0,Ai=1,Ti=32774,Ri=513,Mi=36160,xi=36064,Si={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ci=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Oi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},wi={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ni={frag:35632,vert:35633},Fi={cw:mi,ccw:_i};function Ii(e){return Array.isArray(e)||J(e)||re(e)}function Li(e){return e.sort(function(e,t){return e===_n?-1:t===_n?1:e<t?-1:1})}function Di(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function Pi(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Bi(e){return new Di(!1,!1,!1,e)}function Ui(e,t){var r=e.type;if(r===Ur){var n=e.data.length;return new Di(!0,1<=n,2<=n,t)}if(r===Vr){var i=e.data;return new Di(i.thisDep,i.contextDep,i.propDep,t)}return new Di(r===Hr,r===Gr,r===kr,t)}var ki=new Di(!1,!1,!1,function(){});function Gi(e,L,t,D,P,B,r,U,n,c,k,i,a,b,o){var G=c.Record,H={add:32774,subtract:32778,"reverse subtract":32779};t.ext_blend_minmax&&(H.min=vi,H.max=gi);var V=t.angle_instanced_arrays,h=t.webgl_draw_buffers,p={dirty:!0,profile:o.profile},s={},X=[],m={},_={};function j(e){return e.replace(".","_")}function u(e,t,r){var n=j(e);X.push(e),s[n]=p[n]=!!r,m[n]=t}function f(e,t,r){var n=j(e);X.push(e),Array.isArray(r)?(p[n]=r.slice(),s[n]=r.slice()):p[n]=s[n]=r,_[n]=t}u(Xr,Vn),u(jr,Hn),f(Wr,"blendColor",[0,0,0,0]),f(zr,"blendEquationSeparate",[Ti,Ti]),f(qr,"blendFuncSeparate",[Ai,yi,Ai,yi]),u(Kr,jn,!0),f(Yr,"depthFunc",Ri),f(Zr,"depthRange",[0,1]),f(Qr,"depthMask",!0),f(Jr,Jr,[!0,!0,!0,!0]),u($r,Gn),f(en,"cullFace",pi),f(tn,tn,_i),f(rn,rn,1),u(nn,zn),f(an,"polygonOffset",[0,0]),u(on,qn),u(sn,Kn),f(un,"sampleCoverage",[1,!1]),u(fn,Xn),f(cn,"stencilMask",-1),f(ln,"stencilFunc",[bi,0,-1]),f(hn,"stencilOpSeparate",[di,Ei,Ei,Ei]),f(dn,"stencilOpSeparate",[pi,Ei,Ei,Ei]),u(pn,Wn),f(mn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),f(_n,_n,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var l={gl:e,context:a,strings:L,next:s,current:p,draw:i,elements:B,buffer:P,shader:k,attributes:c.state,uniforms:n,framebuffer:U,extensions:t,timer:b,isBufferArgs:Ii},d={primTypes:ve,compareFuncs:Oi,blendFuncs:Si,blendEquations:H,stencilOps:wi,glTypes:ae,orientationType:Fi};ee.optional(function(){l.isArrayLike=Ne}),h&&(d.backBuffer=[pi],d.drawBuffer=z(D.maxDrawbuffers,function(e){return 0===e?[0]:z(e,function(e){return xi+e})}));var v=0;function g(){var n=function(){var n=0,i=[],a=[];function o(){var t=[],r=[];return $(function(){t.push.apply(t,Fr(arguments))},{def:function(){var e="v"+n++;return r.push(e),0<arguments.length&&(t.push(e,"="),t.push.apply(t,Fr(arguments)),t.push(";")),e},toString:function(){return Ir([0<r.length?"var "+r+";":"",Ir(t)])}})}function s(){var n=o(),r=o(),e=n.toString,t=r.toString;function i(e,t){r(e,t,"=",n.def(e,t),";")}return $(function(){n.apply(n,Fr(arguments))},{def:n.def,entry:n,exit:r,save:i,set:function(e,t,r){i(e,t),n(e,t,"=",r,";")},toString:function(){return e()+t()}})}var r=o(),u={};return{global:r,link:function(e){for(var t=0;t<a.length;++t)if(a[t]===e)return i[t];var r="g"+n++;return i.push(r),a.push(e),r},block:o,proc:function(e,t){var r=[];function n(){var e="a"+r.length;return r.push(e),e}t=t||0;for(var i=0;i<t;++i)n();var a=s(),o=a.toString;return u[e]=$(a,{arg:n,toString:function(){return Ir(["function(",r.join(),"){",o(),"}"])}})},scope:s,cond:function(){var t=Ir(arguments),e=s(),r=s(),n=e.toString,i=r.toString;return $(e,{then:function(){return e.apply(e,Fr(arguments)),this},else:function(){return r.apply(r,Fr(arguments)),this},toString:function(){var e=i();return e&&(e="else{"+e+"}"),Ir(["if(",t,"){",n(),"}",e])}})},compile:function(){var t=['"use strict";',r,"return {"];Object.keys(u).forEach(function(e){t.push('"',e,'":',u[e].toString(),",")}),t.push("}");var e=Ir(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,i.concat(e)).apply(null,a)}}}(),i=n.link,t=n.global;n.id=v++,n.batchId="0";var r=i(l),a=n.shared={props:"a0"};Object.keys(l).forEach(function(e){a[e]=t.def(r,".",e)}),ee.optional(function(){n.CHECK=i(ee),n.commandStr=ee.guessCommand(),n.command=i(n.commandStr),n.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",i(r),",",this.command,");")},d.invalidBlendCombinations=Ci});var o=n.next={},s=n.current={};Object.keys(_).forEach(function(e){Array.isArray(p[e])&&(o[e]=t.def(a.next,".",e),s[e]=t.def(a.current,".",e))});var u=n.constants={};Object.keys(d).forEach(function(e){u[e]=t.def(JSON.stringify(d[e]))}),n.invoke=function(e,t){switch(t.type){case Ur:var r=["this",a.context,a.props,n.batchId];return e.def(i(t.data),".call(",r.slice(0,Math.max(t.data.length+1,4)),")");case kr:return e.def(a.props,t.data);case Gr:return e.def(a.context,t.data);case Hr:return e.def("this",t.data);case Vr:return t.data.append(n,e),t.data.ref}},n.attribCache={};var f={};return n.scopeAttrib=function(e){var t=L.id(e);if(t in f)return f[t];var r=c.scope[t];r||(r=c.scope[t]=new G);var n=f[t]=i(r);return n},n}function E(e,t,r,n,i){var a=e.static,o=e.dynamic;ee.optional(function(){var t=[gn,bn,En,yn,An,Rn,Tn,Mn,vn].concat(X);function e(e){Object.keys(e).forEach(function(e){ee.command(0<=t.indexOf(e),'unknown parameter "'+e+'"',i.commandStr)})}e(a),e(o)});var s,u,c,l,h,f=function(e,t){var r=e.static,n=e.dynamic;if(gn in r){var a=r[gn];return a?(a=U.getFramebuffer(a),ee.command(a,"invalid framebuffer object"),Bi(function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Cn,r+".width"),t.set(i,"."+On,r+".height"),r})):Bi(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Cn,n+"."+In),t.set(n,"."+On,n+"."+Ln),"null"})}if(gn in n){var s=n[gn];return Ui(s,function(e,t){var r=e.invoke(t,s),n=e.shared,i=n.framebuffer,a=t.def(i,".getFramebuffer(",r,")");ee.optional(function(){e.assert(t,"!"+r+"||"+a,"invalid framebuffer object")}),t.set(i,".next",a);var o=n.context;return t.set(o,"."+Cn,a+"?"+a+".width:"+o+"."+In),t.set(o,"."+On,a+"?"+a+".height:"+o+"."+Ln),a})}return null}(e),d=function(e,r,n){var i=e.static,h=e.dynamic;function t(u){if(u in i){var a=i[u];ee.commandType(a,"object","invalid "+u,n.commandStr);var o,s,e=!0,f=0|a.x,c=0|a.y;return"width"in a?(o=0|a.width,ee.command(0<=o,"invalid "+u,n.commandStr)):e=!1,"height"in a?(s=0|a.height,ee.command(0<=s,"invalid "+u,n.commandStr)):e=!1,new Di(!e&&r&&r.thisDep,!e&&r&&r.contextDep,!e&&r&&r.propDep,function(e,t){var r=e.shared.context,n=o;"width"in a||(n=t.def(r,".",Cn,"-",f));var i=s;return"height"in a||(i=t.def(r,".",On,"-",c)),[f,c,n,i]})}if(u in h){var l=h[u],t=Ui(l,function(e,t){var r=e.invoke(t,l);ee.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid "+u)});var n=e.shared.context,i=t.def(r,".x|0"),a=t.def(r,".y|0"),o=t.def('"width" in ',r,"?",r,".width|0:","(",n,".",Cn,"-",i,")"),s=t.def('"height" in ',r,"?",r,".height|0:","(",n,".",On,"-",a,")");return ee.optional(function(){e.assert(t,o+">=0&&"+s+">=0","invalid "+u)}),[i,a,o,s]});return r&&(t.thisDep=t.thisDep||r.thisDep,t.contextDep=t.contextDep||r.contextDep,t.propDep=t.propDep||r.propDep),t}return r?new Di(r.thisDep,r.contextDep,r.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Cn),t.def(r,".",On)]}):null}var a=t(_n);if(a){var o=a;a=new Di(a.thisDep,a.contextDep,a.propDep,function(e,t){var r=o.append(e,t),n=e.shared.context;return t.set(n,"."+wn,r[2]),t.set(n,"."+Nn,r[3]),r})}return{viewport:a,scissor_box:t(mn)}}(e,f,i),p=function(e,o){var s=e.static,u=e.dynamic,f=function(){if(yn in s){var n=s[yn];Ii(n)?n=B.getElements(B.create(n,!0)):n&&(n=B.getElements(n),ee.command(n,"invalid elements",o.commandStr));var e=Bi(function(e,t){if(n){var r=e.link(n);return e.ELEMENTS=r}return e.ELEMENTS=null});return e.value=n,e}if(yn in u){var f=u[yn];return Ui(f,function(e,t){var r=e.shared,n=r.isBufferArgs,i=r.elements,a=e.invoke(t,f),o=t.def("null"),s=t.def(n,"(",a,")"),u=e.cond(s).then(o,"=",i,".createStream(",a,");").else(o,"=",i,".getElements(",a,");");return ee.optional(function(){e.assert(u.else,"!"+a+"||"+o,"invalid elements")}),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",o,");")),e.ELEMENTS=o})}return null}();function t(n,i){if(n in s){var r=0|s[n];return ee.command(!i||0<=r,"invalid "+n,o.commandStr),Bi(function(e,t){return i&&(e.OFFSET=r),r})}if(n in u){var a=u[n];return Ui(a,function(e,t){var r=e.invoke(t,a);return i&&(e.OFFSET=r,ee.optional(function(){e.assert(t,r+">=0","invalid "+n)})),r})}return i&&f?Bi(function(e,t){return e.OFFSET="0",0}):null}var i=t(Rn,!0);return{elements:f,primitive:function(){if(An in s){var r=s[An];return ee.commandParameter(r,ve,"invalid primitve",o.commandStr),Bi(function(e,t){return ve[r]})}if(An in u){var i=u[An];return Ui(i,function(e,t){var r=e.constants.primTypes,n=e.invoke(t,i);return ee.optional(function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(ve))}),t.def(r,"[",n,"]")})}return f?Pi(f)?f.value?Bi(function(e,t){return t.def(e.ELEMENTS,".primType")}):Bi(function(){return hi}):new Di(f.thisDep,f.contextDep,f.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",hi)}):null}(),count:function(){if(Tn in s){var e=0|s[Tn];return ee.command("number"==typeof e&&0<=e,"invalid vertex count",o.commandStr),Bi(function(){return e})}if(Tn in u){var n=u[Tn];return Ui(n,function(e,t){var r=e.invoke(t,n);return ee.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(f){if(Pi(f)){if(f)return i?new Di(i.thisDep,i.contextDep,i.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ee.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):Bi(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var t=Bi(function(){return-1});return ee.optional(function(){t.MISSING=!0}),t}var r=new Di(f.thisDep||i.thisDep,f.contextDep||i.contextDep,f.propDep||i.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return ee.optional(function(){r.DYNAMIC=!0}),r}return null}(),instances:t(Mn,!1),offset:i}}(e,i),m=(u=i,c=(s=e).static,l=s.dynamic,h={},X.forEach(function(f){var a=j(f);function e(e,r){if(f in c){var t=e(c[f]);h[a]=Bi(function(){return t})}else if(f in l){var n=l[f];h[a]=Ui(n,function(e,t){return r(e,t,e.invoke(t,n))})}}switch(f){case $r:case jr:case Xr:case fn:case Kr:case pn:case nn:case on:case sn:case Qr:return e(function(e){return ee.commandType(e,"boolean",f,u.commandStr),e},function(e,t,r){return ee.optional(function(){e.assert(t,"typeof "+r+'==="boolean"',"invalid flag "+f,e.commandStr)}),r});case Yr:return e(function(e){return ee.commandParameter(e,Oi,"invalid "+f,u.commandStr),Oi[e]},function(e,t,r){var n=e.constants.compareFuncs;return ee.optional(function(){e.assert(t,r+" in "+n,"invalid "+f+", must be one of "+Object.keys(Oi))}),t.def(n,"[",r,"]")});case Zr:return e(function(e){return ee.command(Ne(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",u.commandStr),e},function(e,t,r){return ee.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]});case qr:return e(function(e){ee.commandType(e,"object","blend.func",u.commandStr);var t="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,n="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return ee.commandParameter(t,Si,a+".srcRGB",u.commandStr),ee.commandParameter(r,Si,a+".srcAlpha",u.commandStr),ee.commandParameter(n,Si,a+".dstRGB",u.commandStr),ee.commandParameter(i,Si,a+".dstAlpha",u.commandStr),ee.command(-1===Ci.indexOf(t+", "+n),"unallowed blending combination (srcRGB, dstRGB) = ("+t+", "+n+")",u.commandStr),[Si[t],Si[n],Si[r],Si[i]]},function(n,i,a){var o=n.constants.blendFuncs;function e(e,t){var r=i.def('"',e,t,'" in ',a,"?",a,".",e,t,":",a,".",e);return ee.optional(function(){n.assert(i,r+" in "+o,"invalid "+f+"."+e+t+", must be one of "+Object.keys(Si))}),r}ee.optional(function(){n.assert(i,a+"&&typeof "+a+'==="object"',"invalid blend func, must be an object")});var t=e("src","RGB"),r=e("dst","RGB");ee.optional(function(){var e=n.constants.invalidBlendCombinations;n.assert(i,e+".indexOf("+t+'+", "+'+r+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var s=i.def(o,"[",t,"]"),u=i.def(o,"[",e("src","Alpha"),"]");return[s,i.def(o,"[",r,"]"),u,i.def(o,"[",e("dst","Alpha"),"]")]});case zr:return e(function(e){return"string"==typeof e?(ee.commandParameter(e,H,"invalid "+f,u.commandStr),[H[e],H[e]]):"object"==typeof e?(ee.commandParameter(e.rgb,H,f+".rgb",u.commandStr),ee.commandParameter(e.alpha,H,f+".alpha",u.commandStr),[H[e.rgb],H[e.alpha]]):void ee.commandRaise("invalid blend.equation",u.commandStr)},function(n,e,t){var i=n.constants.blendEquations,r=e.def(),a=e.def(),o=n.cond("typeof ",t,'==="string"');return ee.optional(function(){function e(e,t,r){n.assert(e,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(H))}e(o.then,f,t),n.assert(o.else,t+"&&typeof "+t+'==="object"',"invalid "+f),e(o.else,f+".rgb",t+".rgb"),e(o.else,f+".alpha",t+".alpha")}),o.then(r,"=",a,"=",i,"[",t,"];"),o.else(r,"=",i,"[",t,".rgb];",a,"=",i,"[",t,".alpha];"),e(o),[r,a]});case Wr:return e(function(t){return ee.command(Ne(t)&&4===t.length,"blend.color must be a 4d array",u.commandStr),z(4,function(e){return+t[e]})},function(e,t,r){return ee.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),z(4,function(e){return t.def("+",r,"[",e,"]")})});case cn:return e(function(e){return ee.commandType(e,"number",a,u.commandStr),0|e},function(e,t,r){return ee.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case ln:return e(function(e){ee.commandType(e,"object",a,u.commandStr);var t=e.cmp||"keep",r=e.ref||0,n="mask"in e?e.mask:-1;return ee.commandParameter(t,Oi,f+".cmp",u.commandStr),ee.commandType(r,"number",f+".ref",u.commandStr),ee.commandType(n,"number",f+".mask",u.commandStr),[Oi[t],r,n]},function(t,r,n){var i=t.constants.compareFuncs;return ee.optional(function(){function e(){t.assert(r,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(n+"&&typeof ",n,'==="object"'),e('!("cmp" in ',n,")||(",n,".cmp in ",i,")")}),[r.def('"cmp" in ',n,"?",i,"[",n,".cmp]",":",Ei),r.def(n,".ref|0"),r.def('"mask" in ',n,"?",n,".mask|0:-1")]});case hn:case dn:return e(function(e){ee.commandType(e,"object",a,u.commandStr);var t=e.fail||"keep",r=e.zfail||"keep",n=e.zpass||"keep";return ee.commandParameter(t,wi,f+".fail",u.commandStr),ee.commandParameter(r,wi,f+".zfail",u.commandStr),ee.commandParameter(n,wi,f+".zpass",u.commandStr),[f===dn?pi:di,wi[t],wi[r],wi[n]]},function(t,r,n){var i=t.constants.stencilOps;function e(e){return ee.optional(function(){t.assert(r,'!("'+e+'" in '+n+")||("+n+"."+e+" in "+i+")","invalid "+f+"."+e+", must be one of "+Object.keys(wi))}),r.def('"',e,'" in ',n,"?",i,"[",n,".",e,"]:",Ei)}return ee.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+f)}),[f===dn?pi:di,e("fail"),e("zfail"),e("zpass")]});case an:return e(function(e){ee.commandType(e,"object",a,u.commandStr);var t=0|e.factor,r=0|e.units;return ee.commandType(t,"number",a+".factor",u.commandStr),ee.commandType(r,"number",a+".units",u.commandStr),[t,r]},function(e,t,r){return ee.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid "+f)}),[t.def(r,".factor|0"),t.def(r,".units|0")]});case en:return e(function(e){var t=0;return"front"===e?t=di:"back"===e&&(t=pi),ee.command(!!t,a,u.commandStr),t},function(e,t,r){return ee.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',di,":",pi)});case rn:return e(function(e){return ee.command("number"==typeof e&&e>=D.lineWidthDims[0]&&e<=D.lineWidthDims[1],"invalid line width, must be a positive number between "+D.lineWidthDims[0]+" and "+D.lineWidthDims[1],u.commandStr),e},function(e,t,r){return ee.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+D.lineWidthDims[0]+"&&"+r+"<="+D.lineWidthDims[1],"invalid line width")}),r});case tn:return e(function(e){return ee.commandParameter(e,Fi,a,u.commandStr),Fi[e]},function(e,t,r){return ee.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+mi+":"+_i)});case Jr:return e(function(e){return ee.command(Ne(e)&&4===e.length,"color.mask must be length 4 array",u.commandStr),e.map(function(e){return!!e})},function(e,t,r){return ee.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}),z(4,function(e){return"!!"+r+"["+e+"]"})});case un:return e(function(e){ee.command("object"==typeof e&&e,a,u.commandStr);var t="value"in e?e.value:1,r=!!e.invert;return ee.command("number"==typeof t&&0<=t&&t<=1,"sample.coverage.value must be a number between 0 and 1",u.commandStr),[t,r]},function(e,t,r){return ee.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]})}}),h),_=function(e){var r=e.static,n=e.dynamic;function t(i){if(i in r){var e=L.id(r[i]);ee.optional(function(){k.shader(Ni[i],e,ee.guessCommand())});var t=Bi(function(){return e});return t.id=e,t}if(i in n){var a=n[i];return Ui(a,function(e,t){var r=e.invoke(t,a),n=t.def(e.shared.strings,".id(",r,")");return ee.optional(function(){t(e.shared.shader,".shader(",Ni[i],",",n,",",e.command,");")}),n})}return null}var i,o=t(En),s=t(bn),a=null;return Pi(o)&&Pi(s)?(a=k.program(s.id,o.id),i=Bi(function(e,t){return e.link(a)})):i=new Di(o&&o.thisDep||s&&s.thisDep,o&&o.contextDep||s&&s.contextDep,o&&o.propDep||s&&s.propDep,function(e,t){var r,n,i=e.shared.shader;r=o?o.append(e,t):t.def(i,".",En),n=s?s.append(e,t):t.def(i,".",bn);var a=i+".program("+n+","+r;return ee.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:o,vert:s,progVar:i,program:a}}(e);function v(e){var t=d[e];t&&(m[e]=t)}v(_n),v(j(mn));var g,b,E,y,A,T,R,M,x,S,C,O,w,N,F=0<Object.keys(m).length,I={framebuffer:f,draw:p,shader:_,state:m,dirty:F};return I.profile=function(e){var t,r=e.static,n=e.dynamic;if(vn in r){var i=!!r[vn];(t=Bi(function(e,t){return i})).enable=i}else if(vn in n){var a=n[vn];t=Ui(a,function(e,t){return e.invoke(t,a)})}return t}(e),I.uniforms=(b=i,E=(g=r).static,y=g.dynamic,A={},Object.keys(E).forEach(function(r){var e,n=E[r];if("number"==typeof n||"boolean"==typeof n)e=Bi(function(){return n});else if("function"==typeof n){var t=n._reglType;"texture2d"===t||"textureCube"===t?e=Bi(function(e){return e.link(n)}):"framebuffer"===t||"framebufferCube"===t?(ee.command(0<n.color.length,'missing color attachment for framebuffer sent to uniform "'+r+'"',b.commandStr),e=Bi(function(e){return e.link(n.color[0])})):ee.commandRaise('invalid data for uniform "'+r+'"',b.commandStr)}else Ne(n)?e=Bi(function(t){return t.global.def("[",z(n.length,function(e){return ee.command("number"==typeof n[e]||"boolean"==typeof n[e],"invalid uniform "+r,t.commandStr),n[e]}),"]")}):ee.commandRaise('invalid or missing data for uniform "'+r+'"',b.commandStr);e.value=n,A[r]=e}),Object.keys(y).forEach(function(e){var r=y[e];A[e]=Ui(r,function(e,t){return e.invoke(t,r)})}),A),I.attributes=(R=i,M=(T=t).static,x=T.dynamic,S={},Object.keys(M).forEach(function(n){var e=M[n],i=L.id(n),a=new G;if(Ii(e))a.state=Pr,a.buffer=P.getBuffer(P.create(e,Pn,!1,!0)),a.type=0;else{var t=P.getBuffer(e);if(t)a.state=Pr,a.buffer=t,a.type=0;else if(ee.command("object"==typeof e&&e,"invalid data for attribute "+n,R.commandStr),"constant"in e){var r=e.constant;a.buffer="null",a.state=Br,"number"==typeof r?a.x=r:(ee.command(Ne(r)&&0<r.length&&r.length<=4,"invalid constant for attribute "+n,R.commandStr),Lr.forEach(function(e,t){t<r.length&&(a[e]=r[t])}))}else{t=Ii(e.buffer)?P.getBuffer(P.create(e.buffer,Pn,!1,!0)):P.getBuffer(e.buffer),ee.command(!!t,'missing buffer for attribute "'+n+'"',R.commandStr);var o=0|e.offset;ee.command(0<=o,'invalid offset for attribute "'+n+'"',R.commandStr);var s=0|e.stride;ee.command(0<=s&&s<256,'invalid stride for attribute "'+n+'", must be integer betweeen [0, 255]',R.commandStr);var u=0|e.size;ee.command(!("size"in e)||0<u&&u<=4,'invalid size for attribute "'+n+'", must be 1,2,3,4',R.commandStr);var f=!!e.normalized,c=0;"type"in e&&(ee.commandParameter(e.type,ae,"invalid type for attribute "+n,R.commandStr),c=ae[e.type]);var l=0|e.divisor;"divisor"in e&&(ee.command(0===l||V,'cannot specify divisor for attribute "'+n+'", instancing not supported',R.commandStr),ee.command(0<=l,'invalid divisor for attribute "'+n+'"',R.commandStr)),ee.optional(function(){var t=R.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(e).forEach(function(e){ee.command(0<=r.indexOf(e),'unknown parameter "'+e+'" for attribute pointer "'+n+'" (valid parameters are '+r+")",t)})}),a.buffer=t,a.state=Pr,a.size=u,a.normalized=f,a.type=c||t.dtype,a.offset=o,a.stride=s,a.divisor=l}}S[n]=Bi(function(e,t){var r=e.attribCache;if(i in r)return r[i];var n={isStream:!1};return Object.keys(a).forEach(function(e){n[e]=a[e]}),a.buffer&&(n.buffer=e.link(a.buffer),n.type=n.type||n.buffer+".dtype"),r[i]=n})}),Object.keys(x).forEach(function(l){var h=x[l];S[l]=Ui(h,function(e,t){var r=e.invoke(t,h),n=e.shared,i=n.isBufferArgs,a=n.buffer;ee.optional(function(){e.assert(t,r+"&&(typeof "+r+'==="object"||typeof '+r+'==="function")&&('+i+"("+r+")||"+a+".getBuffer("+r+")||"+a+".getBuffer("+r+".buffer)||"+i+"("+r+'.buffer)||("constant" in '+r+"&&(typeof "+r+'.constant==="number"||'+n.isArrayLike+"("+r+".constant))))",'invalid dynamic attribute "'+l+'"')});var o={isStream:t.def(!1)},s=new G;s.state=Pr,Object.keys(s).forEach(function(e){o[e]=t.def(""+s[e])});var u=o.buffer,f=o.type;function c(e){t(o[e],"=",r,".",e,"|0;")}return t("if(",i,"(",r,")){",o.isStream,"=true;",u,"=",a,".createStream(",Pn,",",r,");",f,"=",u,".dtype;","}else{",u,"=",a,".getBuffer(",r,");","if(",u,"){",f,"=",u,".dtype;",'}else if("constant" in ',r,"){",o.state,"=",Br,";","if(typeof "+r+'.constant === "number"){',o[Lr[0]],"=",r,".constant;",Lr.slice(1).map(function(e){return o[e]}).join("="),"=0;","}else{",Lr.map(function(e,t){return o[e]+"="+r+".constant.length>"+t+"?"+r+".constant["+t+"]:0;"}).join(""),"}}else{","if(",i,"(",r,".buffer)){",u,"=",a,".createStream(",Pn,",",r,".buffer);","}else{",u,"=",a,".getBuffer(",r,".buffer);","}",f,'="type" in ',r,"?",n.glTypes,"[",r,".type]:",u,".dtype;",o.normalized,"=!!",r,".normalized;"),c("size"),c("offset"),c("stride"),c("divisor"),t("}}"),t.exit("if(",o.isStream,"){",a,".destroyStream(",u,");","}"),o})}),S),I.context=(O=(C=n).static,w=C.dynamic,N={},Object.keys(O).forEach(function(e){var r=O[e];N[e]=Bi(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(w).forEach(function(e){var r=w[e];N[e]=Ui(r,function(e,t){return e.invoke(t,r)})}),N),I}function y(r,n,i){var e=r.shared,a=e.context,o=r.scope();Object.keys(i).forEach(function(e){n.save(a,"."+e);var t=i[e];o(a,".",e,"=",t.append(r,n),";")}),n(o)}function A(e,t,r,n){var i,a=e.shared,o=a.gl,s=a.framebuffer;h&&(i=t.def(a.extensions,".webgl_draw_buffers"));var u,f=e.constants,c=f.drawBuffer,l=f.backBuffer;u=r?r.append(e,t):t.def(s,".next"),n||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Mi,",",u,".framebuffer);"),h&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Mi,",null);"),h&&t(i,".drawBuffersWEBGL(",l,");"),t("}",s,".cur=",u,";"),n||t("}")}function T(o,e,s){var t=o.shared,u=t.gl,f=o.current,c=o.next,l=t.current,h=t.next,d=o.cond(l,".dirty");X.forEach(function(e){var t,r,n=j(e);if(!(n in s.state))if(n in c){t=c[n],r=f[n];var i=z(p[n].length,function(e){return d.def(t,"[",e,"]")});d(o.cond(i.map(function(e,t){return e+"!=="+r+"["+t+"]"}).join("||")).then(u,".",_[n],"(",i,");",i.map(function(e,t){return r+"["+t+"]="+e}).join(";"),";"))}else{t=d.def(h,".",n);var a=o.cond(t,"!==",l,".",n);d(a),n in m?a(o.cond(t).then(u,".enable(",m[n],");").else(u,".disable(",m[n],");"),l,".",n,"=",t,";"):a(u,".",_[n],"(",t,");",l,".",n,"=",t,";")}}),0===Object.keys(s.state).length&&d(l,".dirty=false;"),e(d)}function R(a,o,s,u){var e=a.shared,f=a.current,c=e.current,l=e.gl;Li(Object.keys(s)).forEach(function(e){var t=s[e];if(!u||u(t)){var r=t.append(a,o);if(m[e]){var n=m[e];Pi(t)?o(l,r?".enable(":".disable(",n,");"):o(a.cond(r).then(l,".enable(",n,");").else(l,".disable(",n,");")),o(c,".",e,"=",r,";")}else if(Ne(r)){var i=f[e];o(l,".",_[e],"(",r,");",r.map(function(e,t){return i+"["+t+"]="+e}).join(";"),";")}else o(l,".",_[e],"(",r,");",c,".",e,"=",r,";")}})}function M(e,t){V&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function x(e,r,t,n,i){var a,o,s,u=e.shared,f=e.stats,c=u.current,l=u.timer,h=t.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function p(e){a=r.def(),e(a,"=",d(),";"),"string"==typeof i?e(f,".count+=",i,";"):e(f,".count++;"),b&&(n?(o=r.def(),e(o,"=",l,".getNumPendingQueries();")):e(l,".beginQuery(",f,");"))}function m(e){e(f,".cpuTime+=",d(),"-",a,";"),b&&(n?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",f,");"):e(l,".endQuery();"))}function _(e){var t=r.def(c,".profile");r(c,".profile=",e,";"),r.exit(c,".profile=",t,";")}if(h){if(Pi(h))return void(h.enable?(p(r),m(r.exit),_("true")):_("false"));_(s=h.append(e,r))}else s=r.def(c,".profile");var v=e.block();p(v),r("if(",s,"){",v,"}");var g=e.block();m(g),r.exit("if(",s,"){",g,"}")}function S(h,d,a,e,o){var p=h.shared;e.forEach(function(e){var t,r=e.name,n=a.attributes[r];if(n){if(!o(n))return;t=n.append(h,d)}else{if(!o(ki))return;var i=h.scopeAttrib(r);ee.optional(function(){h.assert(d,i+".state","missing attribute "+r)}),t={},Object.keys(new G).forEach(function(e){t[e]=d.def(i,".",e)})}!function(e,n,i){var a=p.gl,o=d.def(e,".location"),s=d.def(p.attributes,"[",o,"]"),t=i.state,u=i.buffer,r=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function c(){d("if(!",s,".buffer){",a,".enableVertexAttribArray(",o,");}");var e,t=i.type;if(e=i.size?d.def(i.size,"||",n):n,d("if(",s,".type!==",t,"||",s,".size!==",e,"||",f.map(function(e){return s+"."+e+"!=="+i[e]}).join("||"),"){",a,".bindBuffer(",Pn,",",u,".buffer);",a,".vertexAttribPointer(",[o,e,t,i.normalized,i.stride,i.offset],");",s,".type=",t,";",s,".size=",e,";",f.map(function(e){return s+"."+e+"="+i[e]+";"}).join(""),"}"),V){var r=i.divisor;d("if(",s,".divisor!==",r,"){",h.instancing,".vertexAttribDivisorANGLE(",[o,r],");",s,".divisor=",r,";}")}}function l(){d("if(",s,".buffer){",a,".disableVertexAttribArray(",o,");","}if(",Lr.map(function(e,t){return s+"."+e+"!=="+r[t]}).join("||"),"){",a,".vertexAttrib4f(",o,",",r,");",Lr.map(function(e,t){return s+"."+e+"="+r[t]+";"}).join(""),"}")}t===Pr?c():t===Br?l():(d("if(",t,"===",Pr,"){"),c(),d("}else{"),l(),d("}"))}(h.link(e),function(e){switch(e){case Zn:case ei:case ii:return 2;case Qn:case ti:case ai:return 3;case Jn:case ri:case oi:return 4;default:return 1}}(e.info.type),t)})}function C(i,a,e,t,r){for(var n,o=i.shared,s=o.gl,u=0;u<t.length;++u){var f,c=t[u],l=c.name,h=c.info.type,d=e.uniforms[l],p=i.link(c),m=p+".location";if(d){if(!r(d))continue;if(Pi(d)){var _=d.value;if(ee.command(null!=_,'missing uniform "'+l+'"',i.commandStr),h===ci||h===li){ee.command("function"==typeof _&&(h===ci&&("texture2d"===_._reglType||"framebuffer"===_._reglType)||h===li&&("textureCube"===_._reglType||"framebufferCube"===_._reglType)),"invalid texture for uniform "+l,i.commandStr);var v=i.link(_._texture||_.color[0]._texture);a(s,".uniform1i(",m,",",v+".bind());"),a.exit(v,".unbind();")}else if(h===si||h===ui||h===fi){ee.optional(function(){ee.command(Ne(_),"invalid matrix for uniform "+l,i.commandStr),ee.command(h===si&&4===_.length||h===ui&&9===_.length||h===fi&&16===_.length,"invalid length for matrix uniform "+l,i.commandStr)});var g=i.global.def("new Float32Array(["+Array.prototype.slice.call(_)+"])"),b=2;h===ui?b=3:h===fi&&(b=4),a(s,".uniformMatrix",b,"fv(",m,",false,",g,");")}else{switch(h){case Yn:ee.commandType(_,"number","uniform "+l,i.commandStr),n="1f";break;case Zn:ee.command(Ne(_)&&2===_.length,"uniform "+l,i.commandStr),n="2f";break;case Qn:ee.command(Ne(_)&&3===_.length,"uniform "+l,i.commandStr),n="3f";break;case Jn:ee.command(Ne(_)&&4===_.length,"uniform "+l,i.commandStr),n="4f";break;case ni:ee.commandType(_,"boolean","uniform "+l,i.commandStr),n="1i";break;case $n:ee.commandType(_,"number","uniform "+l,i.commandStr),n="1i";break;case ii:case ei:ee.command(Ne(_)&&2===_.length,"uniform "+l,i.commandStr),n="2i";break;case ai:case ti:ee.command(Ne(_)&&3===_.length,"uniform "+l,i.commandStr),n="3i";break;case oi:case ri:ee.command(Ne(_)&&4===_.length,"uniform "+l,i.commandStr),n="4i"}a(s,".uniform",n,"(",m,",",Ne(_)?Array.prototype.slice.call(_):_,");")}continue}f=d.append(i,a)}else{if(!r(ki))continue;f=a.def(o.uniforms,"[",L.id(l),"]")}h===ci?a("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}"):h===li&&a("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}"),ee.optional(function(){function r(e,t){i.assert(a,e,'bad data or missing for uniform "'+l+'".  '+t)}function e(e){r("typeof "+f+'==="'+e+'"',"invalid type, expected "+e)}function t(e,t){r(o.isArrayLike+"("+f+")&&"+f+".length==="+e,"invalid vector, should have length "+e,i.commandStr)}function n(e){r("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(e===Un?"2d":"Cube")+'"',"invalid texture type",i.commandStr)}switch(h){case $n:e("number");break;case ei:t(2);break;case ti:t(3);break;case ri:t(4);break;case Yn:e("number");break;case Zn:t(2);break;case Qn:t(3);break;case Jn:t(4);break;case ni:e("boolean");break;case ii:t(2);break;case ai:t(3);break;case oi:case si:t(4);break;case ui:t(9);break;case fi:t(16);break;case ci:n(Un);break;case li:n(kn)}});var E=1;switch(h){case ci:case li:var y=a.def(f,"._texture");a(s,".uniform1i(",m,",",y,".bind());"),a.exit(y,".unbind();");continue;case $n:case ni:n="1i";break;case ei:case ii:n="2i",E=2;break;case ti:case ai:n="3i",E=3;break;case ri:case oi:n="4i",E=4;break;case Yn:n="1f";break;case Zn:n="2f",E=2;break;case Qn:n="3f",E=3;break;case Jn:n="4f",E=4;break;case si:n="Matrix2fv";break;case ui:n="Matrix3fv";break;case fi:n="Matrix4fv"}if(a(s,".uniform",n,"(",m,","),"M"===n.charAt(0)){var A=Math.pow(h-si+2,2),T=i.global.def("new Float32Array(",A,")");a("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",z(A,function(e){return T+"["+e+"]="+f+"["+e+"]"}),",",T,")")}else a(1<E?z(E,function(e){return f+"["+e+"]"}):f);a(");")}}function O(r,n,i,a){var e,t,o,s=r.shared,u=s.gl,f=s.draw,c=a.draw,l=(t=c.elements,o=n,t?((t.contextDep&&a.contextDynamic||t.propDep)&&(o=i),e=t.append(r,o)):e=o.def(f,".",yn),e&&o("if("+e+")"+u+".bindBuffer("+Bn+","+e+".buffer.buffer);"),e);function h(e){var t=c[e];return t?t.contextDep&&a.contextDynamic||t.propDep?t.append(r,i):t.append(r,n):n.def(f,".",e)}var d,p,m,_,v,g=h(An),b=h(Rn),E=(_=c.count,v=n,_?((_.contextDep&&a.contextDynamic||_.propDep)&&(v=i),m=_.append(r,v),ee.optional(function(){_.MISSING&&r.assert(n,"false","missing vertex count"),_.DYNAMIC&&r.assert(v,m+">=0","missing vertex count")})):(m=v.def(f,".",Tn),ee.optional(function(){r.assert(v,m+">=0","missing vertex count")})),m);if("number"==typeof E){if(0===E)return}else i("if(",E,"){"),i.exit("}");V&&(d=h(Mn),p=r.instancing);var y=l+".type",A=c.elements&&Pi(c.elements);function T(){function e(){i(p,".drawElementsInstancedANGLE(",[g,E,y,b+"<<(("+y+"-"+Dr+")>>1)",d],");")}function t(){i(p,".drawArraysInstancedANGLE(",[g,b,E,d],");")}l?A?e():(i("if(",l,"){"),e(),i("}else{"),t(),i("}")):t()}function R(){function e(){i(u+".drawElements("+[g,E,y,b+"<<(("+y+"-"+Dr+")>>1)"]+");")}function t(){i(u+".drawArrays("+[g,b,E]+");")}l?A?e():(i("if(",l,"){"),e(),i("}else{"),t(),i("}")):t()}V&&("number"!=typeof d||0<=d)?"string"==typeof d?(i("if(",d,">0){"),T(),i("}else if(",d,"<0){"),R(),i("}")):T():R()}function w(e,t,r,n,i){var a=g(),o=a.proc("body",i);return ee.optional(function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)}),V&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,r,n),a.compile().body}function N(e,t,r,n){M(e,t),S(e,t,r,n.attributes,function(){return!0}),C(e,t,r,n.uniforms,function(){return!0}),O(e,t,t,r)}function F(e,t,r,n){function i(){return!0}e.batchId="a1",M(e,t),S(e,t,r,n.attributes,i),C(e,t,r,n.uniforms,i),O(e,t,t,r)}function I(t,e,r,n){M(t,e);var i=r.contextDep,a=e.def(),o=e.def();t.shared.props=o,t.batchId=a;var s=t.scope(),u=t.scope();function f(e){return e.contextDep&&i||e.propDep}function c(e){return!f(e)}if(e(s.entry,"for(",a,"=0;",a,"<","a1",";++",a,"){",o,"=","a0","[",a,"];",u,"}",s.exit),r.needsContext&&y(t,u,r.context),r.needsFramebuffer&&A(t,u,r.framebuffer),R(t,u,r.state,f),r.profile&&f(r.profile)&&x(t,u,r,!1,!0),n)S(t,s,r,n.attributes,c),S(t,u,r,n.attributes,f),C(t,s,r,n.uniforms,c),C(t,u,r,n.uniforms,f),O(t,s,u,r);else{var l=t.global.def("{}"),h=r.shader.progVar.append(t,u),d=u.def(h,".id"),p=u.def(l,"[",d,"]");u(t.shared.gl,".useProgram(",h,".program);","if(!",p,"){",p,"=",l,"[",d,"]=",t.link(function(e){return w(F,t,r,e,2)}),"(",h,");}",p,".call(this,a0[",a,"],",a,");")}}function W(n,e,t){var a=e.static[t];if(a&&function(e){if("object"==typeof e&&!Ne(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(q.isDynamic(e[t[r]]))return!0;return!1}}(a)){var i=n.global,r=Object.keys(a),o=!1,s=!1,u=!1,f=n.global.def("{}");r.forEach(function(e){var t=a[e];if(q.isDynamic(t)){"function"==typeof t&&(t=a[e]=q.unbox(t));var r=Ui(t,null);o=o||r.thisDep,u=u||r.propDep,s=s||r.contextDep}else{switch(i(f,".",e,"="),typeof t){case"number":i(t);break;case"string":i('"',t,'"');break;case"object":Array.isArray(t)&&i("[",t.join(),"]");break;default:i(n.link(t))}i(";")}}),e.dynamic[t]=new q.DynamicVariable(Vr,{thisDep:o,contextDep:s,propDep:u,ref:f,append:function(n,i){r.forEach(function(e){var t=a[e];if(q.isDynamic(t)){var r=n.invoke(i,t);i(f,".",e,"=",r,";")}})}}),delete e.static[t]}}return{next:s,current:p,procs:function(){var s=g(),u=s.proc("poll"),f=s.proc("refresh"),c=s.block();u(c),f(c);var e,t=s.shared,l=t.gl,h=t.next,d=t.current;c(d,".dirty=false;"),A(s,u),A(s,f,null,!0),V&&(e=s.link(V));for(var r=0;r<D.maxAttributes;++r){var n=f.def(t.attributes,"[",r,"]"),i=s.cond(n,".buffer");i.then(l,".enableVertexAttribArray(",r,");",l,".bindBuffer(",Pn,",",n,".buffer.buffer);",l,".vertexAttribPointer(",r,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(l,".disableVertexAttribArray(",r,");",l,".vertexAttrib4f(",r,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;"),f(i),V&&f(e,".vertexAttribDivisorANGLE(",r,",",n,".divisor);")}return Object.keys(m).forEach(function(e){var t=m[e],r=c.def(h,".",e),n=s.block();n("if(",r,"){",l,".enable(",t,")}else{",l,".disable(",t,")}",d,".",e,"=",r,";"),f(n),u("if(",r,"!==",d,".",e,"){",n,"}")}),Object.keys(_).forEach(function(e){var t,r,n=_[e],i=p[e],a=s.block();if(a(l,".",n,"("),Ne(i)){var o=i.length;t=s.global.def(h,".",e),r=s.global.def(d,".",e),a(z(o,function(e){return t+"["+e+"]"}),");",z(o,function(e){return r+"["+e+"]="+t+"["+e+"];"}).join("")),u("if(",z(o,function(e){return t+"["+e+"]!=="+r+"["+e+"]"}).join("||"),"){",a,"}")}else t=c.def(h,".",e),r=c.def(d,".",e),a(t,");",d,".",e,"=",t,";"),u("if(",t,"!==",r,"){",a,"}");f(a)}),s.compile()}(),compile:function(t,r,e,n,i){var a=g();a.stats=a.link(i),Object.keys(r.static).forEach(function(e){W(a,r,e)}),Dn.forEach(function(e){W(a,t,e)});var o=E(t,r,e,n,a);return function(t,r){var e=t.proc("draw",1);M(t,e),y(t,e,r.context),A(t,e,r.framebuffer),T(t,e,r),R(t,e,r.state),x(t,e,r,!1,!0);var n=r.shader.progVar.append(t,e);if(e(t.shared.gl,".useProgram(",n,".program);"),r.shader.program)N(t,e,r,r.shader.program);else{var i=t.global.def("{}"),a=e.def(n,".id"),o=e.def(i,"[",a,"]");e(t.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",t.link(function(e){return w(N,t,r,e,1)}),"(",n,");",o,".call(this,a0);"))}0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),function(n,i){var a=n.proc("scope",3);n.batchId="a2";var o=n.shared,e=o.current;function t(e){var t=i.shader[e];t&&a.set(o.shader,"."+e,t.append(n,a))}y(n,a,i.context),i.framebuffer&&i.framebuffer.append(n,a),Li(Object.keys(i.state)).forEach(function(r){var e=i.state[r].append(n,a);Ne(e)?e.forEach(function(e,t){a.set(n.next[r],"["+t+"]",e)}):a.set(o.next,"."+r,e)}),x(n,a,i,!0,!0),[yn,Rn,Tn,Mn,An].forEach(function(e){var t=i.draw[e];t&&a.set(o.draw,"."+e,""+t.append(n,a))}),Object.keys(i.uniforms).forEach(function(e){a.set(o.uniforms,"["+L.id(e)+"]",i.uniforms[e].append(n,a))}),Object.keys(i.attributes).forEach(function(e){var t=i.attributes[e].append(n,a),r=n.scopeAttrib(e);Object.keys(new G).forEach(function(e){a.set(r,"."+e,t[e])})}),t(bn),t(En),0<Object.keys(i.state).length&&(a(e,".dirty=true;"),a.exit(e,".dirty=true;")),a("a1(",n.shared.context,",a0,",n.batchId,");")}(a,o),function(t,r){var e=t.proc("batch",2);t.batchId="0",M(t,e);var n=!1,i=!0;Object.keys(r.context).forEach(function(e){n=n||r.context[e].propDep}),n||(y(t,e,r.context),i=!1);var a=r.framebuffer,o=!1;function s(e){return e.contextDep&&n||e.propDep}a?(a.propDep?n=o=!0:a.contextDep&&n&&(o=!0),o||A(t,e,a)):A(t,e,null),r.state.viewport&&r.state.viewport.propDep&&(n=!0),T(t,e,r),R(t,e,r.state,function(e){return!s(e)}),r.profile&&s(r.profile)||x(t,e,r,!1,"a1"),r.contextDep=n,r.needsContext=i,r.needsFramebuffer=o;var u=r.shader.progVar;if(u.contextDep&&n||u.propDep)I(t,e,r,null);else{var f=u.append(t,e);if(e(t.shared.gl,".useProgram(",f,".program);"),r.shader.program)I(t,e,r,r.shader.program);else{var c=t.global.def("{}"),l=e.def(f,".id"),h=e.def(c,"[",l,"]");e(t.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",l,"]=",t.link(function(e){return w(I,t,r,e,2)}),"(",f,");",h,".call(this,a0,a1);"))}}0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),a.compile()}}}var Hi=function(e,t){var h=t.ext_disjoint_timer_query;if(!h)return null;var d=[],p=[];function i(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var m=[],_=[];function r(e,t,r){var n=m.pop()||new i;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,_.push(n)}var v=[],g=[];return{beginQuery:function(e){var t=d.pop()||h.createQueryEXT();h.beginQueryEXT(35007,t),p.push(t),r(p.length-1,p.length,e)},endQuery:function(){h.endQueryEXT(35007)},pushScopeStats:r,update:function(){var e,t,r=p.length;if(0!==r){g.length=Math.max(g.length,r+1),v.length=Math.max(v.length,r+1),v[0]=0;var n,i,a=g[0]=0;for(t=e=0;t<p.length;++t){var o=p[t];h.getQueryObjectEXT(o,34919)?(a+=h.getQueryObjectEXT(o,34918),n=o,d.push(n)):p[e++]=o,v[t+1]=a,g[t+1]=e}for(p.length=e,t=e=0;t<_.length;++t){var s=_[t],u=s.startQueryIndex,f=s.endQueryIndex;s.sum+=v[f]-v[u];var c=g[u],l=g[f];l===c?(s.stats.gpuTime+=s.sum/1e6,i=s,m.push(i)):(s.startQueryIndex=c,s.endQueryIndex=l,_[e++]=s)}_.length=e}},getNumPendingQueries:function(){return p.length},clear:function(){d.push.apply(d,p);for(var e=0;e<d.length;e++)h.deleteQueryEXT(d[e]);p.length=0,d.length=0},restore:function(){p.length=0,d.length=0}}},Vi="webglcontextlost",Xi="webglcontextrestored";function ji(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(e){var t=Z(e);if(!t)return null;var i=t.gl,r=i.getContextAttributes(),h=i.isContextLost(),n=function(n,e){var i={};function t(e){ee.type(e,"string","extension name must be string");var t,r=e.toLowerCase();try{t=i[r]=n.getExtension(r)}catch(e){}return!!t}for(var r=0;r<e.extensions.length;++r){var a=e.extensions[r];if(!t(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(t),{extensions:i,restore:function(){Object.keys(i).forEach(function(e){if(!t(e))throw new Error("(regl): error restoring extension "+e)})}}}(i,t);if(!n)return null;var a,o,s=(a={"":0},o=[""],{id:function(e){var t=a[e];return t||(t=a[e]=o.length,o.push(e),t)},str:function(e){return o[e]}}),u={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=n.extensions,c=Hi(0,f),l=Y(),d=i.drawingBufferWidth,p=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:d,viewportHeight:p,framebufferWidth:d,framebufferHeight:p,drawingBufferWidth:d,drawingBufferHeight:p,pixelRatio:t.pixelRatio},_=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var a=!!t.oes_texture_float;if(a){var o=e.createTexture();e.bindTexture(3553,o),e.texImage2D(3553,0,Q,1,1,0,Q,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=te.allocType(5126,4);e.readPixels(0,0,1,1,Q,5126,u),e.getError()?a=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),a=1===u[0]),te.freeType(u)}}var f=!0,c=e.createTexture(),l=te.allocType(5121,36);return e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,Q,3,3,0,Q,5121,l),te.freeType(l),e.bindTexture(34067,null),e.deleteTexture(c),f=!e.getError(),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:a,npotTextureCube:f}}(i,f),v=function(e,t,r,n){for(var i=r.maxAttributes,a=new Array(i),o=0;o<i;++o)a[o]=new Rr;return{Record:Rr,scope:{},state:a}}(0,0,_),g=function(s,i,u,a){var t=0,f={};function n(e){this.id=t++,this.buffer=s.createBuffer(),this.type=e,this.usage=fe,this.byteLength=0,this.dimension=1,this.dtype=le,this.persistentData=null,u.profile&&(this.stats={size:0})}n.prototype.bind=function(){s.bindBuffer(this.type,this.buffer)},n.prototype.destroy=function(){l(this)};var o=[];function g(e,t,r){e.byteLength=t.byteLength,s.bufferData(e.type,t,r)}function c(e,t,r,n,i,a){var o,s;if(e.usage=r,Array.isArray(t)){if(e.dtype=n||he,0<t.length)if(Array.isArray(t[0])){o=ue(t);for(var u=1,f=1;f<o.length;++f)u*=o[f];e.dimension=u,s=se(t,o,e.dtype),g(e,s,r),a?e.persistentData=s:te.freeType(s)}else if("number"==typeof t[0]){e.dimension=i;var c=te.allocType(e.dtype,t.length);me(c,t),g(e,c,r),a?e.persistentData=c:te.freeType(c)}else J(t[0])?(e.dimension=t[0].length,e.dtype=n||pe(t[0])||he,s=se(t,[t.length,t[0].length],e.dtype),g(e,s,r),a?e.persistentData=s:te.freeType(s)):ee.raise("invalid buffer data")}else if(J(t))e.dtype=n||pe(t),e.dimension=i,g(e,t,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(re(t)){o=t.shape;var l=t.stride,h=t.offset,d=0,p=0,m=0,_=0;1===o.length?(d=o[0],p=1,m=l[0],_=0):2===o.length?(d=o[0],p=o[1],m=l[0],_=l[1]):ee.raise("invalid shape"),e.dtype=n||pe(t.data)||he,e.dimension=p;var v=te.allocType(e.dtype,d*p);_e(v,t.data,d,p,m,_,h),g(e,v,r),a?e.persistentData=v:te.freeType(v)}else ee.raise("invalid buffer data")}function l(e){i.bufferCount--;for(var t=0;t<a.state.length;++t){var r=a.state[t];r.buffer===e&&(s.disableVertexAttribArray(t),r.buffer=null)}var n=e.buffer;ee(n,"buffer must not be deleted already"),s.deleteBuffer(n),e.buffer=null,delete f[e.id]}return u.profile&&(i.getTotalBufferSize=function(){var t=0;return Object.keys(f).forEach(function(e){t+=f[e].stats.size}),t}),{create:function(e,t,r,o){i.bufferCount++;var d=new n(t);function p(e){var t=fe,r=null,n=0,i=0,a=1;return Array.isArray(e)||J(e)||re(e)?r=e:"number"==typeof e?n=0|e:e&&(ee.type(e,"object","buffer arguments must be an object, a number or an array"),"data"in e&&(ee(null===r||Array.isArray(r)||J(r)||re(r),"invalid data for buffer"),r=e.data),"usage"in e&&(ee.parameter(e.usage,oe,"invalid buffer usage"),t=oe[e.usage]),"type"in e&&(ee.parameter(e.type,ae,"invalid buffer type"),i=ae[e.type]),"dimension"in e&&(ee.type(e.dimension,"number","invalid dimension"),a=0|e.dimension),"length"in e&&(ee.nni(n,"buffer length must be a nonnegative integer"),n=0|e.length)),d.bind(),r?c(d,r,t,i,a,o):(n&&s.bufferData(d.type,n,t),d.dtype=i||le,d.usage=t,d.dimension=a,d.byteLength=n),u.profile&&(d.stats.size=d.byteLength*de[d.dtype]),p}function m(e,t){ee(t+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+t+" to a buffer of size "+d.byteLength),s.bufferSubData(d.type,t,e)}return f[d.id]=d,r||p(e),p._reglType="buffer",p._buffer=d,p.subdata=function(e,t){var r,n=0|(t||0);if(d.bind(),J(e))m(e,n);else if(Array.isArray(e)){if(0<e.length)if("number"==typeof e[0]){var i=te.allocType(d.dtype,e.length);me(i,e),m(i,n),te.freeType(i)}else if(Array.isArray(e[0])||J(e[0])){r=ue(e);var a=se(e,r,d.dtype);m(a,n),te.freeType(a)}else ee.raise("invalid buffer data")}else if(re(e)){r=e.shape;var o=e.stride,s=0,u=0,f=0,c=0;1===r.length?(s=r[0],u=1,f=o[0],c=0):2===r.length?(s=r[0],u=r[1],f=o[0],c=o[1]):ee.raise("invalid shape");var l=Array.isArray(e.data)?d.dtype:pe(e.data),h=te.allocType(l,s*u);_e(h,e.data,s,u,f,c,e.offset),m(h,n),te.freeType(h)}else ee.raise("invalid data for buffer subdata");return p},u.profile&&(p.stats=d.stats),p.destroy=function(){l(d)},p},createStream:function(e,t){var r=o.pop();return r||(r=new n(e)),r.bind(),c(r,t,ce,0,1,!1),r},destroyStream:function(e){o.push(e)},clear:function(){ne(f).forEach(l),o.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof n?e._buffer:null},restore:function(){ne(f).forEach(function(e){e.buffer=s.createBuffer(),s.bindBuffer(e.type,e.buffer),s.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:c}}(i,u,t,v),b=function(h,d,p,r){var t={},n=0,c={uint8:Ae,uint16:Re};function i(e){this.id=n++,(t[this.id]=this).buffer=e,this.primType=Ee,this.vertCount=0,this.type=0}d.oes_element_index_uint&&(c.uint32=xe),i.prototype.bind=function(){this.buffer.bind()};var a=[];function l(e,t,r,n,i,a,o){if(e.buffer.bind(),t){var s=o;o||J(t)&&(!re(t)||J(t.data))||(s=d.oes_element_index_uint?xe:Re),p._initBuffer(e.buffer,t,r,s,3)}else h.bufferData(Se,a,r),e.buffer.dtype=u||Ae,e.buffer.usage=r,e.buffer.dimension=3,e.buffer.byteLength=a;var u=o;if(!o){switch(e.buffer.dtype){case Ae:case ye:u=Ae;break;case Re:case Te:u=Re;break;case xe:case Me:u=xe;break;default:ee.raise("unsupported type for element array")}e.buffer.dtype=u}e.type=u,ee(u!==xe||!!d.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=i;f<0&&(f=e.buffer.byteLength,u===Re?f>>=1:u===xe&&(f>>=2)),e.vertCount=f;var c=n;if(n<0){c=Ee;var l=e.buffer.dimension;1===l&&(c=ge),2===l&&(c=be),3===l&&(c=Ee)}e.primType=c}function o(e){r.elementsCount--,ee(null!==e.buffer,"must not double destroy elements"),delete t[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,t){var s=p.create(null,Se,!0),u=new i(s._buffer);function f(e){if(e)if("number"==typeof e)s(e),u.primType=Ee,u.vertCount=0|e,u.type=Ae;else{var t=null,r=Oe,n=-1,i=-1,a=0,o=0;Array.isArray(e)||J(e)||re(e)?t=e:(ee.type(e,"object","invalid arguments for elements"),"data"in e&&(t=e.data,ee(Array.isArray(t)||J(t)||re(t),"invalid data for element buffer")),"usage"in e&&(ee.parameter(e.usage,oe,"invalid element buffer usage"),r=oe[e.usage]),"primitive"in e&&(ee.parameter(e.primitive,ve,"invalid element buffer primitive"),n=ve[e.primitive]),"count"in e&&(ee("number"==typeof e.count&&0<=e.count,"invalid vertex count for elements"),i=0|e.count),"type"in e&&(ee.parameter(e.type,c,"invalid buffer type"),o=c[e.type]),"length"in e?a=0|e.length:(a=i,o===Re||o===Te?a*=2:o!==xe&&o!==Me||(a*=4))),l(u,t,r,n,i,a,o)}else s(),u.primType=Ee,u.vertCount=0,u.type=Ae;return f}return r.elementsCount++,f(e),f._reglType="elements",f._elements=u,f.subdata=function(e,t){return s.subdata(e,t),f},f.destroy=function(){o(u)},f},createStream:function(e){var t=a.pop();return t||(t=new i(p.create(null,Se,!0,!1)._buffer)),l(t,e,Ce,-1,-1,0,0),t},destroyStream:function(e){a.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof i?e._elements:null},clear:function(){ne(t).forEach(o)}}}(i,f,g,u),E=function(d,p,a,m){var o={},s={};function _(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function v(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function g(e,t,r){var n=e===Mr?o:s,i=n[t];if(!i){var a=p.str(t);i=d.createShader(e),d.shaderSource(i,a),d.compileShader(i),ee.shaderError(d,i,a,e,r),n[t]=i}return i}var u={},f=[],r=0;function c(e,t){this.id=r++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],m.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function l(e,t){var r,n,i=g(Mr,e.fragId),a=g(xr,e.vertId),o=e.program=d.createProgram();d.attachShader(o,i),d.attachShader(o,a),d.linkProgram(o),ee.linkError(d,o,p.str(e.fragId),p.str(e.vertId),t);var s=d.getProgramParameter(o,Sr);m.profile&&(e.stats.uniformsCount=s);var u=e.uniforms;for(r=0;r<s;++r)if(n=d.getActiveUniform(o,r))if(1<n.size)for(var f=0;f<n.size;++f){var c=n.name.replace("[0]","["+f+"]");v(u,new _(c,p.id(c),d.getUniformLocation(o,c),n))}else v(u,new _(n.name,p.id(n.name),d.getUniformLocation(o,n.name),n));var l=d.getProgramParameter(o,Cr);m.profile&&(e.stats.attributesCount=l);var h=e.attributes;for(r=0;r<l;++r)(n=d.getActiveAttrib(o,r))&&v(h,new _(n.name,p.id(n.name),d.getAttribLocation(o,n.name),n))}return m.profile&&(a.getMaxUniformsCount=function(){var t=0;return f.forEach(function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)}),t},a.getMaxAttributesCount=function(){var t=0;return f.forEach(function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)}),t}),{clear:function(){var e=d.deleteShader.bind(d);ne(o).forEach(e),o={},ne(s).forEach(e),s={},f.forEach(function(e){d.deleteProgram(e.program)}),f.length=0,u={},a.shaderCount=0},program:function(e,t,r){ee.command(0<=e,"missing vertex shader",r),ee.command(0<=t,"missing fragment shader",r);var n=u[t];n||(n=u[t]={});var i=n[e];return i||(i=new c(t,e),a.shaderCount++,l(i,r),n[e]=i,f.push(i)),i},restore:function(){o={},s={};for(var e=0;e<f.length;++e)l(f[e])},shader:g,frag:-1,vert:-1}}(i,s,u,t),y=rr(i,f,_,function(){R.procs.poll()},m,u,t),A=function(f,e,c,r,l){var h={rgba4:ir,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(h.srgba=35907),e.ext_color_buffer_half_float&&(h.rgba16f=34842,h.rgb16f=34843),e.webgl_color_buffer_float&&(h.rgba32f=34836);var d=[];Object.keys(h).forEach(function(e){var t=h[e];d[t]=e});var t=0,n={};function i(e){this.id=t++,this.refCount=1,this.renderbuffer=e,this.format=ir,this.width=0,this.height=0,l.profile&&(this.stats={size:0})}function a(e){var t=e.renderbuffer;ee(t,"must not double destroy renderbuffer"),f.bindRenderbuffer(nr,null),f.deleteRenderbuffer(t),e.renderbuffer=null,e.refCount=0,delete n[e.id],r.renderbufferCount--}return i.prototype.decRef=function(){--this.refCount<=0&&a(this)},l.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(n).forEach(function(e){t+=n[e].stats.size}),t}),{create:function(e,t){var s=new i(f.createRenderbuffer());function u(e,t){var r=0,n=0,i=ir;if("object"==typeof e&&e){var a=e;if("shape"in a){var o=a.shape;ee(Array.isArray(o)&&2<=o.length,"invalid renderbuffer shape"),r=0|o[0],n=0|o[1]}else"radius"in a&&(r=n=0|a.radius),"width"in a&&(r=0|a.width),"height"in a&&(n=0|a.height);"format"in a&&(ee.parameter(a.format,h,"invalid renderbuffer format"),i=h[a.format])}else"number"==typeof e?(r=0|e,n="number"==typeof t?0|t:r):e?ee.raise("invalid arguments to renderbuffer constructor"):r=n=1;if(ee(0<r&&0<n&&r<=c.maxRenderbufferSize&&n<=c.maxRenderbufferSize,"invalid renderbuffer size"),r!==s.width||n!==s.height||i!==s.format)return u.width=s.width=r,u.height=s.height=n,s.format=i,f.bindRenderbuffer(nr,s.renderbuffer),f.renderbufferStorage(nr,i,r,n),ee(0===f.getError(),"invalid render buffer format"),l.profile&&(s.stats.size=ar(s.format,s.width,s.height)),u.format=d[s.format],u}return n[s.id]=s,r.renderbufferCount++,u(e,t),u.resize=function(e,t){var r=0|e,n=0|t||r;return r===s.width&&n===s.height||(ee(0<r&&0<n&&r<=c.maxRenderbufferSize&&n<=c.maxRenderbufferSize,"invalid renderbuffer size"),u.width=s.width=r,u.height=s.height=n,f.bindRenderbuffer(nr,s.renderbuffer),f.renderbufferStorage(nr,s.format,r,n),ee(0===f.getError(),"invalid render buffer format"),l.profile&&(s.stats.size=ar(s.format,s.width,s.height))),u},u._reglType="renderbuffer",u._renderbuffer=s,l.profile&&(u.stats=s.stats),u.destroy=function(){s.decRef()},u},clear:function(){ne(n).forEach(a)},restore:function(){ne(n).forEach(function(e){e.renderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(nr,e.renderbuffer),f.renderbufferStorage(nr,e.format,e.width,e.height)}),f.bindRenderbuffer(nr,null)}}}(i,f,_,u,t),T=function(i,S,C,v,s,r){var O={cur:null,next:null,dirty:!1,setFBO:null},w=["rgba"],N=["rgba4","rgb565","rgb5 a1"];S.ext_srgb&&N.push("srgba"),S.ext_color_buffer_half_float&&N.push("rgba16f","rgb16f"),S.webgl_color_buffer_float&&N.push("rgba32f");var F=["uint8"];function u(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,i=0;t?(n=t.width,i=t.height):r&&(n=r.width,i=r.height),this.width=n,this.height=i}function t(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function I(e,t,r){if(e)if(e.texture){var n=e.texture._texture,i=Math.max(1,n.width),a=Math.max(1,n.height);ee(i===t&&a===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;ee(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function a(e,t){t&&(t.texture?i.framebufferTexture2D(or,e,t.target,t.texture._texture.texture,0):i.framebufferRenderbuffer(or,e,sr,t.renderbuffer._renderbuffer.renderbuffer))}function L(e){var t=ur,r=null,n=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),ee.type(i,"function","invalid attachment data");var a=i._reglType;return"texture2d"===a?(r=i,ee(t===ur)):"textureCube"===a?(r=i,ee(fr<=t&&t<fr+6,"invalid cube map target")):"renderbuffer"===a?(n=i,t=sr):ee.raise("invalid regl object for attachment"),new u(t,r,n)}function D(e,t,r,n,i){if(r){var a=v.create2D({width:e,height:t,format:n,type:i});return a._texture.refCount=0,new u(ur,a,null)}var o=s.create({width:e,height:t,format:n});return o._renderbuffer.refCount=0,new u(sr,null,o)}function P(e){return e&&(e.texture||e.renderbuffer)}function o(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r))}S.oes_texture_half_float&&F.push("half float","float16"),S.oes_texture_float&&F.push("float","float32");var e=0,n={};function f(){this.id=e++,(n[this.id]=this).framebuffer=i.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function B(e){e.colorAttachments.forEach(t),t(e.depthAttachment),t(e.stencilAttachment),t(e.depthStencilAttachment)}function c(e){var t=e.framebuffer;ee(t,"must not double destroy framebuffer"),i.deleteFramebuffer(t),e.framebuffer=null,r.framebufferCount--,delete n[e.id]}function U(e){var t;i.bindFramebuffer(or,e.framebuffer);var r=e.colorAttachments;for(t=0;t<r.length;++t)a(cr+t,r[t]);for(t=r.length;t<C.maxColorAttachments;++t)i.framebufferTexture2D(or,cr+t,ur,null,0);i.framebufferTexture2D(or,dr,ur,null,0),i.framebufferTexture2D(or,lr,ur,null,0),i.framebufferTexture2D(or,hr,ur,null,0),a(lr,e.depthAttachment),a(hr,e.stencilAttachment),a(dr,e.depthStencilAttachment);var n=i.checkFramebufferStatus(or);n!==pr&&ee.raise("framebuffer configuration not supported, status = "+Tr[n]),i.bindFramebuffer(or,O.next?O.next.framebuffer:null),O.cur=O.next,i.getError()}function g(e,t){var M=new f;function x(e,t){var r;ee(O.next!==M,"can not update framebuffer which is currently in use");var n=S.webgl_draw_buffers,i=0,a=0,o=!0,s=!0,u=null,f=!0,c="rgba",l="uint8",h=1,d=null,p=null,m=null,_=!1;if("number"==typeof e)i=0|e,a=0|t||i;else if(e){ee.type(e,"object","invalid arguments for framebuffer");var v=e;if("shape"in v){var g=v.shape;ee(Array.isArray(g)&&2<=g.length,"invalid shape for framebuffer"),i=g[0],a=g[1]}else"radius"in v&&(i=a=v.radius),"width"in v&&(i=v.width),"height"in v&&(a=v.height);("color"in v||"colors"in v)&&(u=v.color||v.colors,Array.isArray(u)&&ee(1===u.length||n,"multiple render targets not supported")),u||("colorCount"in v&&(h=0|v.colorCount,ee(0<h,"invalid color buffer count")),"colorTexture"in v&&(f=!!v.colorTexture,c="rgba4"),"colorType"in v&&(l=v.colorType,f?(ee(S.oes_texture_float||!("float"===l||"float32"===l),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ee(S.oes_texture_half_float||!("half float"===l||"float16"===l),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===l||"float16"===l?(ee(S.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),c="rgba16f"):"float"!==l&&"float32"!==l||(ee(S.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),c="rgba32f"),ee.oneOf(l,F,"invalid color type")),"colorFormat"in v&&(c=v.colorFormat,0<=w.indexOf(c)?f=!0:0<=N.indexOf(c)?f=!1:f?ee.oneOf(v.colorFormat,w,"invalid color format for texture"):ee.oneOf(v.colorFormat,N,"invalid color format for renderbuffer"))),("depthTexture"in v||"depthStencilTexture"in v)&&(_=!(!v.depthTexture&&!v.depthStencilTexture),ee(!_||S.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in v&&("boolean"==typeof v.depth?o=v.depth:(d=v.depth,s=!1)),"stencil"in v&&("boolean"==typeof v.stencil?s=v.stencil:(p=v.stencil,o=!1)),"depthStencil"in v&&("boolean"==typeof v.depthStencil?o=s=v.depthStencil:(m=v.depthStencil,s=o=!1))}else i=a=1;var b=null,E=null,y=null,A=null;if(Array.isArray(u))b=u.map(L);else if(u)b=[L(u)];else for(b=new Array(h),r=0;r<h;++r)b[r]=D(i,a,f,c,l);ee(S.webgl_draw_buffers||b.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ee(b.length<=C.maxColorAttachments,"too many color attachments, not supported"),i=i||b[0].width,a=a||b[0].height,d?E=L(d):o&&!s&&(E=D(i,a,_,"depth","uint32")),p?y=L(p):s&&!o&&(y=D(i,a,!1,"stencil","uint8")),m?A=L(m):!d&&!p&&s&&o&&(A=D(i,a,_,"depth stencil","depth stencil")),ee(!!d+!!p+!!m<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var T=null;for(r=0;r<b.length;++r)if(I(b[r],i,a),ee(!b[r]||b[r].texture&&0<=_r.indexOf(b[r].texture._texture.format)||b[r].renderbuffer&&0<=Ar.indexOf(b[r].renderbuffer._renderbuffer.format),"framebuffer color attachment "+r+" is invalid"),b[r]&&b[r].texture){var R=vr[b[r].texture._texture.format]*gr[b[r].texture._texture.type];null===T?T=R:ee(T===R,"all color attachments much have the same number of bits per pixel.")}return I(E,i,a),ee(!E||E.texture&&E.texture._texture.format===mr||E.renderbuffer&&E.renderbuffer._renderbuffer.format===br,"invalid depth attachment for framebuffer object"),I(y,i,a),ee(!y||y.renderbuffer&&y.renderbuffer._renderbuffer.format===Er,"invalid stencil attachment for framebuffer object"),I(A,i,a),ee(!A||A.texture&&A.texture._texture.format===yr||A.renderbuffer&&A.renderbuffer._renderbuffer.format===yr,"invalid depth-stencil attachment for framebuffer object"),B(M),M.width=i,M.height=a,M.colorAttachments=b,M.depthAttachment=E,M.stencilAttachment=y,M.depthStencilAttachment=A,x.color=b.map(P),x.depth=P(E),x.stencil=P(y),x.depthStencil=P(A),x.width=M.width,x.height=M.height,U(M),x}return r.framebufferCount++,x(e,t),$(x,{resize:function(e,t){ee(O.next!==M,"can not resize a framebuffer which is currently in use");var r=0|e,n=0|t||r;if(r===M.width&&n===M.height)return x;for(var i=M.colorAttachments,a=0;a<i.length;++a)o(i[a],r,n);return o(M.depthAttachment,r,n),o(M.stencilAttachment,r,n),o(M.depthStencilAttachment,r,n),M.width=x.width=r,M.height=x.height=n,U(M),x},_reglType:"framebuffer",_framebuffer:M,destroy:function(){c(M),B(M)},use:function(e){O.setFBO({framebuffer:x},e)}})}return $(O,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof f)return t}return null},create:g,createCube:function(e){var m=Array(6);function _(e){var t;ee(m.indexOf(O.next)<0,"can not update framebuffer which is currently in use");var r,n=S.webgl_draw_buffers,i={color:null},a=0,o=null,s="rgba",u="uint8",f=1;if("number"==typeof e)a=0|e;else if(e){ee.type(e,"object","invalid arguments for framebuffer");var c=e;if("shape"in c){var l=c.shape;ee(Array.isArray(l)&&2<=l.length,"invalid shape for framebuffer"),ee(l[0]===l[1],"cube framebuffer must be square"),a=l[0]}else"radius"in c&&(a=0|c.radius),"width"in c?(a=0|c.width,"height"in c&&ee(c.height===a,"must be square")):"height"in c&&(a=0|c.height);("color"in c||"colors"in c)&&(o=c.color||c.colors,Array.isArray(o)&&ee(1===o.length||n,"multiple render targets not supported")),o||("colorCount"in c&&(f=0|c.colorCount,ee(0<f,"invalid color buffer count")),"colorType"in c&&(ee.oneOf(c.colorType,F,"invalid color type"),u=c.colorType),"colorFormat"in c&&(s=c.colorFormat,ee.oneOf(c.colorFormat,w,"invalid color format for texture"))),"depth"in c&&(i.depth=c.depth),"stencil"in c&&(i.stencil=c.stencil),"depthStencil"in c&&(i.depthStencil=c.depthStencil)}else a=1;if(o)if(Array.isArray(o))for(r=[],t=0;t<o.length;++t)r[t]=o[t];else r=[o];else{r=Array(f);var h={radius:a,format:s,type:u};for(t=0;t<f;++t)r[t]=v.createCube(h)}for(i.color=Array(r.length),t=0;t<r.length;++t){var d=r[t];ee("function"==typeof d&&"textureCube"===d._reglType,"invalid cube map"),a=a||d.width,ee(d.width===a&&d.height===a,"invalid cube map shape"),i.color[t]={target:fr,data:r[t]}}for(t=0;t<6;++t){for(var p=0;p<r.length;++p)i.color[p].target=fr+t;0<t&&(i.depth=m[0].depth,i.stencil=m[0].stencil,i.depthStencil=m[0].depthStencil),m[t]?m[t](i):m[t]=g(i)}return $(_,{width:a,height:a,color:r})}return _(e),$(_,{faces:m,resize:function(e){var t,r=0|e;if(ee(0<r&&r<=C.maxCubeMapSize,"invalid radius for cube fbo"),r===_.width)return _;var n=_.color;for(t=0;t<n.length;++t)n[t].resize(r);for(t=0;t<6;++t)m[t].resize(r);return _.width=_.height=r,_},_reglType:"framebufferCube",destroy:function(){m.forEach(function(e){e.destroy()})}})},clear:function(){ne(n).forEach(c)},restore:function(){ne(n).forEach(function(e){e.framebuffer=i.createFramebuffer(),U(e)})}})}(i,f,_,y,A,u),R=Gi(i,s,f,_,g,b,0,T,{},v,E,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,c,t),M=Nr(i,T,R.procs.poll,m,r,f,_),x=R.next,S=i.canvas,C=[],O=[],w=[],N=[t.onDestroy],F=null;function I(){if(0===C.length)return c&&c.update(),void(F=null);F=K.next(I),X();for(var e=C.length-1;0<=e;--e){var t=C[e];t&&t(m,null,0)}i.flush(),c&&c.update()}function L(){!F&&0<C.length&&(F=K.next(I))}function D(){F&&(K.cancel(I),F=null)}function P(e){e.preventDefault(),h=!0,D(),O.forEach(function(e){e()})}function B(e){i.getError(),h=!1,n.restore(),E.restore(),g.restore(),y.restore(),A.restore(),T.restore(),c&&c.restore(),R.procs.refresh(),L(),w.forEach(function(e){e()})}function U(e){function t(r){var n={},i={};return Object.keys(r).forEach(function(e){var t=r[e];q.isDynamic(t)?i[e]=q.unbox(t,e):n[e]=t}),{dynamic:i,static:n}}ee(!!e,"invalid args to regl({...})"),ee.type(e,"object","invalid args to regl({...})");var r=t(e.context||{}),n=t(e.uniforms||{}),i=t(e.attributes||{}),a=t(function(e){var n=$({},e);function t(t){if(t in n){var r=n[t];delete n[t],Object.keys(r).forEach(function(e){n[t+"."+e]=r[e]})}}return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}(e)),o={gpuTime:0,cpuTime:0,count:0},s=R.compile(a,i,n,r,o),u=s.draw,f=s.batch,c=s.scope,l=[];return $(function(e,t){var r;if(h&&ee.raise("context lost"),"function"==typeof e)return c.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)c.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)c.call(this,e[r],t,r);return}return c.call(this,e,t,0)}if("number"==typeof e){if(0<e)return f.call(this,function(e){for(;l.length<e;)l.push(null);return l}(0|e),0|e)}else{if(!Array.isArray(e))return u.call(this,e);if(e.length)return f.call(this,e,e.length)}},{stats:o})}S&&(S.addEventListener(Vi,P,!1),S.addEventListener(Xi,B,!1));var k=T.setFBO=U({framebuffer:q.define.call(null,1,"framebuffer")});function G(e,t){var r=0;R.procs.poll();var n=t.color;n&&(i.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in t&&(i.clearDepth(+t.depth),r|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),r|=1024),ee(!!r,"called regl.clear with no buffer specified"),i.clear(r)}function H(t){return ee.type(t,"function","regl.frame() callback must be a function"),C.push(t),L(),{cancel:function(){var e=ji(C,t);ee(0<=e,"cannot cancel a frame twice"),C[e]=function e(){var t=ji(C,e);C[t]=C[C.length-1],C.length-=1,C.length<=0&&D()}}}}function V(){var e=x.viewport,t=x.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function X(){m.tick+=1,m.time=W(),V(),R.procs.poll()}function j(){V(),R.procs.refresh(),c&&c.update()}function W(){return(Y()-l)/1e3}j();var z=$(U,{clear:function(e){if(ee("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)k($({framebuffer:e.framebuffer.faces[t]},e),G);else k(e,G);else G(null,e)},prop:q.define.bind(null,1),context:q.define.bind(null,2),this:q.define.bind(null,3),draw:U({}),buffer:function(e){return g.create(e,34962,!1,!1)},elements:function(e){return b.create(e,!1)},texture:y.create2D,cube:y.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,attributes:r,frame:H,on:function(e,t){var r;switch(ee.type(t,"function","listener callback must be a function"),e){case"frame":return H(t);case"lost":r=O;break;case"restore":r=w;break;case"destroy":r=N;break;default:ee.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:_,hasExtension:function(e){return 0<=_.extensions.indexOf(e.toLowerCase())},read:M,destroy:function(){C.length=0,D(),S&&(S.removeEventListener(Vi,P),S.removeEventListener(Xi,B)),E.clear(),T.clear(),A.clear(),y.clear(),b.clear(),g.clear(),c&&c.clear(),N.forEach(function(e){e()})},_gl:i,_refresh:j,poll:function(){X(),c&&c.update()},now:W,stats:u});return t.onDone(null,z),z}}()}(t={exports:{}},t.exports),t.exports);function _(e){return!o(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function o(e){return null==e}function s(e){return!o(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}function v(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function u(e){return"number"==typeof e&&!isNaN(e)}function b(e,t,r){return e*(1-r)+t*r}function g(e){return Array.isArray(e)||e instanceof Uint8Array||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof Float64Array}var i=Object.freeze({isString:_,isNil:o,isFunction:s,extend:v,isNumber:u,log2:function(e){if(Math.log2)return Math.log2(e);var t=Math.log(e)*Math.LOG2E,r=Math.round(t);return Math.abs(r-t)<1e-14?r:t},normalize:function(e,t){for(var r=0,n=0,i=t.length;n<i;n++)r+=t[n];for(var a=0,o=t.length;a<o;a++)e[a]=t[a]/r;return e},interpolate:b,isArray:g}),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(e){return function(e){function t(){return E(this,t),c(this,e.apply(this,arguments))}return f(t,e),t.prototype.on=function(e,t){return this._events||(this._events={type:[t]}),this._events[e]=this._events[e]||[],this._events[e].push(t),this},t.prototype.once=function(e,t){return this.on(e,this._wrapOnce(e,t))},t.prototype.off=function(e,t){return this._events&&this._events[e]&&this._events[e].splice(this._events[e].indexOf(t),1),this},t.prototype.fire=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!this._events||!this._events[e])return this;t.target||(t.target=this);var r=this._events[e].slice(0),n=Array.isArray(r),i=0;for(r=n?r:r[Symbol.iterator]();;){var a;if(n){if(i>=r.length)break;a=r[i++]}else{if((i=r.next()).done)break;a=i.value}a(t)}return this},t.prototype._wrapOnce=function(t,r){var n=this,i=!1;return function e(){i||(i=!0,r(),n.off(t,e))}},t}(e)},h=l(function(){function a(e,t){if(E(this,a),s(e))for(var r in this._texture=e,e=this.config={},this._texture)this._texture.hasOwnProperty(r)&&(s(this._texture[r])||(e[r]=this._texture[r]));else if(this.config=e||{},this.resLoader=t,e.url){this._loading=!0;var n=this,i=void 0;i=e.arrayBuffer?t.getArrayBuffer:t.get,e.data=i.call(t,e.url,function(){n._loading=!1,n.config&&(n.onLoad.apply(n,arguments),n.fire("complete"))})}}return a.prototype.isReady=function(){return!this._loading},a.prototype.set=function(e,t){return this.config[e]=t,this.dirty=!0,this},a.prototype.get=function(e){return this.config[e]},a.prototype.getREGLTexture=function(e){return this._texture||(this._texture=this.createREGLTexture(e)),this.dirty&&this._updateREGL(),this._texture},a.prototype._updateREGL=function(){this._texture&&this._texture(this.config),this.dirty=!1},a.prototype.dispose=function(){this.config.url&&this.resLoader.disposeRes(this.config.url),this._texture&&!this._texture.__destroyed&&(this._texture.destroy(),this._texture.__destroyed=!0),delete this.resLoader,delete this.config},a}()),p=function(){function t(e){E(this,t),this.regl=e}return t.prototype.render=function(e,t,r,n){if(e.setUniforms(v({},t||{})),e.setFramebuffer(n),r){var i=r.getSortedMeshes(),a=i.opaques,o=i.transparents;e.draw(this.regl,a),e.draw(this.regl,o)}else e.draw(this.regl);return this},t.prototype.clear=function(e){this.regl.clear(e)},t}(),m=function(e){function t(){return E(this,t),c(this,e.apply(this,arguments))}return f(t,e),t}(p),L=1e-6,y="undefined"!=typeof Float32Array?Float32Array:Array,A=Math.random;var T=Math.PI/180;var R=Object.freeze({EPSILON:L,get ARRAY_TYPE(){return y},RANDOM:A,setMatrixArrayType:function(e){y=e},toRadian:function(e){return e*T},equals:function(e,t){return Math.abs(e-t)<=L*Math.max(1,Math.abs(e),Math.abs(t))}});function M(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],f=r[2],c=r[3];return e[0]=n*s+a*u,e[1]=i*s+o*u,e[2]=n*f+a*c,e[3]=i*f+o*c,e}function x(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var S=M,C=x,O=Object.freeze({create:function(){var e=new y(4);return y!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new y(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,r,n){var i=new y(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},set:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:M,rotate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*s,e[1]=i*u+o*s,e[2]=n*-s+a*u,e[3]=i*-s+o*u,e},scale:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1];return e[0]=n*s,e[1]=i*s,e[2]=a*u,e[3]=o*u,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},LDU:function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:x,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],u=t[2],f=t[3];return Math.abs(r-o)<=L*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=L*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=L*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-f)<=L*Math.max(1,Math.abs(a),Math.abs(f))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},mul:S,sub:C});function w(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=r[0],c=r[1],l=r[2],h=r[3],d=r[4],p=r[5];return e[0]=n*f+a*c,e[1]=i*f+o*c,e[2]=n*l+a*h,e[3]=i*l+o*h,e[4]=n*d+a*p+s,e[5]=i*d+o*p+u,e}function N(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}var F=w,I=N,D=Object.freeze({create:function(){var e=new y(6);return y!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new y(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,r,n,i,a){var o=new y(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=i,o[5]=a,o},set:function(e,t,r,n,i,a,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=r*a-n*i;return u?(u=1/u,e[0]=a*u,e[1]=-n*u,e[2]=-i*u,e[3]=r*u,e[4]=(i*s-a*o)*u,e[5]=(n*o-r*s)*u,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:w,rotate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*f,e[1]=i*c+o*f,e[2]=n*-f+a*c,e[3]=i*-f+o*c,e[4]=s,e[5]=u,e},scale:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=r[0],c=r[1];return e[0]=n*f,e[1]=i*f,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=u,e},translate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=r[0],c=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=n*f+a*c+s,e[5]=i*f+o*c+u,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:N,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=t[0],f=t[1],c=t[2],l=t[3],h=t[4],d=t[5];return Math.abs(r-u)<=L*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-f)<=L*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-c)<=L*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=L*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-h)<=L*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=L*Math.max(1,Math.abs(s),Math.abs(d))},mul:F,sub:I});function P(){var e=new y(9);return y!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function B(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=t[8],h=r[0],d=r[1],p=r[2],m=r[3],_=r[4],v=r[5],g=r[6],b=r[7],E=r[8];return e[0]=h*n+d*o+p*f,e[1]=h*i+d*s+p*c,e[2]=h*a+d*u+p*l,e[3]=m*n+_*o+v*f,e[4]=m*i+_*s+v*c,e[5]=m*a+_*u+v*l,e[6]=g*n+b*o+E*f,e[7]=g*i+b*s+E*c,e[8]=g*a+b*u+E*l,e}function U(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}var k=B,G=U,H=Object.freeze({create:P,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new y(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,r,n,i,a,o,s,u){var f=new y(9);return f[0]=e,f[1]=t,f[2]=r,f[3]=n,f[4]=i,f[5]=a,f[6]=o,f[7]=s,f[8]=u,f},set:function(e,t,r,n,i,a,o,s,u,f){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=f,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8],l=c*o-s*f,h=-c*a+s*u,d=f*a-o*u,p=r*l+n*h+i*d;return p?(p=1/p,e[0]=l*p,e[1]=(-c*n+i*f)*p,e[2]=(s*n-i*o)*p,e[3]=h*p,e[4]=(c*r-i*u)*p,e[5]=(-s*r+i*a)*p,e[6]=d*p,e[7]=(-f*r+n*u)*p,e[8]=(o*r-n*a)*p,e):null},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8];return e[0]=o*c-s*f,e[1]=i*f-n*c,e[2]=n*s-i*o,e[3]=s*u-a*c,e[4]=r*c-i*u,e[5]=i*a-r*s,e[6]=a*f-o*u,e[7]=n*u-r*f,e[8]=r*o-n*a,e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],f=e[8];return t*(f*a-o*u)+r*(-f*i+o*s)+n*(u*i-a*s)},multiply:B,translate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=t[8],h=r[0],d=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=h*n+d*o+f,e[7]=h*i+d*s+c,e[8]=h*a+d*u+l,e},rotate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=t[8],h=Math.sin(r),d=Math.cos(r);return e[0]=d*n+h*o,e[1]=d*i+h*s,e[2]=d*a+h*u,e[3]=d*o-h*n,e[4]=d*s-h*i,e[5]=d*u-h*a,e[6]=f,e[7]=c,e[8]=l,e},scale:function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,f=r*o,c=n*o,l=n*s,h=i*o,d=i*s,p=i*u,m=a*o,_=a*s,v=a*u;return e[0]=1-l-p,e[3]=c-v,e[6]=h+_,e[1]=c+v,e[4]=1-f-p,e[7]=d-m,e[2]=h-_,e[5]=d+m,e[8]=1-f-l,e},normalFromMat4:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15],g=r*s-n*o,b=r*u-i*o,E=r*f-a*o,y=n*u-i*s,A=n*f-a*s,T=i*f-a*u,R=c*m-l*p,M=c*_-h*p,x=c*v-d*p,S=l*_-h*m,C=l*v-d*m,O=h*v-d*_,w=g*O-b*C+E*S+y*x-A*M+T*R;return w?(w=1/w,e[0]=(s*O-u*C+f*S)*w,e[1]=(u*x-o*O-f*M)*w,e[2]=(o*C-s*x+f*R)*w,e[3]=(i*C-n*O-a*S)*w,e[4]=(r*O-i*x+a*M)*w,e[5]=(n*x-r*C-a*R)*w,e[6]=(m*T-_*A+v*y)*w,e[7]=(_*E-p*T-v*b)*w,e[8]=(p*A-m*E+v*g)*w,e):null},projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract:U,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],f=e[7],c=e[8],l=t[0],h=t[1],d=t[2],p=t[3],m=t[4],_=t[5],v=t[6],g=t[7],b=t[8];return Math.abs(r-l)<=L*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-h)<=L*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=L*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=L*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=L*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-_)<=L*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-v)<=L*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(f-g)<=L*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(c-b)<=L*Math.max(1,Math.abs(c),Math.abs(b))},mul:k,sub:G});function V(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15],g=r*s-n*o,b=r*u-i*o,E=r*f-a*o,y=n*u-i*s,A=n*f-a*s,T=i*f-a*u,R=c*m-l*p,M=c*_-h*p,x=c*v-d*p,S=l*_-h*m,C=l*v-d*m,O=h*v-d*_,w=g*O-b*C+E*S+y*x-A*M+T*R;return w?(w=1/w,e[0]=(s*O-u*C+f*S)*w,e[1]=(i*C-n*O-a*S)*w,e[2]=(m*T-_*A+v*y)*w,e[3]=(h*A-l*T-d*y)*w,e[4]=(u*x-o*O-f*M)*w,e[5]=(r*O-i*x+a*M)*w,e[6]=(_*E-p*T-v*b)*w,e[7]=(c*T-h*E+d*b)*w,e[8]=(o*C-s*x+f*R)*w,e[9]=(n*x-r*C-a*R)*w,e[10]=(p*A-m*E+v*g)*w,e[11]=(l*E-c*A-d*g)*w,e[12]=(s*M-o*S-u*R)*w,e[13]=(r*S-n*M+i*R)*w,e[14]=(m*b-p*y-_*g)*w,e[15]=(c*y-l*b+h*g)*w,e):null}function j(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=t[8],h=t[9],d=t[10],p=t[11],m=t[12],_=t[13],v=t[14],g=t[15],b=r[0],E=r[1],y=r[2],A=r[3];return e[0]=b*n+E*s+y*l+A*m,e[1]=b*i+E*u+y*h+A*_,e[2]=b*a+E*f+y*d+A*v,e[3]=b*o+E*c+y*p+A*g,b=r[4],E=r[5],y=r[6],A=r[7],e[4]=b*n+E*s+y*l+A*m,e[5]=b*i+E*u+y*h+A*_,e[6]=b*a+E*f+y*d+A*v,e[7]=b*o+E*c+y*p+A*g,b=r[8],E=r[9],y=r[10],A=r[11],e[8]=b*n+E*s+y*l+A*m,e[9]=b*i+E*u+y*h+A*_,e[10]=b*a+E*f+y*d+A*v,e[11]=b*o+E*c+y*p+A*g,b=r[12],E=r[13],y=r[14],A=r[15],e[12]=b*n+E*s+y*l+A*m,e[13]=b*i+E*u+y*h+A*_,e[14]=b*a+E*f+y*d+A*v,e[15]=b*o+E*c+y*p+A*g,e}function W(e,t,r){var n=r[0],i=r[1],a=r[2],o=void 0,s=void 0,u=void 0,f=void 0,c=void 0,l=void 0,h=void 0,d=void 0,p=void 0,m=void 0,_=void 0,v=void 0;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],f=t[3],c=t[4],l=t[5],h=t[6],d=t[7],p=t[8],m=t[9],_=t[10],v=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=f,e[4]=c,e[5]=l,e[6]=h,e[7]=d,e[8]=p,e[9]=m,e[10]=_,e[11]=v,e[12]=o*n+c*i+p*a+t[12],e[13]=s*n+l*i+m*a+t[13],e[14]=u*n+h*i+_*a+t[14],e[15]=f*n+d*i+v*a+t[15]),e}function z(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function q(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,u=i+i,f=a+a,c=n*s,l=n*u,h=n*f,d=i*u,p=i*f,m=a*f,_=o*s,v=o*u,g=o*f;return e[0]=1-(d+m),e[1]=l+g,e[2]=h-v,e[3]=0,e[4]=l-g,e[5]=1-(c+m),e[6]=p+_,e[7]=0,e[8]=h+v,e[9]=p-_,e[10]=1-(c+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function K(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Y(e,t){var r=t[0]+t[5]+t[10],n=0;return 0<r?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function Z(e,t,r,n,i){var a=1/Math.tan(t/2),o=void 0;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}function Q(e,t,r,n,i,a,o){var s=1/(t-r),u=1/(n-i),f=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(o+a)*f,e[15]=1,e}function J(e,t,r,n){var i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,f=void 0,c=void 0,l=void 0,h=void 0,d=void 0,p=t[0],m=t[1],_=t[2],v=n[0],g=n[1],b=n[2],E=r[0],y=r[1],A=r[2];return Math.abs(p-E)<L&&Math.abs(m-y)<L&&Math.abs(_-A)<L?V(e):(c=p-E,l=m-y,h=_-A,i=g*(h*=d=1/Math.sqrt(c*c+l*l+h*h))-b*(l*=d),a=b*(c*=d)-v*h,o=v*l-g*c,(d=Math.sqrt(i*i+a*a+o*o))?(i*=d=1/d,a*=d,o*=d):o=a=i=0,s=l*o-h*a,u=h*i-c*o,f=c*a-l*i,(d=Math.sqrt(s*s+u*u+f*f))?(s*=d=1/d,u*=d,f*=d):f=u=s=0,e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=a,e[5]=u,e[6]=l,e[7]=0,e[8]=o,e[9]=f,e[10]=h,e[11]=0,e[12]=-(i*p+a*m+o*_),e[13]=-(s*p+u*m+f*_),e[14]=-(c*p+l*m+h*_),e[15]=1,e)}function $(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}var ee=j,te=$,re=Object.freeze({create:function(){var e=new y(16);return y!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new y(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,r,n,i,a,o,s,u,f,c,l,h,d,p,m){var _=new y(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=n,_[4]=i,_[5]=a,_[6]=o,_[7]=s,_[8]=u,_[9]=f,_[10]=c,_[11]=l,_[12]=h,_[13]=d,_[14]=p,_[15]=m,_},set:function(e,t,r,n,i,a,o,s,u,f,c,l,h,d,p,m,_){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=f,e[9]=c,e[10]=l,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=_,e},identity:V,transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:X,adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15];return e[0]=s*(h*v-d*_)-l*(u*v-f*_)+m*(u*d-f*h),e[1]=-(n*(h*v-d*_)-l*(i*v-a*_)+m*(i*d-a*h)),e[2]=n*(u*v-f*_)-s*(i*v-a*_)+m*(i*f-a*u),e[3]=-(n*(u*d-f*h)-s*(i*d-a*h)+l*(i*f-a*u)),e[4]=-(o*(h*v-d*_)-c*(u*v-f*_)+p*(u*d-f*h)),e[5]=r*(h*v-d*_)-c*(i*v-a*_)+p*(i*d-a*h),e[6]=-(r*(u*v-f*_)-o*(i*v-a*_)+p*(i*f-a*u)),e[7]=r*(u*d-f*h)-o*(i*d-a*h)+c*(i*f-a*u),e[8]=o*(l*v-d*m)-c*(s*v-f*m)+p*(s*d-f*l),e[9]=-(r*(l*v-d*m)-c*(n*v-a*m)+p*(n*d-a*l)),e[10]=r*(s*v-f*m)-o*(n*v-a*m)+p*(n*f-a*s),e[11]=-(r*(s*d-f*l)-o*(n*d-a*l)+c*(n*f-a*s)),e[12]=-(o*(l*_-h*m)-c*(s*_-u*m)+p*(s*h-u*l)),e[13]=r*(l*_-h*m)-c*(n*_-i*m)+p*(n*h-i*l),e[14]=-(r*(s*_-u*m)-o*(n*_-i*m)+p*(n*u-i*s)),e[15]=r*(s*h-u*l)-o*(n*h-i*l)+c*(n*u-i*s),e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],f=e[8],c=e[9],l=e[10],h=e[11],d=e[12],p=e[13],m=e[14],_=e[15];return(t*o-r*a)*(l*_-h*m)-(t*s-n*a)*(c*_-h*p)+(t*u-i*a)*(c*m-l*p)+(r*s-n*o)*(f*_-h*d)-(r*u-i*o)*(f*m-l*d)+(n*u-i*s)*(f*p-c*d)},multiply:j,translate:W,scale:z,rotate:function(e,t,r,n){var i,a,o,s,u,f,c,l,h,d,p,m,_,v,g,b,E,y,A,T,R,M,x,S,C=n[0],O=n[1],w=n[2],N=Math.sqrt(C*C+O*O+w*w);return N<L?null:(C*=N=1/N,O*=N,w*=N,i=Math.sin(r),o=1-(a=Math.cos(r)),s=t[0],u=t[1],f=t[2],c=t[3],l=t[4],h=t[5],d=t[6],p=t[7],m=t[8],_=t[9],v=t[10],g=t[11],b=C*C*o+a,E=O*C*o+w*i,y=w*C*o-O*i,A=C*O*o-w*i,T=O*O*o+a,R=w*O*o+C*i,M=C*w*o+O*i,x=O*w*o-C*i,S=w*w*o+a,e[0]=s*b+l*E+m*y,e[1]=u*b+h*E+_*y,e[2]=f*b+d*E+v*y,e[3]=c*b+p*E+g*y,e[4]=s*A+l*T+m*R,e[5]=u*A+h*T+_*R,e[6]=f*A+d*T+v*R,e[7]=c*A+p*T+g*R,e[8]=s*M+l*x+m*S,e[9]=u*M+h*x+_*S,e[10]=f*M+d*x+v*S,e[11]=c*M+p*x+g*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],f=t[8],c=t[9],l=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+f*n,e[5]=o*i+c*n,e[6]=s*i+l*n,e[7]=u*i+h*n,e[8]=f*i-a*n,e[9]=c*i-o*n,e[10]=l*i-s*n,e[11]=h*i-u*n,e},rotateY:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],f=t[8],c=t[9],l=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-f*n,e[1]=o*i-c*n,e[2]=s*i-l*n,e[3]=u*i-h*n,e[8]=a*n+f*i,e[9]=o*n+c*i,e[10]=s*n+l*i,e[11]=u*n+h*i,e},rotateZ:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],f=t[4],c=t[5],l=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+f*n,e[1]=o*i+c*n,e[2]=s*i+l*n,e[3]=u*i+h*n,e[4]=f*i-a*n,e[5]=c*i-o*n,e[6]=l*i-s*n,e[7]=h*i-u*n,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,r){var n,i,a,o=r[0],s=r[1],u=r[2],f=Math.sqrt(o*o+s*s+u*u);return f<L?null:(o*=f=1/f,s*=f,u*=f,n=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=o*o*a+i,e[1]=s*o*a+u*n,e[2]=u*o*a-s*n,e[3]=0,e[4]=o*s*a-u*n,e[5]=s*s*a+i,e[6]=u*s*a+o*n,e[7]=0,e[8]=o*u*a+s*n,e[9]=s*u*a-o*n,e[10]=u*u*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:q,fromQuat2:function(e,t){var r=new y(3),n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=n*n+i*i+a*a+o*o;return 0<l?(r[0]=2*(s*o+c*n+u*a-f*i)/l,r[1]=2*(u*o+c*i+f*n-s*a)/l,r[2]=2*(f*o+c*a+s*i-u*n)/l):(r[0]=2*(s*o+c*n+u*a-f*i),r[1]=2*(u*o+c*i+f*n-s*a),r[2]=2*(f*o+c*a+s*i-u*n)),q(e,t,r),e},getTranslation:K,getScaling:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],f=t[9],c=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+f*f+c*c),e},getRotation:Y,fromRotationTranslationScale:function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,f=a+a,c=o+o,l=i*u,h=i*f,d=i*c,p=a*f,m=a*c,_=o*c,v=s*u,g=s*f,b=s*c,E=n[0],y=n[1],A=n[2];return e[0]=(1-(p+_))*E,e[1]=(h+b)*E,e[2]=(d-g)*E,e[3]=0,e[4]=(h-b)*y,e[5]=(1-(l+_))*y,e[6]=(m+v)*y,e[7]=0,e[8]=(d+g)*A,e[9]=(m-v)*A,e[10]=(1-(l+p))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,n,i){var a=t[0],o=t[1],s=t[2],u=t[3],f=a+a,c=o+o,l=s+s,h=a*f,d=a*c,p=a*l,m=o*c,_=o*l,v=s*l,g=u*f,b=u*c,E=u*l,y=n[0],A=n[1],T=n[2],R=i[0],M=i[1],x=i[2],S=(1-(m+v))*y,C=(d+E)*y,O=(p-b)*y,w=(d-E)*A,N=(1-(h+v))*A,F=(_+g)*A,I=(p+b)*T,L=(_-g)*T,D=(1-(h+m))*T;return e[0]=S,e[1]=C,e[2]=O,e[3]=0,e[4]=w,e[5]=N,e[6]=F,e[7]=0,e[8]=I,e[9]=L,e[10]=D,e[11]=0,e[12]=r[0]+R-(S*R+w*M+I*x),e[13]=r[1]+M-(C*R+N*M+L*x),e[14]=r[2]+x-(O*R+F*M+D*x),e[15]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,f=r*o,c=n*o,l=n*s,h=i*o,d=i*s,p=i*u,m=a*o,_=a*s,v=a*u;return e[0]=1-l-p,e[1]=c+v,e[2]=h-_,e[3]=0,e[4]=c-v,e[5]=1-f-p,e[6]=d+m,e[7]=0,e[8]=h+_,e[9]=d-m,e[10]=1-f-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,i,a,o){var s=1/(r-t),u=1/(i-n),f=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*u,e[10]=(o+a)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*f,e[15]=0,e},perspective:Z,perspectiveFromFieldOfView:function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),f=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*f*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},ortho:Q,lookAt:J,targetTo:function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=n[0],u=n[1],f=n[2],c=i-r[0],l=a-r[1],h=o-r[2],d=c*c+l*l+h*h;0<d&&(c*=d=1/Math.sqrt(d),l*=d,h*=d);var p=u*h-f*l,m=f*c-s*h,_=s*l-u*c;return 0<(d=p*p+m*m+_*_)&&(p*=d=1/Math.sqrt(d),m*=d,_*=d),e[0]=p,e[1]=m,e[2]=_,e[3]=0,e[4]=l*_-h*m,e[5]=h*p-c*_,e[6]=c*m-l*p,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract:$,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],f=e[7],c=e[8],l=e[9],h=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15],g=t[0],b=t[1],E=t[2],y=t[3],A=t[4],T=t[5],R=t[6],M=t[7],x=t[8],S=t[9],C=t[10],O=t[11],w=t[12],N=t[13],F=t[14],I=t[15];return Math.abs(r-g)<=L*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-b)<=L*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-E)<=L*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-y)<=L*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-A)<=L*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(s-T)<=L*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-R)<=L*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(f-M)<=L*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(c-x)<=L*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(l-S)<=L*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-C)<=L*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-O)<=L*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-w)<=L*Math.max(1,Math.abs(p),Math.abs(w))&&Math.abs(m-N)<=L*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(_-F)<=L*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(v-I)<=L*Math.max(1,Math.abs(v),Math.abs(I))},mul:ee,sub:te});function ne(){var e=new y(3);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ie(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function ae(e,t,r){var n=new y(3);return n[0]=e,n[1]=t,n[2]=r,n}function oe(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function se(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function ue(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function fe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function ce(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function le(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function he(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function de(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function pe(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function me(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return 0<a&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function _e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ve(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2];return e[0]=i*u-a*s,e[1]=a*o-n*u,e[2]=n*s-i*o,e}function ge(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}var be,Ee=ue,ye=fe,Ae=ce,Te=he,Re=de,Me=ie,xe=pe,Se=(be=ne(),function(e,t,r,n,i,a){var o=void 0,s=void 0;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)be[0]=e[o],be[1]=e[o+1],be[2]=e[o+2],i(be,be,a),e[o]=be[0],e[o+1]=be[1],e[o+2]=be[2];return e}),Ce=Object.freeze({create:ne,clone:function(e){var t=new y(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:ie,fromValues:ae,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:oe,add:se,subtract:ue,multiply:fe,divide:ce,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:le,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},distance:he,squaredDistance:de,squaredLength:pe,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:me,dot:_e,cross:ve,lerp:function(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e},hermite:function(e,t,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,f=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*u+n[0]*f+i[0]*c,e[1]=t[1]*s+r[1]*u+n[1]*f+i[1]*c,e[2]=t[2]*s+r[2]*u+n[2]*f+i[2]*c,e},bezier:function(e,t,r,n,i,a){var o=1-a,s=o*o,u=a*a,f=s*o,c=3*a*s,l=3*u*o,h=u*a;return e[0]=t[0]*f+r[0]*c+n[0]*l+i[0]*h,e[1]=t[1]*f+r[1]*c+n[1]*l+i[1]*h,e[2]=t[2]*f+r[2]*c+n[2]*l+i[2]*h,e},random:function(e,t){t=t||1;var r=2*A()*Math.PI,n=2*A()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},transformMat4:ge,transformMat3:function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},transformQuat:function(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],u=t[1],f=t[2],c=i*f-a*u,l=a*s-n*f,h=n*u-i*s,d=i*h-a*l,p=a*c-n*h,m=n*l-i*c,_=2*o;return c*=_,l*=_,h*=_,d*=2,p*=2,m*=2,e[0]=s+c+d,e[1]=u+l+p,e[2]=f+h+m,e},rotateX:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateY:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateZ:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},angle:function(e,t){var r=ae(e[0],e[1],e[2]),n=ae(t[0],t[1],t[2]);me(r,r),me(n,n);var i=_e(r,n);return 1<i?0:i<-1?Math.PI:Math.acos(i)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=L*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=L*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=L*Math.max(1,Math.abs(i),Math.abs(s))},sub:Ee,mul:ye,div:Ae,dist:Te,sqrDist:Re,len:Me,sqrLen:xe,forEach:Se});function Oe(){var e=new y(4);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function we(e){var t=new y(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ne(e,t,r,n){var i=new y(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function Fe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ie(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function Le(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function De(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Pe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Be(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Ue(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ke(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function Ge(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function He(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function Ve(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function Xe(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return 0<o&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o),e}function je(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function We(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e}function ze(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}function qe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ke(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],u=t[2],f=t[3];return Math.abs(r-o)<=L*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=L*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=L*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-f)<=L*Math.max(1,Math.abs(a),Math.abs(f))}var Ye,Ze=De,Qe=Pe,Je=Be,$e=ke,et=Ge,tt=He,rt=Ve,nt=(Ye=Oe(),function(e,t,r,n,i,a){var o=void 0,s=void 0;for(t||(t=4),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)Ye[0]=e[o],Ye[1]=e[o+1],Ye[2]=e[o+2],Ye[3]=e[o+3],i(Ye,Ye,a),e[o]=Ye[0],e[o+1]=Ye[1],e[o+2]=Ye[2],e[o+3]=Ye[3];return e}),it=Object.freeze({create:Oe,clone:we,fromValues:Ne,copy:Fe,set:Ie,add:Le,subtract:De,multiply:Pe,divide:Be,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:Ue,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},distance:ke,squaredDistance:Ge,length:He,squaredLength:Ve,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:Xe,dot:je,lerp:We,random:function(e,t){var r,n,i,a,o,s;for(t=t||1;1<=(o=(r=2*A()-1)*r+(n=2*A()-1)*n););for(;1<=(s=(i=2*A()-1)*i+(a=2*A()-1)*a););var u=Math.sqrt((1-o)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*i*u,e[3]=t*a*u,e},transformMat4:ze,transformQuat:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2],f=r[3],c=f*n+s*a-u*i,l=f*i+u*n-o*a,h=f*a+o*i-s*n,d=-o*n-s*i-u*a;return e[0]=c*f+d*-o+l*-u-h*-s,e[1]=l*f+d*-s+h*-o-c*-u,e[2]=h*f+d*-u+c*-s-l*-o,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:qe,equals:Ke,sub:Ze,mul:Qe,div:Je,dist:$e,sqrDist:et,len:tt,sqrLen:rt,forEach:nt});function at(){var e=new y(4);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ot(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function st(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],f=r[2],c=r[3];return e[0]=n*c+o*s+i*f-a*u,e[1]=i*c+o*u+a*s-n*f,e[2]=a*c+o*f+n*u-i*s,e[3]=o*c-n*s-i*u-a*f,e}function ut(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-n*s,e}function ft(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u-a*s,e[1]=i*u+o*s,e[2]=a*u+n*s,e[3]=o*u-i*s,e}function ct(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*s,e[1]=i*u-n*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e}function lt(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],f=r[1],c=r[2],l=r[3],h=void 0,d=void 0,p=void 0,m=void 0,_=void 0;return(d=i*u+a*f+o*c+s*l)<0&&(d=-d,u=-u,f=-f,c=-c,l=-l),L<1-d?(h=Math.acos(d),p=Math.sin(h),m=Math.sin((1-n)*h)/p,_=Math.sin(n*h)/p):(m=1-n,_=n),e[0]=m*i+_*u,e[1]=m*a+_*f,e[2]=m*o+_*c,e[3]=m*s+_*l,e}function ht(e,t){var r=t[0]+t[4]+t[8],n=void 0;if(0<r)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+i]+t[3*i+a])*n,e[o]=(t[3*o+i]+t[3*i+o])*n}return e}var dt,pt,mt,_t,vt,gt,bt=we,Et=Ne,yt=Fe,At=Ie,Tt=Le,Rt=st,Mt=Ue,xt=je,St=We,Ct=He,Ot=Ct,wt=Ve,Nt=wt,Ft=Xe,It=qe,Lt=Ke,Dt=(dt=ne(),pt=ae(1,0,0),mt=ae(0,1,0),function(e,t,r){var n=_e(t,r);return n<-.999999?(ve(dt,pt,t),Me(dt)<1e-6&&ve(dt,mt,t),me(dt,dt),ot(e,dt,Math.PI),e):.999999<n?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ve(dt,t,r),e[0]=dt[0],e[1]=dt[1],e[2]=dt[2],e[3]=1+n,Ft(e,e))}),Pt=(_t=at(),vt=at(),function(e,t,r,n,i,a){return lt(_t,t,i,a),lt(vt,r,n,a),lt(e,_t,vt,2*a*(1-a)),e}),Bt=(gt=P(),function(e,t,r,n){return gt[0]=r[0],gt[3]=r[1],gt[6]=r[2],gt[1]=n[0],gt[4]=n[1],gt[7]=n[2],gt[2]=-t[0],gt[5]=-t[1],gt[8]=-t[2],Ft(e,ht(e,gt))}),Ut=Object.freeze({create:at,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:ot,getAxisAngle:function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return L<n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},multiply:st,rotateX:ut,rotateY:ft,rotateZ:ct,calculateW:function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},slerp:lt,random:function(e){var t=A(),r=A(),n=A(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:ht,fromEuler:function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),u=Math.cos(r),f=Math.sin(n),c=Math.cos(n);return e[0]=a*u*c-o*s*f,e[1]=o*s*c+a*u*f,e[2]=o*u*f-a*s*c,e[3]=o*u*c+a*s*f,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:bt,fromValues:Et,copy:yt,set:At,add:Tt,mul:Rt,scale:Mt,dot:xt,lerp:St,length:Ct,len:Ot,squaredLength:wt,sqrLen:Nt,normalize:Ft,exactEquals:It,equals:Lt,rotationTo:Dt,sqlerp:Pt,setAxes:Bt});function kt(e,t,r){var n=.5*r[0],i=.5*r[1],a=.5*r[2],o=t[0],s=t[1],u=t[2],f=t[3];return e[0]=o,e[1]=s,e[2]=u,e[3]=f,e[4]=n*f+i*u-a*s,e[5]=i*f+a*o-n*u,e[6]=a*f+n*s-i*o,e[7]=-n*o-i*s-a*u,e}function Gt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var Ht=yt;var Vt=yt;function Xt(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[4],u=r[5],f=r[6],c=r[7],l=t[4],h=t[5],d=t[6],p=t[7],m=r[0],_=r[1],v=r[2],g=r[3];return e[0]=n*g+o*m+i*v-a*_,e[1]=i*g+o*_+a*m-n*v,e[2]=a*g+o*v+n*_-i*m,e[3]=o*g-n*m-i*_-a*v,e[4]=n*c+o*s+i*f-a*u+l*g+p*m+h*v-d*_,e[5]=i*c+o*u+a*s-n*f+h*g+p*_+d*m-l*v,e[6]=a*c+o*f+n*u-i*s+d*g+p*v+l*_-h*m,e[7]=o*c-n*s-i*u-a*f+p*g-l*m-h*_-d*v,e}var jt=Xt;var Wt=xt;var zt=Ct,qt=zt,Kt=wt,Yt=Kt;var Zt=Object.freeze({create:function(){var e=new y(8);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new y(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,r,n,i,a,o,s){var u=new y(8);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u},fromRotationTranslationValues:function(e,t,r,n,i,a,o){var s=new y(8);s[0]=e,s[1]=t,s[2]=r,s[3]=n;var u=.5*i,f=.5*a,c=.5*o;return s[4]=u*n+f*r-c*t,s[5]=f*n+c*e-u*r,s[6]=c*n+u*t-f*e,s[7]=-u*e-f*t-c*r,s},fromRotationTranslation:kt,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var r=at();Y(r,t);var n=new y(3);return K(n,t),kt(e,r,n),e},copy:Gt,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,r,n,i,a,o,s,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e},getReal:Ht,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:Vt,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var r=t[4],n=t[5],i=t[6],a=t[7],o=-t[0],s=-t[1],u=-t[2],f=t[3];return e[0]=2*(r*f+a*o+n*u-i*s),e[1]=2*(n*f+a*s+i*o-r*u),e[2]=2*(i*f+a*u+r*s-n*o),e},translate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=.5*r[0],u=.5*r[1],f=.5*r[2],c=t[4],l=t[5],h=t[6],d=t[7];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=o*s+i*f-a*u+c,e[5]=o*u+a*s-n*f+l,e[6]=o*f+n*u-i*s+h,e[7]=-n*s-i*u-a*f+d,e},rotateX:function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=s*o+c*n+u*a-f*i,h=u*o+c*i+f*n-s*a,d=f*o+c*a+s*i-u*n,p=c*o-s*n-u*i-f*a;return ut(e,t,r),n=e[0],i=e[1],a=e[2],o=e[3],e[4]=l*o+p*n+h*a-d*i,e[5]=h*o+p*i+d*n-l*a,e[6]=d*o+p*a+l*i-h*n,e[7]=p*o-l*n-h*i-d*a,e},rotateY:function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=s*o+c*n+u*a-f*i,h=u*o+c*i+f*n-s*a,d=f*o+c*a+s*i-u*n,p=c*o-s*n-u*i-f*a;return ft(e,t,r),n=e[0],i=e[1],a=e[2],o=e[3],e[4]=l*o+p*n+h*a-d*i,e[5]=h*o+p*i+d*n-l*a,e[6]=d*o+p*a+l*i-h*n,e[7]=p*o-l*n-h*i-d*a,e},rotateZ:function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],u=t[5],f=t[6],c=t[7],l=s*o+c*n+u*a-f*i,h=u*o+c*i+f*n-s*a,d=f*o+c*a+s*i-u*n,p=c*o-s*n-u*i-f*a;return ct(e,t,r),n=e[0],i=e[1],a=e[2],o=e[3],e[4]=l*o+p*n+h*a-d*i,e[5]=h*o+p*i+d*n-l*a,e[6]=d*o+p*a+l*i-h*n,e[7]=p*o-l*n-h*i-d*a,e},rotateByQuatAppend:function(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],u=t[1],f=t[2],c=t[3];return e[0]=s*o+c*n+u*a-f*i,e[1]=u*o+c*i+f*n-s*a,e[2]=f*o+c*a+s*i-u*n,e[3]=c*o-s*n-u*i-f*a,s=t[4],u=t[5],f=t[6],c=t[7],e[4]=s*o+c*n+u*a-f*i,e[5]=u*o+c*i+f*n-s*a,e[6]=f*o+c*a+s*i-u*n,e[7]=c*o-s*n-u*i-f*a,e},rotateByQuatPrepend:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],f=r[2],c=r[3];return e[0]=n*c+o*s+i*f-a*u,e[1]=i*c+o*u+a*s-n*f,e[2]=a*c+o*f+n*u-i*s,e[3]=o*c-n*s-i*u-a*f,s=r[4],u=r[5],f=r[6],c=r[7],e[4]=n*c+o*s+i*f-a*u,e[5]=i*c+o*u+a*s-n*f,e[6]=a*c+o*f+n*u-i*s,e[7]=o*c-n*s-i*u-a*f,e},rotateAroundAxis:function(e,t,r,n){if(Math.abs(n)<L)return Gt(e,t);var i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);n*=.5;var a=Math.sin(n),o=a*r[0]/i,s=a*r[1]/i,u=a*r[2]/i,f=Math.cos(n),c=t[0],l=t[1],h=t[2],d=t[3];e[0]=c*f+d*o+l*u-h*s,e[1]=l*f+d*s+h*o-c*u,e[2]=h*f+d*u+c*s-l*o,e[3]=d*f-c*o-l*s-h*u;var p=t[4],m=t[5],_=t[6],v=t[7];return e[4]=p*f+v*o+m*u-_*s,e[5]=m*f+v*s+_*o-p*u,e[6]=_*f+v*u+p*s-m*o,e[7]=v*f-p*o-m*s-_*u,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},multiply:Xt,mul:jt,scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},dot:Wt,lerp:function(e,t,r,n){var i=1-n;return Wt(t,r)<0&&(n=-n),e[0]=t[0]*i+r[0]*n,e[1]=t[1]*i+r[1]*n,e[2]=t[2]*i+r[2]*n,e[3]=t[3]*i+r[3]*n,e[4]=t[4]*i+r[4]*n,e[5]=t[5]*i+r[5]*n,e[6]=t[6]*i+r[6]*n,e[7]=t[7]*i+r[7]*n,e},invert:function(e,t){var r=Kt(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:zt,len:qt,squaredLength:Kt,sqrLen:Yt,normalize:function(e,t){var r=Kt(t);if(0<r){r=Math.sqrt(r);var n=t[0]/r,i=t[1]/r,a=t[2]/r,o=t[3]/r,s=t[4],u=t[5],f=t[6],c=t[7],l=n*s+i*u+a*f+o*c;e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=(s-n*l)/r,e[5]=(u-i*l)/r,e[6]=(f-a*l)/r,e[7]=(c-o*l)/r}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],f=e[7],c=t[0],l=t[1],h=t[2],d=t[3],p=t[4],m=t[5],_=t[6],v=t[7];return Math.abs(r-c)<=L*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-l)<=L*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-h)<=L*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-d)<=L*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-p)<=L*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=L*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-_)<=L*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(f-v)<=L*Math.max(1,Math.abs(f),Math.abs(v))}});function Qt(){var e=new y(2);return y!=Float32Array&&(e[0]=0,e[1]=0),e}function Jt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function $t(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function er(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function tr(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function rr(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function nr(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function ir(e){var t=e[0],r=e[1];return t*t+r*r}var ar,or=nr,sr=Jt,ur=$t,fr=er,cr=tr,lr=rr,hr=ir,dr=(ar=Qt(),function(e,t,r,n,i,a){var o=void 0,s=void 0;for(t||(t=2),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)ar[0]=e[o],ar[1]=e[o+1],i(ar,ar,a),e[o]=ar[0],e[o+1]=ar[1];return e}),pr=Object.freeze({create:Qt,clone:function(e){var t=new y(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new y(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:Jt,multiply:$t,divide:er,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},distance:tr,squaredDistance:rr,length:nr,squaredLength:ir,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return 0<i&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},lerp:function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},random:function(e,t){t=t||1;var r=2*A()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},transformMat2d:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},transformMat3:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},transformMat4:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},rotate:function(e,t,r,n){var i=t[0]-r[0],a=t[1]-r[1],o=Math.sin(n),s=Math.cos(n);return e[0]=i*s-a*o+r[0],e[1]=i*o+a*s+r[1],e},angle:function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],o=r*r+n*n;0<o&&(o=1/Math.sqrt(o));var s=i*i+a*a;0<s&&(s=1/Math.sqrt(s));var u=(r*i+n*a)*o*s;return 1<u?0:u<-1?Math.PI:Math.acos(u)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=L*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=L*Math.max(1,Math.abs(n),Math.abs(a))},len:or,sub:sr,mul:ur,div:fr,dist:cr,sqrDist:lr,sqrLen:hr,forEach:dr}),mr=function(){function r(e,t){E(this,r),this.min=e||[1/0,1/0,1/0],this.max=t||[-1/0,-1/0,-1/0]}return r.prototype.dirty=function(){return this._dirty=!0,this},r.prototype.getCenter=function(){return this.center||(this.center=[],this._dirty=!0),this._dirty&&(se(this.center,this.min,this.max),le(this.center,this.center,.5)),this._dirty=!1,this.center},r.prototype.containPoint=function(e){var t=this.min,r=this.max;return t[0]<=e[0]&&t[1]<=e[1]&&t[2]<=e[2]&&r[0]>=e[0]&&r[1]>=e[1]&&r[2]>=e[2]},r.prototype.isFinite=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this.min,t=this.max;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])}),r}(),_r={positionSize:3,primitive:"triangles",positionAttribute:"aPosition"},vr=function(){function a(e,t,r,n){E(this,a),this.data=e,this.elements=t,this.desc=v({},_r,n)||_r;var i=e[this.desc.positionAttribute];r||(t?r=gr(t):i&&i.length&&(r=i.length/this.desc.positionSize)),this.count=r,this.properties={},this.updateBoundingBox()}return a.prototype.generateBuffers=function(e){var t=this.data,r={};for(var n in t)t[n]&&(r[n]=t[n].buffer&&t[n].buffer.destroy?t[n]:{buffer:e.buffer(t[n])});this.data=r,this.elements&&!u(this.elements)&&(this.elements=this.elements.destroy?this.elements:e.elements({primitive:this.getPrimitive(),data:this.elements}))},a.prototype.updateData=function(e,t){var r=this.data[e];if(!r)return this;var n=void 0;return this.data[e]=t,r.buffer&&r.buffer.destroy&&(n=r),e===this.desc.positionAttribute&&this.updateBoundingBox(),n&&(n.buffer(t),this.data[e]=n),this},a.prototype.getPrimitive=function(){return this.desc.primitive},a.prototype.getAttributes=function(){return Object.keys(this.data)},a.prototype.getElements=function(){return this.elements},a.prototype.setElements=function(e,t){if(!e)throw new Error("elements data is invalid");var r=this.elements;if(this.count=void 0===t?gr(e):t,r.destroy){var n=v({},e,{primitive:this.getPrimitive()});this.elements=r(n)}else this.elements=e;return this},a.prototype.setDrawCount=function(e){return this.count1=e,this},a.prototype.getDrawCount=function(){return this.count1||this.count},a.prototype.setDrawOffset=function(e){return this.offset=e,this},a.prototype.getDrawOffset=function(){return this.offset||0},a.prototype.dispose=function(){this._forEachBuffer(function(e){e.destroy()}),delete this.elements,delete this.data,this._disposed=!0},a.prototype.isDisposed=function(){return!!this._disposed},a.prototype.updateBoundingBox=function(){var e=this.boundingBox;e||(e=this.boundingBox=new mr);var t=this.desc.positionAttribute,r=this.data[t];if(Array.isArray(r)||(r=r.data),r&&r.length){var n=e.min,i=e.max;oe(n,r[0],r[1],r[2]),oe(i,r[0],r[1],r[2]);for(var a=3;a<r.length;){var o=r[a++],s=r[a++],u=r[a++];o<n[0]&&(n[0]=o),s<n[1]&&(n[1]=s),u<n[2]&&(n[2]=u),o>i[0]&&(i[0]=o),s>i[1]&&(i[1]=s),u>i[2]&&(i[2]=u)}e.dirty()}},a.prototype.createBarycentric=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"aBarycentric",t=this.data[this.desc.positionAttribute];if(!g(t))throw new Error("Position data must be an array to create bary centric data");if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");for(var r=new Uint8Array(t.length/this.desc.positionSize*3),n=0,i=this.elements.length;n<i;)for(var a=0;a<3;a++){r[3*this.elements[n++]+a]=1}this.data[e]=r},a.prototype.buildUniqueVertex=function(){var e=this.data,t=this.elements;if(!g(t))throw new Error("elements must be array to build unique vertex.");var r=Object.keys(e),n={},i=e[this.desc.positionAttribute];if(!g(i))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");for(var a=i.length/this.desc.positionSize,o=t.length,s=0;s<r.length;s++){var u=r[s],f=e[u].length/a;if(!g(e[u]))throw new Error(u+" must be array to build unique vertex.");n[u]=e[u],n[u].size=f,e[u]=new e[u].constructor(o*f)}for(var c=0,l=0;l<o;l++){for(var h=t[l],d=0;d<r.length;d++)for(var p=r[d],m=e[p],_=n[p].size,v=0;v<_;v++)m[c*_+v]=n[p][h*_+v];t[l]=c++}},a.prototype._forEachBuffer=function(e){for(var t in this.elements&&this.elements.destroy&&e(this.elements),this.data)this.data.hasOwnProperty(t)&&this.data[t]&&this.data[t].buffer&&this.data[t].buffer.destroy&&e(this.data[t].buffer)},a}();function gr(e){if(u(e))return e;if(void 0!==e.length)return e.length;if(e.data)return e.data.length;throw new Error("invalid elements length")}var br,Er=l(function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];E(this,r),this.uniforms=v({},t||{},e),this._dirtyUniforms="texture",this.dirtyDefines=!0,this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=this._onTextureComplete.bind(this),this._checkTextures()}return r.prototype.isReady=function(){return this._loadingCount<=0},r.prototype.set=function(e,t){return this.uniforms[e]=t,this._dirtyUniforms=this.isTexture(e)?"texture":"primitive","texture"===this._dirtyUniforms&&this._checkTextures(),this},r.prototype.get=function(e){return this.uniforms[e]},r.prototype.isDirty=function(){return this._dirtyUniforms||this.dirtyDefines},r.prototype.getDefines=function(){return this.dirtyDefines&&(this.createDefines?this._defines=this.createDefines():this._defines={},this.dirtyDefines=!1),this._defines},r.prototype.getUniforms=function(e){if(!this._dirtyUniforms)return this._reglUniforms;var t={};for(var r in this.uniforms){var n=this.uniforms[r];this.isTexture(r)?"primitive"===this._dirtyUniforms&&this._reglUniforms[r]?t[r]=this._reglUniforms[r]:(this._reglUniforms[r]&&this._reglUniforms[r].destroy(),t[r]=n.getREGLTexture(e)):t[r]=n}return this._reglUniforms=t,this._dirtyUniforms=!1,t},r.prototype.isTexture=function(e){return this.uniforms[e]instanceof h},r.prototype.dispose=function(){for(var e in this.uniforms){var t=this.uniforms[e];t&&(t.dispose?t.dispose():t.destroy&&!t.__destroyed&&(t.destroy(),t.__destroyed=!0))}delete this.uniforms,delete this._reglUniforms,this._disposed=!0},r.prototype.isDisposed=function(){return!!this._disposed},r.prototype._checkTextures=function(){for(var e in this._loadingCount=0,this.uniforms)if(this.isTexture(e)){var t=this.uniforms[e];t.isReady()||(this._loadingCount++,t.on("complete",this._bindedOnTextureComplete))}},r.prototype._onTextureComplete=function(){this._loadingCount--,this._loadingCount<=0&&this.fire("complete")},r}()),yr=function(){function n(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};E(this,n),this.geometry=e,this.material=t,this.config=r,this.transparent=!!r.transparent,this.castShadow=o(r.castShadow)||r.castShadow,this.picking=!!r.picking,this.uniforms={},this.localTransform=V(new Array(16)),this.properties={}}return n.prototype.setParent=function(){return this.parent=parent,this},n.prototype.setLocalTransform=function(e){return this.localTransform=e,this},n.prototype.setUniform=function(e,t){return this.uniforms[e]=t,this},n.prototype.getUniform=function(e){return this.uniforms[e]},n.prototype.getDefines=function(){var e={};if(this.defines&&v(e,this.defines),this.material){var t=this.material.getDefines();t&&v(e,t)}return e},n.prototype.setDefines=function(e){return this.defines=e,this.dirtyDefines=!0,this},n.prototype.getDefinesKey=function(){return(!this._definesKey||this.dirtyDefines||this.material&&this.material.dirtyDefines)&&(this._definesKey=this._createDefinesKey(this.getDefines()),this.dirtyDefines=!1),this._definesKey},n.prototype.getUniforms=function(e){var t={modelMatrix:this.localTransform};for(var r in this.uniforms)t[r]=this.uniforms[r];if(this.material){var n=this.material.getUniforms(e);if(n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t},n.prototype.getMaterial=function(){return this.material},n.prototype.getAttributes=function(){return this.geometry.getAttributes()},n.prototype.getElements=function(){return this.geometry.getElements()},n.prototype.getREGLProps=function(){var e=v({},this.geometry.data);e.elements=this.geometry.getElements(),e.count=this.geometry.getDrawCount(),e.offset=this.geometry.getDrawOffset(),e.primitive=this.geometry.getPrimitive();var t=this.getUniforms();for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},n.prototype.dispose=function(){return delete this.geometry,delete this.material,delete this.uniforms,delete this.localTransform,this},n.prototype.isValid=function(){return this.geometry&&!this.geometry.isDisposed()&&(!this.material||!this.material.isDisposed())},n.prototype._createDefinesKey=function(e){var t=[];for(var r in e)t.push(r,e[r]);return t.join(",")},n}();yr.prototype.getWorldTransform=(br=[],function(){return parent?j(br,parent.getWorldTransform(),this.localTransform):this.localTransform});var Ar={getArrayBuffer:function(e,t){return Ar.get(e,{responseType:"arraybuffer"},t)},get:function(e,t,r){var n=Ar._getClient(r);if(n.open("GET",e,!0),t){for(var i in t.headers)n.setRequestHeader(i,t.headers[i]);n.withCredentials="include"===t.credentials,t.responseType&&(n.responseType=t.responseType)}return n.send(null),n},_wrapCallback:function(e,t){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?t(new Error("http status 200 returned without content.")):t(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):t(null,e.responseText):t(new Error(e.statusText+","+e.status)))}},_getClient:function(e){var t=void 0;try{t=new XMLHttpRequest}catch(e){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return t.onreadystatechange=Ar._wrapCallback(t,e),t}},Tr=l(function(){function t(e){E(this,t),this.defaultTexture=e,this.defaultCubeTexture=new Array(6),this.resources={}}return t.prototype.get=function(e,t){return Array.isArray(e)?this._loadImages(e,t):this._loadImage(e,t)},t.prototype.getArrayBuffer=function(e,r){var n=this;if((!this._count||this._count<0)&&(this._count=0),Array.isArray(e)){var t=e.map(function(e){return new Promise(function(r,n){Ar.getArrayBuffer(e,function(e,t){e?n(e):r(t.data)})})});return Promise.all(t).then(function(e){r(null,e),n._onComplete()},r),this._getBlankTextures(e.length)}return Ar.getArrayBuffer(e,function(e,t){r(e,t),n._onComplete()}),this.defaultTexture},t.prototype.disposeRes=function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){return t._disposeOne(e)}):this._disposeOne(e),this},t.prototype.isLoading=function(){return this._count&&0<this._count},t.prototype._disposeOne=function(e){var t=this.resources;t[e]&&(t[e].count--,t[e.count]<=0&&delete t[e])},t.prototype._loadImage=function(e,t,r){(!this._count||this._count<0)&&(this._count=0),this._count++;var n=this.resources;if(n[e])return t(null,n[e].image),this._onComplete(),n[e].image;var i=new Image,a=this;return i.onload=function(){n[e]={image:i,count:1},t(null,i),r||a._onComplete()},i.src=e,this.defaultTexture},t.prototype._loadImages=function(e,t){var i=this,r=e.map(function(e){return new Promise(function(r,n){i._loadImage(e,function(e,t){e&&n(e),r(t)},!0)})});return Promise.all(r).then(function(e){t(null,e),self._onComplete()},t),this._getBlankTextures(e.length)},t.prototype._onComplete=function(){this._count--,this._count<=0&&(this._count=0,this.fire("complete"))},t.prototype._getBlankTextures=function(e){for(var t=new Array(e),r=0;r<6;r++)t.push(this.defaultTexture);return t},t}()),Rr=[],Mr=[],xr="__scene_idx",Sr="__scene_o_idx",Cr="__scene_t_idx",Or=function(){function t(e){E(this,t),this.meshes=Array.isArray(e)?e:e?[e]:[],this.sortedMeshes={opaques:[],transparents:[]},this._compareBinded=this._compare.bind(this),this.dirty(),this._tag(this.meshes,xr)}return t.prototype.setMeshes=function(e){return this.meshes=Array.isArray(e)?e:[e],this.dirty(),this._tag(this.meshes,xr),this},t.prototype.addMesh=function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){e[xr]=t.meshes.length,t.meshes.push(e)}):(e[xr]=this.meshes.length,this.meshes.push(e)),this.dirty(),this},t.prototype.removeMesh=function(e){if(Array.isArray(e)){var t=void 0,r=void 0,n=void 0;e.sort(wr);for(var i=0;i<e.length;i++)this.meshes[e[i][xr]]===e[i]&&(t=!0,this.meshes.splice(e[i][xr],1));e.sort(Nr);for(var a=0;a<e.length;a++)this.sortedMeshes.opaques[e[a][Sr]]===e[a]&&(r=!0,this.sortedMeshes.opaques.splice(e[a][Sr],1));e.sort(Fr);for(var o=0;o<e.length;o++)this.sortedMeshes.transparents[e[o][Cr]]===e[o]&&(n=!0,this.sortedMeshes.transparents.splice(e[o][Cr],1));t&&this._tag(this.meshes,xr),r&&this._tag(this.sortedMeshes.opaques,Sr),n&&this._tag(this.sortedMeshes.transparents,Cr)}else this.meshes[e[xr]]===e&&(this.meshes.splice(e[xr],1),this._tag(this.meshes,xr)),this.sortedMeshes.opaques[e[Sr]]===e?(this.sortedMeshes.opaques.splice(e[Sr],1),this._tag(this.sortedMeshes.opaques,Sr)):this.sortedMeshes.opaques[e[Cr]]===e&&(this.sortedMeshes.transparents.splice(e[Cr],1),this._tag(this.sortedMeshes.transparents,Cr));return this},t.prototype.getMeshes=function(){return this.meshes},t.prototype.clear=function(){return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this},t.prototype.dirty=function(){return this._dirty=!0,this},t.prototype.sortMeshes=function(e){var t=this.meshes,r=this.sortedMeshes.transparents;if(this._dirty){var n=this.sortedMeshes.opaques=[];r=this.sortedMeshes.transparents=[];for(var i=0,a=t.length;i<a;i++)t[i].transparent?(t[i][Cr]=r.length,r.push(t[i])):(t[i][Sr]=n.length,n.push(t[i]))}e&&1<r.length&&(this._cameraPosition=e,r.sort(this._compareBinded),delete this._cameraPosition),this._dirty=!1},t.prototype.getSortedMeshes=function(){return this._dirty&&this.sortMeshes(),this.sortedMeshes},t.prototype._compare=function(e,t){return ge(Rr,e.geometry.boundingBox.getCenter(),e.localTransform),ge(Mr,t.geometry.boundingBox.getCenter(),t.localTransform),Te(Mr,this._cameraPosition)-Te(Rr,this._cameraPosition)},t.prototype._tag=function(e,t){for(var r=0;r<e.length;r++)e[r][t]=r},t}();function wr(e,t){return t[xr]-e[xr]}function Nr(e,t){return t[Sr]-e[Sr]}function Fr(e,t){return t[Cr]-e[Cr]}var Ir=String.fromCharCode,Lr=8,Dr=32767;function Pr(e,t,r,n){if(0<e[3]){var i=Math.pow(2,e[3]-128-8+n);t[r+0]=e[0]*i,t[r+1]=e[1]*i,t[r+2]=e[2]*i}else t[r+0]=0,t[r+1]=0,t[r+2]=0;return t[r+3]=1,t}function Br(e,t,r,n){for(var i,a,o=0,s=0,u=n;0<u;)if(e[s][0]=t[r++],e[s][1]=t[r++],e[s][2]=t[r++],e[s][3]=t[r++],1===e[s][0]&&1===e[s][1]&&1===e[s][2]){for(var f=e[s][3]<<o>>>0;0<f;f--)i=e[s-1],(a=e[s])[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],s++,u--;o+=8}else s++,u--,o=0;return r}function Ur(e,t,r,n){if(n<Lr|Dr<n)return Br(e,t,r,n);if(2!=(i=t[r++]))return Br(e,t,r-1,n);if(e[0][1]=t[r++],e[0][2]=t[r++],i=t[r++],(e[0][2]<<8>>>0|i)>>>0!==n)return null;for(var i=0;i<4;i++)for(var a=0;a<n;){var o=t[r++];if(128<o){o=(127&o)>>>0;for(var s=t[r++];o--;)e[a++][i]=s}else for(;o--;)e[a++][i]=t[r++]}return r}function kr(e,t){null==t&&(t=0);var r=new Uint8Array(e),n=r.length;if("#?"===function(e,t,r){for(var n="",i=t;i<r;i++)n+=Ir(e[i]);return n}(r,0,2)){for(var i=2;i<n&&("\n"!==Ir(r[i])||"\n"!==Ir(r[i+1]));i++);if(!(n<=i)){i+=2;for(var a="";i<n;i++){var o=Ir(r[i]);if("\n"===o)break;a+=o}var s=a.split(" "),u=parseInt(s[1]),f=parseInt(s[3]);if(f&&u){for(var c=i+1,l=[],h=0;h<f;h++){l[h]=[];for(var d=0;d<4;d++)l[h][d]=0}for(var p=new Array(f*u*4),m=0,_=0;_<u;_++){if(!(c=Ur(l,r,c,f)))return null;for(h=0;h<f;h++)Pr(l[h],p,m,t),m+=4}return{width:f,height:u,pixels:p}}}}}var Gr=function(e){function t(){return E(this,t),c(this,e.apply(this,arguments))}return f(t,e),t.prototype.onLoad=function(e,t){var r=this.config;r.hdr?(t=kr(t.data),r.data=t.pixels):r.data=t,r.width=r.width||t.width,r.height=r.height||t.height,this._updateREGL()},t.prototype.createREGLTexture=function(e){return e.texture(this.config)},t}(h),Hr=function(e){function t(){return E(this,t),c(this,e.apply(this,arguments))}return f(t,e),t.prototype.onLoad=function(e,t){var r=this.config,n=this._createFaces(t);r.faces=n,this._updateREGL()},t.prototype.createREGLTexture=function(e){return e.cube(this.config)},t.prototype._createFaces=function(){return[]},t}(h),Vr=function(t){function r(e){return E(this,r),c(this,t.call(this,{aPosition:[-.5,-.5,e||0,.5,-.5,e||0,-.5,.5,e||0,.5,.5,e||0],aNormal:[0,1,0,0,1,0,0,1,0,0,1,0]},[3,1,0,0,2,3]))}return f(r,t),r}(vr),Xr={vsm_shadow_vert:"\nuniform mat4 vsm_shadow_lightProjViewModelMatrix[NUM_OF_DIR_LIGHTS];\nvarying vec4 vsm_shadow_vLightSpacePos[NUM_OF_DIR_LIGHTS];\nvoid shadow_computeShadowPars(vec4 position) {\n    for (int i = 0; i < NUM_OF_DIR_LIGHTS; i++) {\n        vsm_shadow_vLightSpacePos[i] = vsm_shadow_lightProjViewModelMatrix[i] * position;\n    }\n}\n",vsm_shadow_frag:"\nuniform sampler2D vsm_shadow_shadowMap[NUM_OF_DIR_LIGHTS];\nvarying vec4 vsm_shadow_vLightSpacePos[NUM_OF_DIR_LIGHTS];\nfloat vsm_shadow_chebyshevUpperBound(sampler2D shadowMap, vec3 projCoords){\n    vec2 moments = texture2D(shadowMap, projCoords.xy).rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\nfloat shadow_computeShadow(int dirLightIdx) {\n    for (int i = 0; i < NUM_OF_DIR_LIGHTS; i++) {\n        if (i == dirLightIdx) {\n            vec3 projCoords = vsm_shadow_vLightSpacePos[i].xyz / vsm_shadow_vLightSpacePos[i].w;\n            projCoords = projCoords * 0.5 + 0.5;\n            return vsm_shadow_chebyshevUpperBound(vsm_shadow_shadowMap[i], projCoords);\n        }\n    }\n}\n",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#ifdef USE_PICKING_ID\nattribute float aPickingId;\nvarying float vPickingId;\n#endif\nvarying float vFbo_picking_viewZ;\n#endif\nvoid fbo_picking_setData(float viewPosZ) {\n    #ifdef ENABLE_PICKING\n    #ifdef USE_PICKING_ID\n        vPickingId = aPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n}\n"},jr=function(e){return zr(e)},Wr=/^[ \t]*#include +<([\w\d.]+)>/gm;function zr(e){return e.replace(Wr,qr)}function qr(e,t){var r=Xr[t];if(!r)throw new Error("Can not resolve #include <"+t+">");return zr(r)}var Kr="function",Yr="array",Zr=function(){function m(e){var t=e.vert,r=e.frag,n=e.uniforms,i=e.defines,a=e.extraCommandProps;E(this,m),this.vert=t,this.frag=r,this.shaderDefines=i||{},n=n||[],this.contextDesc={};for(var o=0,s=n.length;o<s;o++){var u=n[o];if(_(u))if(0<u.indexOf("[")){var f=Qr(u),c=f.name,l=f.len;this.contextDesc[c]={name:c,type:"array",length:l}}else this.contextDesc[u]=null;else if(0<u.name.indexOf("[")){var h=Qr(u.name),d=h.name,p=h.len;this.contextDesc[d]={name:d,type:"array",length:p,fn:u.fn}}else this.contextDesc[u.name]=u}this.extraCommandProps=a||{},this.commands={},this._compileSource()}return m.prototype.setFramebuffer=function(e){return this.context.framebuffer=e,this},m.prototype.getUniforms=function(e){var t=this.context,r=v({},t,e),n={},i=this.contextDesc;for(var a in i)if(i[a]&&"array"===i[a].type){var o=a,s=i[a].length,u=t[a];if(i[a].fn&&(u=i[a].fn(t,r)),u.length!==s)throw new Error(o+" uniform's length is not "+s);n[o]={};for(var f=0;f<s;f++)n[o][""+f]=u[f]}else n[a]=t[a];for(var c in t)n[c]||(n[c]=t[c]);return n},m.prototype.setUniforms=function(e){return this.context=e,this},m.prototype.createREGLCommand=function(t,e,r,n,i){n=n||[],r=r||[];var a=v({},this.shaderDefines||{},e||{}),o=this._insertDefines(this.vert,a),s=this._insertDefines(this.frag,a),u={};r.forEach(function(e){u[e]=t.prop(e)});var f={};n.forEach(function(e){f[e]=t.prop(e)});var c=this.contextDesc;for(var l in c)if(c[l]&&c[l].type===Kr)f[l]=c[l].fn;else if(c[l]&&c[l].type===Yr)for(var h=c[l].name,d=c[l].length,p=0;p<d;p++){var m=h+"["+p+"]";f[m]=t.prop(m)}else f[l]=t.prop(l);var _={vert:o,frag:s,uniforms:f,attributes:u};return i&&(_.elements=t.prop("elements")),_.count=t.prop("count"),_.offset=t.prop("offset"),_.primitive=t.prop("primitive"),_.framebuffer=t.prop("framebuffer"),v(_,this.extraCommandProps),t(_)},m.prototype.dispose=function(){},m.prototype._insertDefines=function(e,t){var r=[];for(var n in t)t.hasOwnProperty(n)&&!s(t[n])&&r.push("#define "+n+" "+t[n]+"\n");return r.join("")+e},m.prototype._compileSource=function(){this.vert=jr(this.vert),this.frag=jr(this.frag)},m}();function Qr(e){var t=e.indexOf("["),r=e.indexOf("]");return{name:e.substring(0,t),len:+e.substring(t+1,r)}}var Jr=function(e){function t(){return E(this,t),c(this,e.apply(this,arguments))}return f(t,e),t.prototype.draw=function(e,t){for(var r=[],n=void 0,i=0,a=t.length;i<a;i++)if(t[i].isValid())if(t[i].geometry.count&&this.filter(t[i])){var o=this.getMeshCommand(e,t[i]);r.length&&n!==o&&(n(r),r.length=0);var s=t[i].getREGLProps();r.push(v({},this.getUniforms(s),s)),i<a-1?n=o:i===a-1&&o(r)}else i===a-1&&n&&r.length&&n(r);return this},t.prototype.filter=function(){return!0},t.prototype.getMeshCommand=function(e,t){var r=Object.keys(t.getUniforms(e)),n=t.getDefinesKey(),i=t.getDefines();n+="_"+(u(t.getElements())?"count":"elements");var a=this.commands[n];return a||(a=this.commands[n]=this.createREGLCommand(e,i,t.getAttributes(),r,t.getElements())),a},t}(Zr),$r=function(a){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};E(this,o);var t=e.extraCommandProps||{},r=e.positionAttribute||"aPosition",n=e.barycentricAttribute||"aBarycentric";t=v({},t,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}});var i="attribute vec3 aPosition;\nattribute vec3 aBarycentric;\nuniform mat4 projViewModelMatrix;\nvarying vec3 vBC;\nvoid main() {\n    vBC = aBarycentric;\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n}\n";return"aPosition"!==r&&(i=i.replace(/aPosition/g,r)),"aBarycentric"!==n&&(i=i.replace(/aBarycentric/g,n)),c(this,a.call(this,{vert:i,frag:"precision mediump float;\nvarying vec3 vBC;\nuniform float lineWidth;\nuniform float alpha;\nuniform vec4 frontColor;\nuniform vec4 backColor;\nuniform vec4 fillColor;\n#extension GL_OES_standard_derivatives : enable\nfloat edgeFactor() {\n    vec3 d = fwidth(vBC);\n    vec3 a3 = smoothstep(vec3(0.0), d * lineWidth, vBC);\n    return min(min(a3.x, a3.y), a3.z);\n}\nvoid main() {\n    if(gl_FrontFacing) {\n        gl_FragColor = (fillColor * edgeFactor() + frontColor * (1.0 - edgeFactor())) * alpha;\n    } else {\n        gl_FragColor = (fillColor * edgeFactor() + backColor * (1.0 - edgeFactor())) * alpha;\n    }\n}\n",uniforms:["frontColor","backColor","lineWidth","alpha","fillColor",{name:"projViewModelMatrix",type:"function",fn:function(e,t){return j([],t.projViewMatrix,t.modelMatrix)}}],extraCommandProps:t}))}return f(o,a),o}(Jr),en={vertices:[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]},tn="precision mediump float;\nvarying vec3 vWorldPos;\nuniform samplerCube cubeMap;\nvoid main()\n{\n    vec3 envColor = textureCube(cubeMap, vWorldPos).rgb;\n    #ifdef USE_HDR\n    envColor = envColor / (envColor + vec3(1.0));\n    envColor = pow(envColor, vec3(1.0/2.2));\n    #endif\n    gl_FragColor = vec4(envColor, 1.0);\n}\n",rn=void 0,nn=void 0,an=void 0;var on,sn,un,fn,cn,ln=Object.freeze({drawSkybox:function(e,t,r,n,i,a){var o=void 0;an=an||{vert:"    attribute vec3 aPosition;\n    uniform mat4 projMatrix;\n    uniform mat4 viewMatrix;\n    varying vec3 vWorldPos;\n    void main()\n    {\n        vWorldPos = aPosition;\n        mat4 rotViewMatrix = mat4(mat3(viewMatrix));        vec4 clipPos = projMatrix * rotViewMatrix * vec4(vWorldPos, 1.0);\n        gl_Position = clipPos.xyww;\n    }\n",attributes:{aPosition:en.vertices},uniforms:{cubeMap:e.prop("cubeMap"),viewMatrix:e.prop("viewMatrix"),projMatrix:e.prop("projMatrix")},count:en.vertices.length/3,framebuffer:e.prop("frameBuffer"),depth:{enable:!0,func:"lequal"}},i?(an.frag="#define USE_HDR \n"+tn,o=nn=nn||e(an)):(an.frag=tn,o=rn=rn||e(an)),o({cubeMap:t,viewMatrix:r,projMatrix:n,frameBuffer:a})}}),hn=(sn=[J([],on=[0,0,0],[1,0,0],[0,-1,0]),J([],on,[-1,0,0],[0,-1,0]),J([],on,[0,1,0],[0,0,1]),J([],on,[0,-1,0],[0,0,-1]),J([],on,[0,0,1],[0,-1,0]),J([],on,[0,0,-1],[0,-1,0])],un=90*Math.PI/180,fn=[0,0,0,0],cn=new Array(16),function(e,n,t,r,i){var a={context:{viewMatrix:function(e,t,r){return sn[r]},projMatrix:Z(cn,un,1,.5,1.1)}};return n&&(n.faces?a.framebuffer=function(e,t,r){return n.faces[r]}:a.framebuffer=n),e(a)(6,function(){e.clear({color:fn,depth:1}),t(r),i&&i()}),n}),dn={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},pn="attribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main()\n{\n    vWorldPos = aPosition;\n    gl_Position =  projMatrix * viewMatrix * vec4(vWorldPos, 1.0);\n}\n",mn="//cubemap\nprecision mediump float;\n\nvarying vec3 vWorldPos;\n\nuniform sampler2D equirectangularMap;\n\nconst vec2 invAtan = vec2(0.1591, 0.3183);\nvec2 SampleSphericalMap(vec3 v)\n{\n    vec2 uv = vec2(atan(v.y, v.x), asin(v.z));\n    uv *= invAtan;\n    uv += 0.5;\n    return uv;\n}\n\nvoid main()\n{\n    vec2 uv = SampleSphericalMap(normalize(vWorldPos)); // make sure to normalize localPos\n    vec3 color = texture2D(equirectangularMap, uv).rgb;\n\n    gl_FragColor = vec4(color, 1.0);\n    // gl_FragColor = vec4(uv, 0.0, 1.0);\n}\n\n",_n="precision mediump float;\n\nvarying vec3 vWorldPos;\n\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\n\nconst float PI = 3.14159265359;\n\n// ----------------------------------------------------------------------------\n// float DistributionGGX(vec3 N, vec3 H, float roughness)\n// {\n//     float a = roughness*roughness;\n//     float a2 = a*a;\n//     float NdotH = max(dot(N, H), 0.0);\n//     float NdotH2 = NdotH*NdotH;\n\n//     float nom   = a2;\n//     float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n//     denom = PI * denom * denom;\n\n//     return nom / denom;\n// }\n\n// ----------------------------------------------------------------------------\nvec3 ImportanceSampleGGX(float Xi, vec3 N, float roughness)\n{\n    vec3 H = texture2D(distributionMap, vec2(roughness, Xi)).rgb;\n    \n    // from tangent-space H vector to world-space sample vector\n    vec3 up          = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangent   = normalize(cross(up, N));\n    vec3 bitangent = cross(N, tangent);\n    \n    vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n    return normalize(sampleVec);\n}\n// ----------------------------------------------------------------------------\nvoid main()\n{\t\t\n    vec3 N = normalize(vWorldPos);\n    \n    // make the simplyfying assumption that V equals R equals the normal \n    vec3 R = N;\n    vec3 V = R;\n\n    const int SAMPLE_COUNT = 1024;\n    vec3 prefilteredColor = vec3(0.0);\n    float totalWeight = 0.0;\n    \n    for(int i = 0; i < SAMPLE_COUNT; ++i)\n    {\n        // generates a sample vector that's biased towards the preferred alignment direction (importance sampling).\n        vec3 H = ImportanceSampleGGX(float(i) / float(SAMPLE_COUNT), N, roughness);\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(dot(N, L), 0.0);\n        if(NdotL > 0.0)\n        {\n            // a more precision method,  sample from the environment's mip level based on roughness/pdf\n            // float D   = DistributionGGX(N, H, roughness);\n            // float NdotH = max(dot(N, H), 0.0);\n            // float HdotV = max(dot(H, V), 0.0);\n            // float pdf = D * NdotH / (4.0 * HdotV) + 0.0001; \n\n            // float resolution = 512.0; // resolution of source cubemap (per face)\n            // float saTexel  = 4.0 * PI / (6.0 * resolution * resolution);\n            // float saSample = 1.0 / (float(SAMPLE_COUNT) * pdf + 0.0001);\n\n            // float mipLevel = roughness == 0.0 ? 0.0 : 0.5 * log2(saSample / saTexel); \n            \n            // prefilteredColor += textureCube(environmentMap, L, mipLevel).rgb * NdotL;\n            // totalWeight      += NdotL;\n            //--------------------------------------------------------\n            prefilteredColor += textureCube(environmentMap, L).rgb * NdotL;\n            totalWeight      += NdotL;\n        }\n    }\n\n    prefilteredColor = prefilteredColor / totalWeight;\n\n    gl_FragColor = vec4(prefilteredColor, 1.0);\n    // gl_FragColor = vec4(totalWeight, 0.0, 0.0, 1.0);\n    // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",vn="// BRDF LUT\nprecision mediump float;\n\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\n\nconst float PI = 3.14159265359;\n\nvec3 ImportanceSampleGGX(float Xi, vec3 N, float roughness)\n{\n    vec3 H = texture2D(distributionMap, vec2(roughness, Xi)).rgb;\n    \n    // from tangent-space H vector to world-space sample vector\n    vec3 up          = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangent   = normalize(cross(up, N));\n    vec3 bitangent = cross(N, tangent);\n    \n    vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n    return normalize(sampleVec);\n}\n// ----------------------------------------------------------------------------\nfloat GeometrySchlickGGX(float NdotV, float roughness)\n{\n    // note that we use a different k for IBL\n    float a = roughness;\n    float k = (a * a) / 2.0;\n\n    float nom   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return nom / denom;\n}\n// ----------------------------------------------------------------------------\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n// ----------------------------------------------------------------------------\nvec2 IntegrateBRDF(float NdotV, float roughness)\n{\n    vec3 V;\n    V.x = sqrt(1.0 - NdotV*NdotV);\n    V.y = 0.0;\n    V.z = NdotV;\n\n    float A = 0.0;\n    float B = 0.0; \n\n    vec3 N = vec3(0.0, 0.0, 1.0);\n    \n    const int SAMPLE_COUNT = 1024;\n    for(int i = 0; i < SAMPLE_COUNT; ++i)\n    {\n        // generates a sample vector that's biased towards the\n        // preferred alignment direction (importance sampling).\n        vec3 H = ImportanceSampleGGX(float(i) / float(SAMPLE_COUNT), N, roughness);\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(L.z, 0.0);\n        float NdotH = max(H.z, 0.0);\n        float VdotH = max(dot(V, H), 0.0);\n\n        if(NdotL > 0.0)\n        {\n            float G = GeometrySmith(N, V, L, roughness);\n            float G_Vis = (G * VdotH) / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    A /= float(SAMPLE_COUNT);\n    B /= float(SAMPLE_COUNT);\n    return vec2(A, B);\n}\n// ----------------------------------------------------------------------------\nvoid main() \n{\n    vec2 integratedBRDF = IntegrateBRDF(vTexCoords.x, vTexCoords.y);\n    gl_FragColor = vec4(integratedBRDF, 0.0, 1.0);\n    // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",gn="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoords;\n\nvoid main()\n{\n    vTexCoords = aTexCoord;\n    gl_Position = vec4(aPosition, 1.0);\n}\n",bn="precision mediump float;\n\nvarying vec3 vWorldPos;\n\nuniform samplerCube environmentMap;\n\nconst float PI = 3.14159265359;\n\nvoid main()\n{\t\t\n    vec3 N = normalize(vWorldPos);\n\n    vec3 irradiance = vec3(0.0);   \n    \n    // tangent space calculation from origin point\n    vec3 up    = vec3(0.0, 1.0, 0.0);\n    vec3 right = cross(up, N);\n    up         = cross(N, right);\n    \n    const float sampleDelta = 0.025;\n    float nrSamples = 0.0;\n    const float twoPI = 2.0 * PI;\n    for(float phi = 0.0; phi < twoPI; phi += sampleDelta)\n    {\n        for(float theta = 0.0; theta < 0.5 * PI; theta += sampleDelta)\n        {\n            // spherical to cartesian (in tangent space)\n            vec3 tangentSample = vec3(sin(theta) * cos(phi),  sin(theta) * sin(phi), cos(theta));\n            // tangent space to world\n            vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * N; \n\n            irradiance += textureCube(environmentMap, sampleVec).rgb * cos(theta) * sin(theta);\n            nrSamples++;\n        }\n    }\n    irradiance = PI * irradiance * (1.0 / float(nrSamples));\n    \n    gl_FragColor = vec4(irradiance, 1.0);\n}\n\n";var En=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],yn=[0,1,0,0,1,1,1,0],An={};function Tn(e,t){for(var r=new Array(e*t*4),n=0;n<e;n++)for(var i=Rn(n,e),a=i.x,o=i.y,s=0;s<t;s++){var u=s/t,f=u*u,c=2*Math.PI*a,l=Math.sqrt((1-o)/(1+(f*f-1)*o)),h=Math.sqrt(1-l*l),d=4*(n*t+s);r[d]=h*Math.cos(c),r[d+1]=h*Math.sin(c),r[d+2]=l,r[d+3]=1}return r}function Rn(e,t){var r=(e<<16|e>>>16)>>>0;return{x:e/t,y:r=(((16711935&(r=((252645135&(r=((858993459&(r=((1431655765&r)<<1|(2863311530&r)>>>1)>>>0))<<2|(3435973836&r)>>>2)>>>0))<<4|(4042322160&r)>>>4)>>>0))<<8|(4278255360&r)>>>8)>>>0)/4294967296}}var Mn,xn,Sn,Cn,On,wn,Nn,Fn,In,Ln,Dn,Pn=Object.freeze({createIBLMaps:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.envTexture,n=t.envCubeSize||512,i=t.irradianceCubeSize||32,a=t.sampleSize||1024,o=t.roughnessLevels||256,s=t.prefilterCubeSize||256,u=t.brdfSize||512,f=function(e,t,r){r=r||512;var n=e({frag:mn,vert:pn,attributes:{aPosition:dn.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),equirectangularMap:t},elements:dn.indices}),i=e.framebufferCube(r);return hn(e,i,n),i}(e,r,n);return{envMap:f,irradianceMap:function(e,t,r){r=r||32;var n=e.framebufferCube({radius:r,color:e.cube({radius:r,wrap:"clamp",min:"linear",mag:"linear"})}),i=e({frag:bn,vert:pn,attributes:{aPosition:dn.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),environmentMap:t},elements:dn.indices});return hn(e,n,i),n}(e,f,i),prefilterMap:function(n,e,t,r,i){for(var a=Tn(r=r||1024,i=i||256),o=n.texture({data:a,width:i,height:r,min:"nearest",mag:"nearest"}),s=n({frag:_n,vert:pn,attributes:{aPosition:dn.vertices},uniforms:{projMatrix:n.context("projMatrix"),viewMatrix:n.context("viewMatrix"),environmentMap:e,distributionMap:o,roughness:n.prop("roughness")},elements:dn.indices,viewport:{x:0,y:0,width:n.prop("size"),height:n.prop("size")}}),u=t,f=n.framebuffer(u),c=Math.log(u)/Math.log(2)+1,l=[],h=function(e){var t=e/(c-1),r=0;hn(n,f,s,{roughness:t,size:u},function(){var e=n.read();l[r]||(l[r]={mipmap:[]}),l[r].mipmap.push(e),r++}),e<c-1&&(u/=2,f.resize(u))},d=0;d<c;d++)h(d);return n.cube({radius:t,min:"linear mipmap linear",mag:"linear",faces:l})}(e,f,s,a,o),brdfLUT:function(e,t,r,n){var i=t+"-"+(r=r||1024)+"-"+(n=n||256),a=void 0;An[i]?a=An[i]:(a=Tn(r,n),An[i]=a);var o=e.texture({data:a,width:n,height:r,type:"float",min:"nearest",mag:"nearest"}),s=e.buffer(En),u=e.buffer(yn),f=e.framebuffer({radius:t,type:"float",min:"nearest",mag:"nearest"});return e({frag:vn,vert:gn,attributes:{aPosition:{buffer:s},aTexCoord:{buffer:u}},uniforms:{distributionMap:o},framebuffer:f,viewport:{x:0,y:0,width:t,height:t},count:En.length/3,primitive:"triangle strip"})(),f}(e,u,a,o)}}}),Bn={albedoMap:null,albedoColor:[1,1,1],metallic:0,roughness:.5,occulusionRoughnessMetallicMap:null,normalMap:null,normalStrength:1,emissionMap:null},Un=function(t){function r(e){return E(this,r),c(this,t.call(this,e,Bn))}return f(r,t),r.prototype.createDefines=function(){var e=this.uniforms,t={};return e.albedoMap&&(t.USE_ALBEDO_MAP=1),e.normalMap&&(t.USE_NORMAL_MAP=1),e.occulusionRoughnessMetallicMap&&(t.USE_OCCULUSIONROUGHNESSMETALLIC_MAP=1),t},r}(Er),kn=function(e){function t(){return E(this,t),c(this,e.call(this,{vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nvarying vec4 vPosition;\nvoid main()\n{\n    gl_Position = lightProjViewModelMatrix * vec4(aPosition, 1.);\n    vPosition = gl_Position;\n}\n",frag:"#extension GL_OES_standard_derivatives : enable\nprecision mediump float;\nvarying vec4 vPosition;\nvoid main()\n{\n    float depth = vPosition.z / vPosition.w;\n    depth = depth * 0.5 + 0.5;\n    float moment1 = depth;\n    float moment2 = depth * depth;\n    float dx = dFdx(depth);\n    float dy = dFdy(depth);\n    moment2 += 0.25 * (dx * dx + dy * dy);\n    gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\n}\n",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(e,t){return j([],t.lightProjViewMatrix,t.modelMatrix)}}]}))}return f(t,e),t.prototype.filter=function(e){return e.castShadow},t.prototype.getMeshCommand=function(e,t){return this.commands.vsm||(this.commands.vsm=this.createREGLCommand(e,null,t.getAttributes(),null,t.getElements())),this.commands.vsm},t}(Jr),Gn=new Float32Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),Hn=new Float32Array([0,1,0,0,1,1,1,0]),Vn=function(r){function n(e){var t=e.blurOffset;return E(this,n),c(this,r.call(this,{vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main()\n{\n  gl_Position = vec4(aPosition, 1.);\n  vTexCoord = aTexCoord;\n}\n",frag:"precision mediump float;\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D textureSource;\nuniform vec2 textureSize;\n\nvoid main()\n{\n    vec2 c = vec2(0.0);\n    for (int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for (int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y)\n\t{\n        c += texture2D(textureSource, vTexCoord.st + vec2(float(x) / textureSize.x, float(y) / textureSize.y)).rg;\n\t}\n    vec2 color = c / float((2 * BOXBLUR_OFFSET + 1) * (2 * BOXBLUR_OFFSET + 1));\n    gl_FragColor = vec4(color, 0.0, 1.0);\n}\n",uniforms:["textureSource","textureSize"],defines:{BOXBLUR_OFFSET:t||2}}))}return f(n,r),n.prototype.getMeshCommand=function(e,t){return this.commands.shadow||(this.commands.shadow=this.createREGLCommand(e,null,t.getAttributes(),null,t.getElements())),this.commands.shadow},n}(function(t){function e(){return E(this,e),c(this,t.apply(this,arguments))}return f(e,t),e.prototype.draw=function(e){return this._quadMesh||this._createQuadMesh(e),t.prototype.draw.call(this,e,this._quadMesh)},e.prototype.getMeshCommand=function(e){return this.commands.quad||(this.commands.quad=this.createREGLCommand(e,null,this._quadMesh[0].getAttributes(),null,this._quadMesh[0].getElements())),this.commands.quad},e.prototype._createQuadMesh=function(e){var t=new vr({aPosition:Gn,aTexCoord:Hn},null,Gn.length/3,{primitive:"triangle strip"});t.generateBuffers(e),this._quadMesh=[new yr(t)]},e.prototype.dispose=function(){if(this._quadMesh){var e=this._quadMesh[0];e.geometry.dispose(),e.dispose()}return delete this._quadMesh,t.prototype.dispose.call(this)},e}(Jr)),Xn=void 0,jn=void 0,Wn=function(){function a(e,t){var r=t.width,n=t.height,i=t.blurOffset;E(this,a),this.renderer=e,this.width=r||512,this.height=n||512,this.blurOffset=o(i)?2:i,this._init()}return a.prototype.render=function(e,t){var r=t.cameraProjViewMatrix,n=t.lightDir,i=t.farPlane;return{lightProjViewMatrix:this._renderShadow(e,r,n,i),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}},a.prototype.resize=function(e,t){return this.depthTex&&(this.depthTex.resize(e,t),this.depthFBO.resize(e,t)),this.blurFBO&&(this.blurTex.resize(e,t),this.blurFBO.resize(e,t)),this},a.prototype._renderShadow=function(e,t,r,n){var i=this.renderer;this.vsmShader||(this.vsmShader=new kn);var a=Xn(t);if(n)for(var o=4;o<8;o++)a[o]=n[o-4];var s=jn(a,r);return i.clear({color:[0,0,0,1],depth:1,framebuffer:this.depthFBO}),i.render(this.vsmShader,{lightProjViewMatrix:s},e,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new Vn({blurOffset:this.blurOffset})),i.clear({color:[0,0,0,1],depth:1,framebuffer:this.blurFBO}),i.render(this.boxBlurShader,{textureSize:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),s},a.prototype._init=function(){var e=this.renderer.regl,t=this.width,r=this.height;this.depthTex=e.texture({width:t,height:r,format:"rgb",type:"float",min:"linear",mag:"linear"}),this.depthFBO=e.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=e.texture({width:t,height:r,format:"rgb",type:"float",min:"linear",mag:"linear"}),this.blurFBO=e.framebuffer({color:this.blurTex}))},a.prototype.dispose=function(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.vsmShader&&(this.vsmShader.dispose(),delete this.vsmShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)},a}();Mn=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],xn=new Array(16),Xn=function(e){X(xn,e);for(var t=[],r=0;r<Mn.length;r++){var n=ze([],Mn[r],xn);Ue(n,n,1/n[3]),t.push(n)}return t},Sn=new Array(4),Cn=[0,0,0,0],On=[0,1,0],wn=new Array(3),Nn=new Array(16),Fn=new Array(16),In=new Array(16),Ln=[1,1,1],Dn=[0,0,0],jn=function(e,t){Ue(Cn,Cn,0);for(var r=4;r<e.length;r++)Le(Cn,Cn,e[r]);Ue(Cn,Cn,.25),Nn=J(Nn,se(wn,Cn,me(wn,t)),Cn,On),ze(Sn,e[0],Nn);for(var n=Sn[2],i=Sn[2],a=Sn[0],o=Sn[0],s=Sn[1],u=Sn[1],f=1;f<8;f++)(Sn=ze(Sn,e[f],Nn))[2]>i&&(i=Sn[2]),Sn[2]<n&&(n=Sn[2]),Sn[0]>o&&(o=Sn[0]),Sn[0]<a&&(a=Sn[0]),Sn[1]>u&&(u=Sn[1]),Sn[1]<s&&(s=Sn[1]);Fn=Q(Fn,-1,1,-1,1,-i,-n);var c=Ln[0]=2/(o-a),l=Ln[1]=-2/(u-s);Dn[0]=-.5*(a+o)*c,Dn[1]=-.5*(s+u)*l,V(In),W(In,In,Dn),z(In,In,Ln);var h=j(Fn,In,Fn);return j(new Array(16),h,Nn)};var zn=function(t){function r(e){return E(this,r),c(this,t.call(this,{vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n    vec4 pos = vec4(aPosition, 1.);\n    gl_Position = projViewModelMatrix * pos;\n    vPosition = gl_Position;\n    shadow_computeShadowPars(pos);\n}\n",frag:"precision mediump float;\nuniform vec3 color;\nuniform float opacity;\n#include <vsm_shadow_frag>\nvoid main() {\n    float shadow = 0.0;\n    for (int i = 0; i < NUM_OF_DIR_LIGHTS; i++) {\n        shadow += shadow_computeShadow(i);\n    }\n    float alpha = 1.0 - shadow;\n\tgl_FragColor = vec4(color * alpha, opacity * alpha);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,t){var r=[];return j(r,t.viewMatrix,t.modelMatrix),j(r,t.projMatrix,r),r}},"vsm_shadow_lightProjViewModelMatrix["+e+"]","vsm_shadow_shadowMap["+e+"]","color","opacity"],defines:{NUM_OF_DIR_LIGHTS:e}}))}return f(r,t),r.prototype.getMeshCommand=function(e,t){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(e,null,t.getAttributes(),null,t.getElements())),this.commands.shadow_display},r}(Jr);function qn(e){return 256*e[2]*256+256*e[1]+e[0]}var Kn=new Uint8Array(4),Yn=new Float32Array(Kn.buffer);var Zn=new Uint8Array(4),Qn=function(){function s(e,t,r){var n=t.vert,i=t.uniforms,a=t.defines,o=t.extraCommandProps;E(this,s),this._renderer=e,this._fbo=r,this._clearFbo(r),this._vert=n,this._uniforms=i,this._defines=a,this._extraCommandProps=o,this._currentMeshes=[],this._init()}return s.prototype._init=function(){var e=["fbo_picking_meshId"];this._uniforms&&e.push.apply(e,this._uniforms);var t={ENABLE_PICKING:1,USE_PICKING_ID:1};if(this._defines)for(var r in this._defines)t[r]=this._defines[r];var n=this._vert,i=this._extraCommandProps;this._shader0=new Jr({vert:n,frag:"\n    precision highp float;\n\n    varying float vPickingId;\n\n    uniform float fbo_picking_meshId;\n\n    \n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n\n\n    void main() {\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n",uniforms:e,defines:t,extraCommandProps:i}),this._shader2=new Jr({vert:n,frag:"\n    precision highp float;\n\n    varying float vPickingId;\n\n    \n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n\n\n    void main() {\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n",uniforms:e,defines:t,extraCommandProps:i});var a={ENABLE_PICKING:1};if(this._defines)for(var o in this._defines)a[o]=this._defines[o];this._shader1=new Jr({vert:n,frag:"\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n\n    \n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n\n\n    void main() {\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n",uniforms:e,defines:a,extraCommandProps:i}),this._depthShader=new Jr({vert:n,frag:"\n    #define SHADER_NAME depth\n    #define FLOAT_MAX  1.70141184e38\n    #define FLOAT_MIN  1.17549435e-38\n\n    precision highp float;\n    varying float vFbo_picking_viewZ;\n\n    lowp vec4 unpack(highp float v) {\n        highp float av = abs(v);\n\n        //Handle special cases\n        if(av < FLOAT_MIN) {\n            return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n            return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n            return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        //Compute exponent and mantissa\n        highp float e = floor(log2(av));\n        highp float m = av * pow(2.0, -e) - 1.0;\n\n        //Unpack mantissa\n        c[1] = floor(128.0 * m);\n        m -= c[1] / 128.0;\n        c[2] = floor(32768.0 * m);\n        m -= c[2] / 32768.0;\n        c[3] = floor(8388608.0 * m);\n\n        //Unpack exponent\n        highp float ebias = e + 127.0;\n        c[0] = floor(ebias / 2.0);\n        ebias -= c[0] * 2.0;\n        c[1] += floor(ebias) * 128.0;\n\n        //Unpack sign bit\n        c[0] += 128.0 * step(0.0, -v);\n\n        //Scale back to range\n        return c / 255.0;\n    }\n\n    void main() {\n        gl_FragColor = unpack(vFbo_picking_viewZ);\n        // gl_FragColor = unpack(34678.3456789);\n    }\n",uniforms:e,defines:a,extraCommandProps:i}),this._scene=new Or,this._scene1=new Or},s.prototype.render=function(e,t){var r=this,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!e||!e.length)return this;var i=this._fbo;n&&this.clear(),this._scene.setMeshes(e);var a=this._getShader(e,n);this._currentShader&&a!==this._currentShader&&this.clear(),this._currentShader=a,e.forEach(function(e,t){e.setUniform("fbo_picking_meshId",t+r._currentMeshes.length)});for(var o=0;o<e.length;o++)this._currentMeshes.push(e[o]);return this._renderer.render(a,t,this._scene,i),this},s.prototype.pick=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=this._currentShader,a=this._currentMeshes;if(!i||!a||!a.length)return{pickingId:null,meshId:null,point:null};e=Math.round(e),t=Math.round(t);var o=this._renderer.regl,s=this._fbo,u=o.read({data:Zn,x:e,y:s.height-t,framebuffer:s,width:1,height:1}),f=this._packData(u,i),c=f.pickingId,l=f.meshId;null!==l&&i===this._shader1&&a[0].geometry.data.aPickingId&&(c=this._getPickingId(e,t,a[l],r));var h=null;if(a[l]&&n.returnPoint){var d=n.viewMatrix,p=n.projMatrix,m=this._pickDepth(e,t,a[l],r,c);h=this._getWorldPos(e,t,m,d,p)}return{pickingId:c,meshId:l,point:h}},s.prototype.clear=function(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this},s.prototype.getMeshAt=function(e){return this._currentMeshes?this._currentMeshes[e]:null},s.prototype._getWorldPos=function(e,t,r,n,i){var a=this._fbo,o=[],s=a.width/2||1,u=a.height/2||1,f=[(e-s)/s,(u-t)/u,0,1],c=[(e-s)/s,(u-t)/u,1,1],l=X(o,i),h=[],d=[];Jn(h,f,l),Jn(d,c,l);var p=-h[2],m=(r-p)/(-d[2]-p),_=X(o,j(o,i,n)),v=Jn(f,f,_),g=Jn(c,c,_);return[b(v[0],g[0],m),b(v[1],g[1],m),b(v[2],g[2],m)]},s.prototype._getPickingId=function(e,t,r,n){var i=this._renderer.regl,a=this._getFBO1();return this._clearFbo(a),this._scene1.setMeshes([r]),this._renderer.render(this._shader2,n,this._scene1,a),qn(i.read({x:e,y:a.height-t,framebuffer:a,width:1,height:1}))},s.prototype._pickDepth=function(e,t,r,n){var i=this._renderer.regl,a=this._getFBO1();this._scene1.setMeshes([r]),this._clearFbo(a),this._renderer.render(this._depthShader,n,this._scene1,a);var o,s=i.read({x:e,y:a.height-t,framebuffer:a,width:1,height:1});return o=s,Kn[0]=o[3],Kn[1]=o[2],Kn[2]=o[1],Kn[3]=o[0],Yn[0]},s.prototype._packData=function(e,t){if(255===e[0]&&255===e[1]&&255===e[2]&&255===e[3])return{meshId:null,pickingId:null};var r=void 0,n=void 0;return t===this._shader1?n=qn(e):(n=t===this._shader0?e[3]:null,r=qn(e)),{meshId:n,pickingId:r}},s.prototype._clearFbo=function(e){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:e})},s.prototype._getShader=function(e,t){return t&&e.length<256?this._shader0:this._shader1},s.prototype._getFBO1=function(){var e=this._renderer.regl,t=this._fbo;return this._fbo1?this._fbo1.width===t.width&&this._fbo1.height===t.height||this._fbo1.resize(t.width,t.height):this._fbo1=e.framebuffer(t.width,t.height),this._fbo1},s}();function Jn(e,t,r){var n=t[0],i=t[1],a=t[2],o=1/(r[3]*n+r[7]*i+r[11]*a+r[15]);return e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])*o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])*o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])*o,e}var $n={parseHDR:kr},ei={PBRHelper:Pn,StandardMaterial:Un,StandardFrag:"#define SHADER_NAME standard\n    #extension GL_OES_standard_derivatives : enable\n#if defined(GL_EXT_shader_texture_lod)\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n    precision mediump float;\n    varying vec3 vWorldPos;\n    varying vec3 vNormal;\n#if defined(USE_NORMAL_MAP)\n    varying vec3 vViewPos;\n#endif\n#if defined(USE_NORMAL_MAP) || defined(USE_ALBEDO_MAP) || defined(USE_OCCULUSIONROUGHNESSMETALLIC_MAP)\n    varying vec2 vTexCoord;\n#endif\n#ifdef USE_COLOR\n    varying vec3 vColor;\n#endif\n    uniform vec3 albedoColor;\n#ifdef USE_ALBEDO_MAP\n    uniform sampler2D albedoMap;\n#endif\n#ifdef USE_OCCULUSIONROUGHNESSMETALLIC_MAP\n    uniform sampler2D occulusionRoughnessMetallicMap;\n#else\n    uniform float roughness;\n    uniform float metallic;\n#endif\n#ifdef USE_AMBIENT_CUBEMAP\n    uniform samplerCube irradianceMap;\n    uniform samplerCube prefilterMap;\n    uniform sampler2D brdfLUT;\n#else\n    uniform vec3 ambientColor;\n#endif\n    uniform float ambientIntensity;\n#ifdef USE_SPOT_LIGHT\n    uniform vec3 spotLightPositions[NUM_OF_SPOT_LIGHTS];\n    uniform vec3 spotLightColors[NUM_OF_SPOT_LIGHTS];\n#endif\n#ifdef USE_DIR_LIGHT\n    uniform vec3 dirLightDirections[NUM_OF_DIR_LIGHTS];\n    uniform vec3 dirLightColors[NUM_OF_DIR_LIGHTS];\n#endif\n    uniform vec3 camPos;\n    const float PI = 3.14159265359;\n#ifdef USE_NORMAL_MAP\n    uniform sampler2D normalMap;\n#endif\n#ifdef USE_SHADOW_MAP\n    #include <vsm_shadow_frag>\n#endif\n\tvec3 getNormal() {\n        #ifdef USE_NORMAL_MAP\n            vec3 q0 = vec3( dFdx( vViewPos.x ), dFdx( vViewPos.y ), dFdx( vViewPos.z ) );\n            vec3 q1 = vec3( dFdy( vViewPos.x ), dFdy( vViewPos.y ), dFdy( vViewPos.z ) );\n            vec2 st0 = dFdx( vTexCoord.st );\n            vec2 st1 = dFdy( vTexCoord.st );\n            vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n            vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n            vec3 N = normalize( vNormal );\n            vec3 mapN = texture2D( normalMap, vTexCoord ).xyz * 2.0 - 1.0;\n            mapN.xy = 1.0 * mapN.xy;\n            mat3 tsn = mat3( S, T, N );\n            return normalize( tsn * mapN );\n        #else\n            return normalize(vNormal);\n        #endif\n\t}\n    vec3 getAlbedoColor() {\n        #ifdef USE_ALBEDO_MAP\n            vec3 color = pow(texture2D(albedoMap, vTexCoord).rgb, vec3(2.2)) * albedoColor;\n        #else\n            vec3 color = albedoColor;\n        #endif\n        #ifdef USE_COLOR\n            return color * vColor;\n        #else\n            return color;\n        #endif\n    }\n    float getAO() {\n        #ifdef USE_OCCULUSIONROUGHNESSMETALLIC_MAP\n            return texture2D(occulusionRoughnessMetallicMap, vTexCoord).r;\n        #else\n            return 1.0;\n        #endif\n    }\n    float getRoughness() {\n        #ifdef USE_OCCULUSIONROUGHNESSMETALLIC_MAP\n            return texture2D(occulusionRoughnessMetallicMap, vTexCoord).g;\n        #else\n            return roughness;\n        #endif\n    }\n    float getMetallic() {\n        #ifdef USE_OCCULUSIONROUGHNESSMETALLIC_MAP\n            return texture2D(occulusionRoughnessMetallicMap, vTexCoord).b;\n        #else\n            return metallic;\n        #endif\n    }\n    float DistributionGGX(vec3 N, vec3 H, float roughness)\n    {\n        float a = roughness * roughness;\n        float a2 = a*a;\n        float NdotH = max(dot(N, H), 0.0);\n        float NdotH2 = NdotH * NdotH;\n        float nom   = a2;\n        float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n        denom = PI * denom * denom;\n        return nom / denom;\n    }\n    float GeometrySchlickGGX(float NdotV, float roughness)\n    {\n        float r = (roughness + 1.0);\n        float k = (r*r) / 8.0;\n        float nom   = NdotV;\n        float denom = NdotV * (1.0 - k) + k;\n        return nom / denom;\n    }\n    float GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n    {\n        float NdotV = max(dot(N, V), 0.0);\n        float NdotL = max(dot(N, L), 0.0);\n        float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n        float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n        return ggx1 * ggx2;\n    }\n    vec3 fresnelSchlick(float cosTheta, vec3 F0)\n    {\n        return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n    }\n    vec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness)\n    {\n        return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n    }\n#if defined(USE_DIR_LIGHT) || defined(USE_SPOT_LIGHT)\n    vec3 caculateLightLumin(vec3 lightDir, vec3 lightColor, vec3 albedo, vec3 F0, vec3 V, vec3 N, float metallic, float roughness, float attenuation)\n    {\n        vec3 L = lightDir;\n        vec3 H = normalize(V + L);\n        vec3 radiance = lightColor * attenuation;\n        float NDF = DistributionGGX(N, H, roughness);\n        float G   = GeometrySmith(N, V, L, roughness);\n        vec3 F    = fresnelSchlick(max(dot(H, V), 0.0), F0);\n        vec3 nominator    = NDF * G * F;\n        float denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0) + 0.001;        vec3 specular = nominator / denominator;\n        vec3 kS = F;\n        vec3 kD = vec3(1.0) - kS;\n        kD *= 1.0 - metallic;\n        float NdotL = max(dot(N, L), 0.0);\n        return (kD * albedo / PI + specular) * radiance * NdotL;    }\n#endif\n    void main()\n    {\n        vec3 albedo = getAlbedoColor();\n        float ao = getAO();\n        float roughness = getRoughness();\n        float metallic = getMetallic();\n        vec3 N = getNormal();\n        vec3 V = normalize(camPos - vWorldPos);\n        vec3 R = reflect(-V, N);\n        vec3 F0 = vec3(0.04);\n        F0 = mix(F0, albedo, metallic);\n        vec3 Lo = vec3(0.0);\n        #ifdef USE_SPOT_LIGHT\n            for(int i = 0; i < NUM_OF_SPOT_LIGHTS; ++i)\n            {\n                vec3 lightDir = spotLightPositions[i] - vWorldPos;\n                float distance = length(lightDir);\n                float attenuation = 1.0 / (distance * distance);\n                Lo += caculateLightLumin(normalize(lightDir), spotLightColors[i], albedo, F0, V, N, metallic, roughness, attenuation);\n            }\n        #endif\n        vec3 Do = vec3(0.0);\n        #ifdef USE_DIR_LIGHT\n            for(int i = 0; i < NUM_OF_DIR_LIGHTS; ++i)\n            {\n                vec3 lumin = caculateLightLumin(normalize(dirLightDirections[i]), dirLightColors[i], albedo, F0, V, N, metallic, roughness, 1.0);\n                #ifdef USE_SHADOW_MAP\n                    float shadow = shadow_computeShadow(i);\n                    lumin *= shadow;\n                #endif\n                Do += lumin;\n            }\n        #endif\n        #ifdef USE_AMBIENT_CUBEMAP\n            vec3 F = fresnelSchlickRoughness(max(dot(N, V), 0.0), F0, roughness);\n            vec3 kS = F;\n            vec3 kD = 1.0 - kS;\n            kD *= 1.0 - metallic;\n            vec3 irradiance = textureCube(irradianceMap, N).rgb;\n            vec3 diffuse      = irradiance * albedo;\n            #if defined(GL_EXT_shader_texture_lod)\n                const float MAX_REFLECTION_LOD = 6.0;\n                vec3 prefilteredColor = textureCubeLodEXT(prefilterMap, R, roughness * MAX_REFLECTION_LOD).rgb;\n            #else\n                vec3 prefilteredColor = textureCube(prefilterMap, R).rgb;\n            #endif\n            vec2 brdf  = texture2D(brdfLUT, vec2(max(dot(N, V), 0.0), roughness)).rg;\n            vec3 specular = prefilteredColor * (F * brdf.x + brdf.y);\n            vec3 ambient = (kD * diffuse + specular);\n        #else\n            vec3 ambient = ambientColor;\n        #endif\n        vec3 color = ambient * ao * ambientIntensity + Lo + Do;\n        color = color / (color + vec3(1.0));\n        color = pow(color, vec3(1.0/2.2));\n        gl_FragColor = vec4(color, 1.0);\n    }\n",StandardVert:"    attribute vec3 aPosition;\n    attribute vec3 aNormal;\n    varying vec3 vWorldPos;\n    varying vec3 vNormal;\n#if defined(USE_NORMAL_MAP) || defined(USE_ALBEDO_MAP) || defined(USE_OCCULUSIONROUGHNESSMETALLIC_MAP)\n    attribute vec2 aTexCoord;\n    varying vec2 vTexCoord;\n#endif\n#ifdef USE_COLOR\n    attribute vec3 aColor;\n    varying vec3 vColor;\n#endif\n#if defined(USE_NORMAL_MAP)\n    varying vec3 vViewPos;\n    uniform mat4 viewModelMatrix;\n#endif\n    uniform mat4 modelMatrix;\n    uniform mat4 projViewModelMatrix;\n#ifdef USE_SHADOW_MAP\n    #include <vsm_shadow_vert>\n#endif\n    void main()\n    {\n        #if defined(USE_NORMAL_MAP) || defined(USE_ALBEDO_MAP) || defined(USE_OCCULUSIONROUGHNESSMETALLIC_MAP)\n            vTexCoord = aTexCoord;\n        #endif\n        vec4 pos = vec4(aPosition, 1.0);\n        vWorldPos = (modelMatrix * pos).xyz;\n        #if defined(USE_NORMAL_MAP)\n            vViewPos = (viewModelMatrix * pos).xyz;\n        #endif\n        vNormal = mat3(modelMatrix) * aNormal;\n        #ifdef USE_COLOR\n            vColor = aColor / 255.0;\n        #endif\n        gl_Position =  projViewModelMatrix * pos;\n        #ifdef USE_SHADOW_MAP\n            shadow_computeShadowPars(pos);\n        #endif\n    }\n"},ti=Object.freeze({Util:i,HDR:$n,SkyboxHelper:ln,pbr:ei,AbstractTexture:h,DeferredRenderer:m,Geometry:vr,Material:Er,Mesh:yr,Renderer:p,ResourceLoader:Tr,Scene:Or,Texture2D:Gr,TextureCube:Hr,Plane:Vr,Shader:Zr,MeshShader:Jr,WireframeShader:$r,ShadowPass:Wn,ShadowDisplayShader:zn,FBORayPicking:Qn});function ri(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function ni(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=0;i<r.length;i++)ri(e,r[i])}var ii=1,ai=function(){function t(e){var n;E(this,t),this.uid=ii++,this.states={scissor:[0,0,(n=e).canvas.width,n.canvas.height],viewport:[0,0,n.canvas.width,n.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[n.FUNC_ADD,n.FUNC_ADD],blendFuncSeparate:[n.ONE,n.ZERO,n.ONE,n.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[n.BACK],depthFunc:[n.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[n.CCW],hint:{33170:[n.DONT_CARE],35723:[n.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[n.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[n.ALWAYS,0,4294967295],1029:[n.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[n.KEEP,n.KEEP,n.KEEP],1029:[n.KEEP,n.KEEP,n.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){for(var e=[],t=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r=0;r<t;r++)e.push({3553:null,34067:null});return e[-1]={3553:null,34067:null},e}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null},this._gl=e}return t.prototype.attachShader=function(e,t){return this._gl.attachShader(e,t)},t.prototype.shaderSource=function(e,t){return this._gl.shaderSource(e,t)},t.prototype.compileShader=function(e){return this._gl.compileShader(e)},t.prototype.createShader=function(e){return this._gl.createShader(e)},t.prototype.createProgram=function(){return this._gl.createProgram()},t.prototype.createVertexArray=function(){return this._vertexArrayOES||(this._vertexArrayOES=this._gl.getExtension("OES_vertex_array_object")),this._vertexArrayOES.createVertexArrayOES()},t.prototype.deleteVertexArray=function(e){return this._vertexArrayOES||(this._vertexArrayOES=this._gl.getExtension("OES_vertex_array_object")),this._vertexArrayOES.deleteVertexArrayOES(e)},t.prototype.bindVertexArray=function(e){return this._vertexArrayOES||(this._vertexArrayOES=this._gl.getExtension("OES_vertex_array_object")),this._vertexArrayOES.bindVertexArrayOES(e)},t.prototype.deleteProgram=function(e){return this.states.program===e&&(this.states.program=null),this._gl.deleteProgram(e)},t.prototype.deleteShader=function(e){return this._gl.deleteShader(e)},t.prototype.detachShader=function(e,t){return this._gl.detachShader(e,t)},t.prototype.getAttachedShaders=function(e){return this._gl.getAttachedShaders(e)},t.prototype.linkProgram=function(e){return this._checkAndRestore(),this._gl.linkProgram(e)},t.prototype.getShaderParameter=function(e,t){return this._gl.getShaderParameter(e,t)},t.prototype.getShaderPrecisionFormat=function(e,t){return this._gl.getShaderPrecisionFormat(e,t)},t.prototype.getShaderInfoLog=function(e){return this._gl.getShaderInfoLog(e)},t.prototype.getShaderSource=function(e){return this._gl.getShaderSource(e)},t.prototype.getProgramInfoLog=function(e){return this._gl.getProgramInfoLog(e)},t.prototype.getProgramParameter=function(e,t){return this._gl.getProgramParameter(e,t)},t.prototype.getError=function(){return this._gl.getError()},t.prototype.getContextAttributes=function(){return this._gl.getContextAttributes()},t.prototype.getExtension=function(e){return this._gl.getExtension(e)},t.prototype.getSupportedExtensions=function(){return this._gl.getSupportedExtensions()},t.prototype.getParameter=function(e){return this._checkAndRestore(),this._gl.getParameter(e)},t.prototype.isEnabled=function(e){return this._gl.isEnabled(e)},t.prototype.isProgram=function(e){return this._gl.isProgram(e)},t.prototype.isShader=function(e){return this._gl.isShader(e)},t.prototype.validateProgram=function(e){return this._gl.validateProgram(e)},t.prototype.clear=function(e){return this._checkAndRestore(),this._gl.clear(e)},t.prototype.drawArrays=function(e,t,r){return this._checkAndRestore(),this._gl.drawArrays(e,t,r)},t.prototype.drawElements=function(e,t,r,n){return this._checkAndRestore(),this._gl.drawElements(e,t,r,n)},t.prototype._saveDataStatus=function(){for(var e=this._gl,t=e.getParameter(e.CURRENT_PROGRAM),r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=[],i=0;i<r;i++)n.push(e.getVertexAttrib(i,e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this._dataStatus={buffers:n,elements:e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:e.getParameter(e.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(console.log(this.uid,this._dataStatus),console.log(this.uid,this.states.attributes),console.log(this.states.attributes[0].buffer===this._dataStatus.buffers[0]),console.log(this.states.attributes[1].buffer===this._dataStatus.buffers[1]),console.log(this.states.attributes[2].buffer===this._dataStatus.buffers[2]))},t.prototype.finish=function(){},t.prototype.flush=function(){return this._checkAndRestore(),this._gl.flush()},t.prototype.commit=function(){return this._checkAndRestore(),this._gl.commit()},t.prototype.isContextLost=function(){return this._gl.isContextLost()},a(t,[{key:"canvas",get:function(){return this._gl.canvas}},{key:"drawingBufferWidth",get:function(){return this._gl.drawingBufferWidth}},{key:"drawingBufferHeight",get:function(){return this._gl.drawingBufferHeight}},{key:"gl",get:function(){return this._gl}}]),t}();ni(ai.prototype,{DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBSTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}),ni(ai.prototype,{bufferData:function(){var e;return this._checkAndRestore(),(e=this._gl).bufferData.apply(e,arguments)},bufferSubData:function(){var e;return this._checkAndRestore(),(e=this._gl).bufferSubData.apply(e,arguments)},createBuffer:function(){return this._gl.createBuffer()},deleteBuffer:function(e){var t=this.states;t.arrayBuffer===e?t.arrayBuffer=null:t.elementArrayBuffer===e&&(t.elementArrayBuffer=null);var r=t.attributes;for(var n in r)r[n].buffer===e&&(r[n].buffer=null);return this._gl.deleteBuffer(e)},getBufferParameter:function(e,t){return this._checkAndRestore(),this._gl.getBufferParameter(e,t)},isBuffer:function(e){return this._gl.isBuffer(e)}}),ni(ai.prototype,{checkFramebufferStatus:function(e){return this._gl.checkFramebufferStatus(e)},createFramebuffer:function(){return this._gl.createFramebuffer()},deleteFramebuffer:function(e){var t=this.states.framebuffer;for(var r in t)t[r]===e&&(t[r]=null);return this._gl.deleteFramebuffer(e)},framebufferRenderbuffer:function(e,t,r,n){return this._checkAndRestore(),this._gl.framebufferRenderbuffer(e,t,r,n)},framebufferTexture2D:function(e,t,r,n,i){return this._checkAndRestore(),this._gl.framebufferTexture2D(e,t,r,n,i)},getFramebufferAttachmentParameter:function(e,t,r){return this._checkAndRestore(),this._gl.getFramebufferAttachmentParameter(e,t,r)},isFramebuffer:function(e){return this._gl.isFramebuffer(e)},readPixels:function(e,t,r,n,i,a,o){return this._checkAndRestore(),this._gl.readPixels(e,t,r,n,i,a,o)}}),ni(ai.prototype,{createRenderbuffer:function(){return this._gl.createRenderbuffer()},deleteRenderbuffer:function(e){var t=this.states.renderbuffer;for(var r in t)t[r]===e&&(t[r]=null);return this._gl.deleteRenderbuffer(e)},getRenderbufferParameter:function(e,t){return this._checkAndRestore(),this._gl.getRenderbufferParameter(e,t)},isRenderbuffer:function(e){return this._gl.isRenderbuffer(e)},renderbufferStorage:function(e,t,r,n){return this._checkAndRestore(),this._gl.renderbufferStorage(e,t,r,n)}});var oi=Array.isArray,si=Object.keys,ui=Object.prototype.hasOwnProperty,fi=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==(void 0===t?"undefined":d(t))&&"object"==(void 0===r?"undefined":d(r))){var n,i,a,o=oi(t),s=oi(r);if(o&&s){if((i=t.length)!=r.length)return!1;for(n=i;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(o!=s)return!1;var u=t instanceof Date,f=r instanceof Date;if(u!=f)return!1;if(u&&f)return t.getTime()==r.getTime();var c=t instanceof RegExp,l=r instanceof RegExp;if(c!=l)return!1;if(c&&l)return t.toString()==r.toString();var h=si(t);if((i=h.length)!==si(r).length)return!1;for(n=i;0!=n--;)if(!ui.call(r,h[n]))return!1;for(n=i;0!=n--;)if(!e(t[a=h[n]],r[a]))return!1;return!0}return t!=t&&r!=r},ci="_fusion_context";ni(ai.prototype,{scissor:function(e,t,r,n){this._checkAndRestore();var i=this.states.scissor;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.scissor(e,t,r,n))},viewport:function(e,t,r,n){this._checkAndRestore();var i=this.states.viewport;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.viewport(e,t,r,n))},blendColor:function(e,t,r,n){this._checkAndRestore();var i=this.states.blendColor;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.blendColor(e,t,r,n))},blendEquation:function(e){this._checkAndRestore();var t=this.states.blendEquationSeparate;t[0]===e&&t[1]===e||(t[0]=e,t[1]=e,this._gl.blendEquation(e))},blendEquationSeparate:function(e,t){this._checkAndRestore();var r=this.states.blendEquationSeparate;r[0]===e&&r[1]===t||(r[0]=e,r[1]=t,this._gl.blendEquationSeparate(e,t))},blendFunc:function(e,t){this._checkAndRestore();var r=this.states.blendFuncSeparate;r[0]===e&&r[2]===e&&r[1]===t&&r[3]===t||(r[0]=e,r[1]=t,r[2]=e,r[3]=t,this._gl.blendFunc(e,t))},blendFuncSeparate:function(e,t,r,n){this._checkAndRestore();var i=this.states.blendFuncSeparate;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.blendFuncSeparate(e,t,r,n))},clearColor:function(e,t,r,n){this._checkAndRestore();var i=this.states.clearColor;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.clearColor(e,t,r,n))},clearDepth:function(e){this._checkAndRestore();var t=this.states.clearDepth;t[0]!==e&&(t[0]=e,this._gl.clearDepth(e))},clearStencil:function(e){this._checkAndRestore();var t=this.states.clearStencil;t[0]!==e&&(t[0]=e,this._gl.clearStencil(e))},colorMask:function(e,t,r,n){this._checkAndRestore();var i=this.states.colorMask;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this._gl.colorMask(e,t,r,n))},cullFace:function(e){this._checkAndRestore();var t=this.states.cullFace;t[0]!==e&&(t[0]=e,this._gl.cullFace(e))},depthFunc:function(e){this._checkAndRestore();var t=this.states.depthFunc;t[0]!==e&&(t[0]=e,this._gl.depthFunc(e))},depthMask:function(e){this._checkAndRestore();var t=this.states.depthMask;t[0]!==e&&(t[0]=e,this._gl.depthMask(e))},depthRange:function(e,t){this._checkAndRestore();var r=this.states.depthRange;r[0]===e&&r[1]===t||(r[0]=e,r[1]=t,this._gl.depthRange(e,t))},disable:function(e){this._checkAndRestore();var t=this.states.capabilities;t[e]&&(t[e]=!1,this._gl.disable(e))},enable:function(e){this._checkAndRestore();var t=this.states.capabilities;t[e]||(t[e]=!0,this._gl.enable(e))},frontFace:function(e){this._checkAndRestore();var t=this.states.frontFace;t[0]!==e&&(t[0]=e,this._gl.frontFace(e))},hint:function(e,t){this._checkAndRestore();var r=this.states.hint;r[e][0]!==t&&(r[e][0]=t,this._gl.hint(e,t))},lineWidth:function(e){this._checkAndRestore();var t=this.states.lineWidth;t[0]!==e&&(t[0]=e,this._gl.lineWidth(e))},pixelStorei:function(e,t){this._checkAndRestore();var r=this.states.pixelStorei;r[e]!==t&&(r[e]&&(r[e][0]=t),this._gl.pixelStorei(e,t))},polygonOffset:function(e,t){this._checkAndRestore();var r=this.states.polygonOffset;r[0]===e&&r[1]===t||(r[0]=e,r[1]=t,this._gl.polygonOffset(e,t))},sampleCoverage:function(e,t){this._checkAndRestore();var r=this.states.sampleCoverage;r[0]===e&&r[1]===t||(r[0]=e,r[1]=t,this._gl.sampleCoverage(e,t))},stencilFunc:function(e,t,r){this._checkAndRestore();var n=this.states.stencilFuncSeparate,i=this._gl;n[i.FRONT][0]===e&&n[i.FRONT][1]===t&&n[i.FRONT][2]===r&&n[i.BACK][0]===e&&n[i.BACK][1]===t&&n[i.BACK][2]===r||(n[i.FRONT][0]=n[i.BACK][0]=e,n[i.FRONT][1]=n[i.BACK][1]=t,n[i.FRONT][2]=n[i.BACK][2]=r,this._gl.stencilFunc(e,t,r))},stencilFuncSeparate:function(e,t,r,n){if(this._checkAndRestore(),e!==this._gl.FRONT_AND_BACK){var i=this.states.stencilFuncSeparate;i[e][0]===t&&i[e][1]===r&&i[e][2]===n||(i[e][0]=t,i[e][1]=r,i[e][2]=n,this._gl.stencilFuncSeparate(e,t,r,n))}else this.stencilFunc(t,r,n)},stencilMask:function(e){this._checkAndRestore();var t=this._gl,r=this.states.stencilMaskSeparate;r[t.FRONT][0]===e&&r[t.BACK][0]===e||(r[t.FRONT][0]=e,r[t.BACK][0]=e,this._gl.stencilMask(e))},stencilMaskSeparate:function(e,t){if(this._checkAndRestore(),e!==this._gl.FRONT_AND_BACK){var r=this.states.stencilMaskSeparate;r[e][0]!==t&&(r[e][0]=t,this._gl.stencilMaskSeparate(e,t))}else this.stencilMask(t)},stencilOp:function(e,t,r){this._checkAndRestore();var n=this.states.stencilOpSeparate,i=this._gl;n[i.FRONT][0]===e&&n[i.FRONT][1]===t&&n[i.FRONT][2]===r&&n[i.BACK][0]===e&&n[i.BACK][1]===t&&n[i.BACK][2]===r||(n[i.FRONT][0]=n[i.BACK][0]=e,n[i.FRONT][1]=n[i.BACK][1]=t,n[i.FRONT][2]=n[i.BACK][2]=r,this._gl.stencilOp(e,t,r))},stencilOpSeparate:function(e,t,r,n){if(this._checkAndRestore(),e!==this._gl.FRONT_AND_BACK){var i=this.states.stencilOpSeparate;i[e][0]===t&&i[e][1]===r&&i[e][2]===n||(i[e][0]=t,i[e][1]=r,i[e][2]=n,this._gl.stencilOpSeparate(e,t,r,n))}else this.stencilOp(t,r,n)},bindFramebuffer:function(e,t){this._checkAndRestore();var r=this.states.framebuffer;r[e]!==t&&(r[e]=t,this._gl.bindFramebuffer(e,t))},bindRenderbuffer:function(e,t){this._checkAndRestore();var r=this.states.renderbuffer;r[e]!==t&&(r[e]=t,this._gl.bindRenderbuffer(e,t))},bindTexture:function(e,t){this._checkAndRestore();var r=this.states.textures,n=-1!==r.active?r.active-33984:-1;r.units[n][e]=t,this._gl.bindTexture(e,t)},activeTexture:function(e){this._checkAndRestore();var t=this._gl,r=this.states.textures,n=r.active;r.active=e,t.activeTexture(e),-1===n&&(r.units[e-33984][t.TEXTURE_2D]=r.units[-1][t.TEXTURE_2D],r.units[e-33984][t.TEXTURE_CUBE_MAP]=r.units[-1][t.TEXTURE_CUBE_MAP],r.units[-1][t.TEXTURE_2D]=null,r.units[-1][t.TEXTURE_CUBE_MAP]=null)},useProgram:function(e){this._checkAndRestore();var t=this.states;t.program!==e&&(t.program=e,this._gl.useProgram(e))},bindBuffer:function(e,t){this._checkAndRestore();var r=this._gl,n=this.states;if(e===r.ELEMENT_ARRAY_BUFFER){if(n.elementArrayBuffer===t)return;n.elementArrayBuffer=t}else{if(n.arrayBuffer===t)return;n.arrayBuffer=t}r.bindBuffer(e,t)},vertexAttribPointer:function(e,t,r,n,i,a){this._checkAndRestore();var o=[e,t,r,n,i,a];this.states.attributes[e]||(this.states.attributes[e]={enable:!0});var s=this.states.attributes[e];return s.buffer=this.states.arrayBuffer,s.args=o,this._gl.vertexAttribPointer(e,t,r,n,i,a)}},{_checkAndRestore:function(){var e=this._gl;if(e[ci]&&e[ci]!==this){var t=e[ci];this._restore(t.states),e[ci]=this}e[ci]=this},_restore:function(e){var t=this.states,r=this._gl;for(var n in t)if("capabilities"!==n&&"textures"!==n&&"attributes"!==n&&"arrayBuffer"!==n&&"elementArrayBuffer"!==n)if("program"===n)t.program!==e.program&&r.useProgram(t.program);else if("framebuffer"===n)for(var i in t[n])t[n][i]!==e[n][i]&&r.bindFramebuffer(+i,t[n][i]);else if("renderbuffer"===n)for(var a in t[n])t[n][a]!==e[n][a]&&r.bindRenderbuffer(+a,t[n][a]);else if(!fi(t[n],e[n]))if(Array.isArray(e[n]))r[n].apply(r,t[n]);else for(var o in t[n])fi(t[n][o],e[n][o])||r[n].apply(r,[+o].concat(t[n][o]));for(var s in t.capabilities)t.capabilities[s]!==e.capabilities[s]&&r[t.capabilities[s]?"enable":"disable"](+s);for(var u=t.textures,f=e.textures,c=u.units,l=f.units,h=u.active-r.TEXTURE0,d=0;d<c.length;d++)d===h||c[d][r.TEXTURE_2D]===l[d][r.TEXTURE_2D]&&c[d][r.TEXTURE_CUBE_MAP]===l[d][r.TEXTURE_CUBE_MAP]||(r.activeTexture(r.TEXTURE0+d),r.bindTexture(r.TEXTURE_2D,c[d][r.TEXTURE_2D]),r.bindTexture(r.TEXTURE_CUBE_MAP,c[d][r.TEXTURE_CUBE_MAP]));if(-1<u.active){var p=c[h];p[r.TEXTURE_2D]===l[h][r.TEXTURE_2D]&&p[r.TEXTURE_CUBE_MAP]===l[h][r.TEXTURE_CUBE_MAP]||(r.activeTexture(u.active),r.bindTexture(r.TEXTURE_2D,p[r.TEXTURE_2D]),r.bindTexture(r.TEXTURE_CUBE_MAP,p[r.TEXTURE_CUBE_MAP]))}var m=t.attributes,_=e.attributes;for(var v in m)_[v]&&m[v].buffer===_[v].buffer&&fi(m[v].args,_[v].args)||m[v].buffer&&(r.bindBuffer(r.ARRAY_BUFFER,m[v].buffer),r.vertexAttribPointer.apply(r,m[v].args),m[v].enable?r.enableVertexAttribArray(m[v].args[0]):r.disableVertexAttribArray(m[v].args[0]));r.bindBuffer(r.ARRAY_BUFFER,t.arrayBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.elementArrayBuffer)}}),ni(ai.prototype,{compressedTexImage2D:function(e,t,r,n,i,a,o){return this._checkAndRestore(),this._gl.compressedTexImage2D(e,t,r,n,i,a,o)},copyTexImage2D:function(e,t,r,n,i,a,o,s){return this._checkAndRestore(),this._gl.copyTexImage2D(e,t,r,n,i,a,o,s)},copyTexSubImage2D:function(e,t,r,n,i,a,o,s){return this._checkAndRestore(),this._gl.copyTexSubImage2D(e,t,r,n,i,a,o,s)},createTexture:function(){return this._gl.createTexture()},deleteTexture:function(e){return this._gl.deleteTexture(e)},generateMipmap:function(e){return this._checkAndRestore(),this._gl.generateMipmap(e)},getTexParameter:function(e,t){return this._checkAndRestore(),this._gl.getTexParameter(e,t)},isTexture:function(e){return this._gl.isTexture(e)},texImage2D:function(){var e;return this._checkAndRestore(),(e=this._gl).texImage2D.apply(e,arguments)},texSubImage2D:function(e){var t;return this._checkAndRestore(),(t=this._gl).texSubImage2D.apply(t,e)},texParameterf:function(e,t,r){return this._checkAndRestore(),this._gl.texParameterf(e,t,r)},texParameteri:function(e,t,r){return this._checkAndRestore(),this._gl.texParameteri(e,t,r)}}),ni(ai.prototype,{bindAttribLocation:function(e,t,r){return this._gl.bindAttribLocation(e,t,r)},enableVertexAttribArray:function(e){return this._checkAndRestore(),this.states.attributes[e]||(this.states.attributes[e]={}),this.states.attributes[e].enable=!0,this._gl.enableVertexAttribArray(e)},disableVertexAttribArray:function(e){return this._checkAndRestore(),this.states.attributes[e]||(this.states.attributes[e]={}),this.states.attributes[e].enable=!1,this._gl.disableVertexAttribArray(e)},getActiveAttrib:function(e,t){return this._gl.getActiveAttrib(e,t)},getActiveUniform:function(e,t){return this._gl.getActiveUniform(e,t)},getAttribLocation:function(e,t){return this._gl.getAttribLocation(e,t)},getUniformLocation:function(e,t){return this._gl.getUniformLocation(e,t)},getVertexAttrib:function(e,t){return this._checkAndRestore(),this._gl.getVertexAttrib(e,t)},getVertexAttribOffset:function(e,t){return this._checkAndRestore(),this._gl.getVertexAttribOffset(e,t)},uniformMatrix2fv:function(e,t,r){return this._checkAndRestore(),this._gl.uniformMatrix2fv(e,t,r)},uniformMatrix3fv:function(e,t,r){return this._checkAndRestore(),this._gl.uniformMatrix3fv(e,t,r)},uniformMatrix4fv:function(e,t,r){return this._checkAndRestore(),this._gl.uniformMatrix4fv(e,t,r)},uniform1f:function(e,t){return this._checkAndRestore(),this._gl.uniform1f(e,t)},uniform1fv:function(e,t){return this._checkAndRestore(),this._gl.uniform1fv(e,t)},uniform1i:function(e,t){return this._checkAndRestore(),this._gl.uniform1i(e,t)},uniform1iv:function(e,t){return this._checkAndRestore(),this._gl.uniform1iv(e,t)},uniform2f:function(e,t,r){return this._checkAndRestore(),this._gl.uniform2f(e,t,r)},uniform2fv:function(e,t){return this._checkAndRestore(),this._gl.uniform2fv(e,t)},uniform2i:function(e,t,r){return this._checkAndRestore(),this._gl.uniform2i(e,t,r)},uniform2iv:function(e,t){return this._checkAndRestore(),this._gl.uniform2iv(e,t)},uniform3f:function(e,t,r,n){return this._checkAndRestore(),this._gl.uniform3f(e,t,r,n)},uniform3fv:function(e,t){return this._checkAndRestore(),this._gl.uniform3fv(e,t)},uniform3i:function(e,t,r,n){return this._checkAndRestore(),this._gl.uniform3i(e,t,r,n)},uniform3iv:function(e,t){return this._checkAndRestore(),this._gl.uniform3iv(e,t)},uniform4f:function(e,t,r,n,i){return this._checkAndRestore(),this._gl.uniform4f(e,t,r,n,i)},uniform4fv:function(e,t){return this._checkAndRestore(),this._gl.uniform4fv(e,t)},uniform4i:function(e,t,r,n,i){return this._checkAndRestore(),this._gl.uniform4i(e,t,r,n,i)},uniform4iv:function(e,t){return this._checkAndRestore(),this._gl.uniform4iv(e,t)},vertexAttrib1f:function(e,t){return this._checkAndRestore(),this._gl.vertexAttrib1f(e,t)},vertexAttrib2f:function(e,t,r){return this._checkAndRestore(),this._gl.vertexAttrib2f(e,t,r)},vertexAttrib3f:function(e,t,r,n){return this._checkAndRestore(),this._gl.vertexAttrib3f(e,t,r,n)},vertexAttrib4f:function(e,t,r,n,i){return this._checkAndRestore(),this._gl.vertexAttrib4f(e,t,r,n,i)},vertexAttrib1fv:function(e,t){return this._checkAndRestore(),this._gl.vertexAttrib1fv(e,t)},vertexAttrib2fv:function(e,t){return this._checkAndRestore(),this._gl.vertexAttrib2fv(e,t)},vertexAttrib3fv:function(e,t){return this._checkAndRestore(),this._gl.vertexAttrib3fv(e,t)},vertexAttrib4fv:function(e,t){return this._checkAndRestore(),this._gl.vertexAttrib4fv(e,t)}});var li=function(i){function a(e,t,r){E(this,a);var n=c(this,i.call(this,e,r));return n.layers=t||[],n._checkChildren(),n._layerMap={},n}return f(a,i),a.fromJSON=function(e){if(!e||"GroupGLLayer"!==e.type)return null;var t=e.layers.map(function(e){return r.Layer.fromJSON(e)});return new a(e.id,t,e.options)},a.prototype.addLayer=function(e,t){if(e.getMap())throw new Error("layer("+e.getId()+" is already added on map");void 0===t?this.layers.push(e):this.layers.splice(t,0,e),this._checkChildren();var r=this.getRenderer();return r&&(this._prepareLayer(e),r.setToRedraw()),this},a.prototype.removeLayer=function(e){r.Util.isString(e)&&(e=this.getChildLayer(e));var t=this.layers.indexOf(e);return t<0||(e._doRemove(),e.off("show hide",this._onLayerShowHide,this),delete this._layerMap[e.getId()],this.layers.splice(t,1),this.getRenderer().setToRedraw()),this},a.prototype.getLayers=function(){return this.layers},a.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(e){return e.toJSON()}),options:this.config()}},a.prototype.onLoadEnd=function(){var t=this;this.layers.forEach(function(e){t._prepareLayer(e)}),i.prototype.onLoadEnd.call(this)},a.prototype._prepareLayer=function(e){var t=this.getMap();(this._layerMap[e.getId()]=e)._canvas=this.getRenderer().canvas,e._bindMap(t),e.once("renderercreate",this._onChildRendererCreate,this),e.load(),this._bindChildListeners(e)},a.prototype.onRemove=function(){var t=this;this.layers.forEach(function(e){e._doRemove(),e.off("show hide",t._onLayerShowHide,t)}),delete this._layerMap,i.prototype.onRemove.call(this)},a.prototype.getChildLayer=function(e){return this._layerMap[e]||null},a.prototype._bindChildListeners=function(e){e.on("show hide",this._onLayerShowHide,this)},a.prototype._onLayerShowHide=function(){var e=this.getRenderer();e&&e.setToRedraw()},a.prototype._onChildRendererCreate=function(e){e.renderer.clearCanvas=di},a.prototype.isVisible=function(){if(!i.prototype.isVisible.call(this))return!1;for(var e=this.layers,t=0,r=e.length;t<r;t++)if(e[t].isVisible())return!0;return!1},a.prototype._checkChildren=function(){var r=this,n={};this.layers.forEach(function(e){var t=e.getId();if(n[t])throw new Error("Duplicate child layer id ("+t+") in the GroupGLLayer ("+r.getId()+")");n[t]=1})},a}(r.Layer);li.mergeOptions({renderer:"gl",extensions:["OES_texture_float","OES_texture_float_linear","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:["WEBGL_draw_buffers","EXT_shader_texture_lod"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0}),li.registerJSONType("GroupGLLayer");var hi=function(t){function e(){return E(this,e),c(this,t.apply(this,arguments))}return f(e,t),e.prototype.onAdd=function(){t.prototype.onAdd.call(this),this.prepareCanvas()},e.prototype.render=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];this.getMap()&&this.layer.isVisible()&&(this.prepareRender(),this.prepareCanvas(),this.forEachRenderer(function(e,t){if(t.isVisible()){var r=e.gl;r&&r instanceof ai&&r.clear(r.STENCIL_BUFFER_BIT),e.render.apply(e,n)}}),this._toRedraw=!1)},e.prototype.drawOnInteracting=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer(function(e,t){if(t.isVisible()){var r=e.gl;r&&r instanceof ai&&r.clear(r.STENCIL_BUFFER_BIT),e.drawOnInteracting.apply(e,n)}}),this._toRedraw=!1)},e.prototype.testIfNeedRedraw=function(){if(this._toRedraw)return!(this._toRedraw=!1);var e=this.layer.getLayers(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n.getRenderer();if(i&&i.testIfNeedRedraw())return!0}return!1},e.prototype.isRenderComplete=function(){var e=this.layer.getLayers(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n.getRenderer();if(i&&!i.isRenderComplete())return!1}return!0},e.prototype.mustRenderOnInteracting=function(){var e=this.layer.getLayers(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n.getRenderer();if(i&&i.mustRenderOnInteracting())return!0}return!1},e.prototype.isCanvasUpdated=function(){var e=this.layer.getLayers(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n.getRenderer();if(i&&i.isCanvasUpdated())return!0}return!1},e.prototype.isBlank=function(){var e=this.layer.getLayers(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n.getRenderer();if(i&&!i.isBlank())return!1}return!0},e.prototype.createContext=function(){var e=this,t=this.layer.options.glOptions||{alpha:!0,depth:!0,antialias:!0,stencil:!0};t.preserveDrawingBuffer=!0,this.glOptions=t;var r=this.gl=this._createGLContext(this.canvas,t);this._initGL(r),r.wrap=function(){return new ai(e.gl)},this.glCtx=r.wrap(),this.canvas.gl=this.gl},e.prototype._initGL=function(){var e=this.layer,t=this.gl,r=e.options.extensions;r&&r.forEach(function(e){t.getExtension(e)});var n=e.options.optionalExtensions;n&&n.forEach(function(e){t.getExtension(e)}),this.gl.clearColor(0,0,0,0)},e.prototype.clearCanvas=function(){t.prototype.clearCanvas.call(this);var e=this.glCtx;e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.clear(e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},e.prototype.resizeCanvas=function(){t.prototype.resizeCanvas.call(this),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.forEachRenderer(function(e){e.canvas&&e.resizeCanvas()})},e.prototype.getCanvasImage=function(){return this.forEachRenderer(function(e){e.getCanvasImage()}),t.prototype.getCanvasImage.call(this)},e.prototype.forEachRenderer=function(e){var t=this.layer.getLayers(),r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}var a=i,o=a.getRenderer();o&&e(o,a)}},e.prototype._createGLContext=function(e,t){for(var r=["webgl","experimental-webgl"],n=null,i=0;i<r.length;++i){try{n=e.getContext(r[i],t)}catch(e){}if(n)break}return n},e}(r.renderer.CanvasRenderer);function di(){}li.registerRenderer("gl",hi),li.registerRenderer("canvas",null),"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=li),e.createREGL=n,e.reshader=ti,e.glMatrix=R,e.mat2=O,e.mat2d=D,e.mat3=H,e.mat4=re,e.quat=Ut,e.quat2=Zt,e.vec2=pr,e.vec3=Ce,e.vec4=it,e.GroupGLLayer=li,e.GLContext=ai,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("@maptalks/gl v0.1.0")});
